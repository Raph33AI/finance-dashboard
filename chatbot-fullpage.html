<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaVault AI - Financial Chatbot</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/images/favicon.png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Particles.js Background -->
    <link rel="stylesheet" href="assets/css/particles-background.css">
    
    <!-- Chatbot CSS -->
    <link rel="stylesheet" href="assets/css/chatbot-futuristic.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Config -->
    <script src="assets/js/firebase-config.js"></script>
    
    <!-- Auth Guard -->
    <script src="assets/js/auth-guard.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: transparent;
            overflow-x: hidden;
        }
    </style>
</head>
<body>
    <!-- ============================================
         PARTICLES BACKGROUND
         ============================================ -->
    <canvas class="particles-background" id="particles-canvas"></canvas>

    <!-- ============================================
         LAYOUT WRAPPER
         ============================================ -->
    <div class="layout-wrapper">
        
        <!-- ============================================
             CHATBOT MAIN CONTENT
             ============================================ -->
        <div class="chatbot-main-content">
            
            <!-- ============================================
                 TOP HEADER
                 ============================================ -->
            <div class="chatbot-top-header">
                <div class="header-status">
                    <span class="status-dot"></span>
                    Real-Time Data
                </div>
                
                <div class="header-actions">
                    <!-- ‚úÖ BOUTON HISTORIQUE MOBILE -->
                    <button class="mobile-history-btn" id="mobileHistoryBtn" title="Conversation History" aria-label="Open conversation history">
                        <i class="fas fa-history"></i>
                    </button>
                    
                    <!-- Bouton Share -->
                    <button class="header-action-btn" id="shareBtn" title="Share" aria-label="Share conversation">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    
                    <!-- Bouton Settings -->
                    <button class="header-action-btn" id="settingsBtn" title="Settings" aria-label="Open settings">
                        <i class="fas fa-cog"></i>
                    </button>
                    
                    <!-- Bouton Dark Mode -->
                    <button class="header-action-btn" id="darkModeToggle" title="Toggle Dark Mode" aria-label="Toggle dark mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    
                    <!-- Bouton User Profile -->
                    <button class="header-action-btn" id="userProfileBtn" title="Profile" aria-label="Open user profile">
                        <i class="fas fa-user-circle"></i>
                    </button>
                </div>
            </div>
            
            <!-- ============================================
                 CHAT LAYOUT
                 ============================================ -->
            <div class="chat-layout">
                
                <!-- ============================================
                     CONVERSATIONS SIDEBAR
                     ============================================ -->
                <div class="conversations-sidebar collapsed" id="conversationsSidebar">
                    <div class="conversations-header">
                        <h3><i class="fas fa-comments"></i> Conversations</h3>
                        <button class="conversations-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    </div>
                    
                    <div class="conversations-list" id="conversationsList">
                        <!-- Today -->
                        <div class="conversation-group">
                            <div class="group-title">Today</div>
                            
                            <div class="conversation-item active" data-conversation-id="1">
                                <i class="fas fa-comment-dots"></i>
                                <span class="conversation-title">NVDA Stock Analysis</span>
                                <button class="conversation-delete" aria-label="Delete conversation">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            
                            <div class="conversation-item" data-conversation-id="2">
                                <i class="fas fa-comment-dots"></i>
                                <span class="conversation-title">Tech Sector Overview</span>
                                <button class="conversation-delete" aria-label="Delete conversation">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            
                            <div class="conversation-item" data-conversation-id="3">
                                <i class="fas fa-comment-dots"></i>
                                <span class="conversation-title">Portfolio Risk Analysis</span>
                                <button class="conversation-delete" aria-label="Delete conversation">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Yesterday -->
                        <div class="conversation-group">
                            <div class="group-title">Yesterday</div>
                            
                            <div class="conversation-item" data-conversation-id="4">
                                <i class="fas fa-comment-dots"></i>
                                <span class="conversation-title">IPO Calendar Review</span>
                                <button class="conversation-delete" aria-label="Delete conversation">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            
                            <div class="conversation-item" data-conversation-id="5">
                                <i class="fas fa-comment-dots"></i>
                                <span class="conversation-title">Market Trends Q4 2024</span>
                                <button class="conversation-delete" aria-label="Delete conversation">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Last 7 Days -->
                        <div class="conversation-group">
                            <div class="group-title">Last 7 Days</div>
                            
                            <div class="conversation-item" data-conversation-id="6">
                                <i class="fas fa-comment-dots"></i>
                                <span class="conversation-title">AAPL vs MSFT Comparison</span>
                                <button class="conversation-delete" aria-label="Delete conversation">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            
                            <div class="conversation-item" data-conversation-id="7">
                                <i class="fas fa-comment-dots"></i>
                                <span class="conversation-title">Crypto Market Analysis</span>
                                <button class="conversation-delete" aria-label="Delete conversation">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ============================================
                     CHAT MESSAGES AREA
                     ============================================ -->
                <div class="chat-messages-area">
                    
                    <!-- Bouton pour r√©ouvrir la sidebar (Desktop uniquement) -->
                    <button class="sidebar-reopen-btn" id="sidebarReopenBtn" aria-label="Open sidebar">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    
                    <!-- Messages Wrapper -->
                    <div class="chatbot-messages-wrapper" id="chatbotMessages">
                        <div class="chatbot-messages-content" id="messagesContent">
                            
                            <!-- ============================================
                                 WELCOME SCREEN
                                 ============================================ -->
                            <div class="welcome-screen" id="welcomeScreen">
                                <h1 class="welcome-title">Welcome to AlphaVault AI</h1>
                                <p class="welcome-subtitle">Your intelligent financial assistant powered by advanced AI</p>
                                
                                <!-- Features -->
                                <div class="welcome-features">
                                    <div class="feature-card">
                                        <div class="feature-icon">üìä</div>
                                        <div class="feature-title">Real-Time Data</div>
                                        <div class="feature-desc">Access live market data and financial metrics instantly</div>
                                    </div>
                                    
                                    <div class="feature-card">
                                        <div class="feature-icon">ü§ñ</div>
                                        <div class="feature-title">AI-Powered Insights</div>
                                        <div class="feature-desc">Get intelligent analysis and predictions</div>
                                    </div>
                                    
                                    <div class="feature-card">
                                        <div class="feature-icon">üìà</div>
                                        <div class="feature-title">Advanced Charts</div>
                                        <div class="feature-desc">Visualize trends with interactive charts</div>
                                    </div>
                                    
                                    <div class="feature-card">
                                        <div class="feature-icon">üéØ</div>
                                        <div class="feature-title">Portfolio Analysis</div>
                                        <div class="feature-desc">Optimize your investment strategy</div>
                                    </div>
                                </div>
                                
                                <!-- Suggestions -->
                                <div class="welcome-suggestions">
                                    <h2 class="suggestions-title">üí° Try asking:</h2>
                                    <div class="welcome-suggestion-grid">
                                        <button class="welcome-suggestion-btn" data-suggestion="What's the current price of NVDA?">
                                            <span class="suggestion-icon">üí∞</span>
                                            <span class="suggestion-text">What's the current price of NVDA?</span>
                                        </button>
                                        
                                        <button class="welcome-suggestion-btn" data-suggestion="Show me the top performing tech stocks this week">
                                            <span class="suggestion-icon">üöÄ</span>
                                            <span class="suggestion-text">Show me the top performing tech stocks this week</span>
                                        </button>
                                        
                                        <button class="welcome-suggestion-btn" data-suggestion="Analyze my portfolio risk">
                                            <span class="suggestion-icon">‚ö†</span>
                                            <span class="suggestion-text">Analyze my portfolio risk</span>
                                        </button>
                                        
                                        <button class="welcome-suggestion-btn" data-suggestion="What are the upcoming IPOs this month?">
                                            <span class="suggestion-icon">üéØ</span>
                                            <span class="suggestion-text">What are the upcoming IPOs this month?</span>
                                        </button>
                                        
                                        <button class="welcome-suggestion-btn" data-suggestion="Compare AAPL vs MSFT performance">
                                            <span class="suggestion-icon">‚öñ</span>
                                            <span class="suggestion-text">Compare AAPL vs MSFT performance</span>
                                        </button>
                                        
                                        <button class="welcome-suggestion-btn" data-suggestion="Explain the current market trends">
                                            <span class="suggestion-icon">üìâ</span>
                                            <span class="suggestion-text">Explain the current market trends</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Les messages appara√Ætront ici dynamiquement -->
                            
                        </div>
                    </div>
                    
                    <!-- ============================================
                         INPUT AREA
                         ============================================ -->
                    <div class="chatbot-input-area">
                        <!-- Suggestions dynamiques -->
                        <div class="input-suggestions" id="inputSuggestions">
                            <!-- Exemples de suggestions (seront ajout√©es dynamiquement) -->
                        </div>
                        
                        <!-- Input Container -->
                        <div class="input-container">
                            <div class="input-wrapper">
                                <textarea 
                                    class="chatbot-input" 
                                    id="chatbotInput" 
                                    placeholder="Ask me anything about finance, stocks, or markets..."
                                    rows="1"
                                    aria-label="Message input"
                                ></textarea>
                                <button class="input-clear-btn" id="inputClearBtn" aria-label="Clear input">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <button class="chatbot-send-btn" id="chatbotSendBtn" aria-label="Send message">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        
                        <!-- Input Footer -->
                        <div class="input-footer">
                            <div class="input-hint">
                                <i class="fas fa-lightbulb"></i>
                                <span>Press Enter to send, Shift+Enter for new line</span>
                            </div>
                            <div class="input-counter" id="inputCounter">0/2000</div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    
    <!-- ============================================
         ‚úÖ MODAL HISTORIQUE MOBILE
         ============================================ -->
    <div class="mobile-history-modal" id="mobileHistoryModal">
        <div class="mobile-history-content">
            <div class="mobile-history-header">
                <h3><i class="fas fa-comments"></i> Conversation History</h3>
                <button class="mobile-history-close" id="mobileHistoryClose" aria-label="Close history">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mobile-history-list" id="mobileHistoryList">
                <!-- Le contenu sera copi√© depuis la sidebar desktop -->
            </div>
        </div>
    </div>
    
    <!-- ============================================
         SETTINGS MODAL
         ============================================ -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <div class="settings-header">
                <h3><i class="fas fa-cog"></i> Settings</h3>
                <button class="settings-close" id="settingsClose" aria-label="Close settings">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="settings-body">
                <h4 style="margin-bottom: 16px; color: var(--chatbot-text);">Preferences</h4>
                
                <!-- Dark Mode Toggle -->
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: rgba(241, 245, 249, 0.5); border-radius: 12px; margin-bottom: 12px;">
                    <div>
                        <div style="font-weight: 600; color: var(--chatbot-text); margin-bottom: 4px;">Dark Mode</div>
                        <div style="font-size: 13px; color: var(--chatbot-text-secondary);">Enable dark theme</div>
                    </div>
                    <label style="position: relative; display: inline-block; width: 50px; height: 26px;">
                        <input type="checkbox" id="darkModeCheckbox" style="opacity: 0; width: 0; height: 0;">
                        <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: 0.4s; border-radius: 26px;"></span>
                        <span style="position: absolute; content: ''; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: 0.4s; border-radius: 50%;"></span>
                    </label>
                </div>
                
                <!-- Language -->
                <div style="padding: 16px; background: rgba(241, 245, 249, 0.5); border-radius: 12px; margin-bottom: 12px;">
                    <div style="font-weight: 600; color: var(--chatbot-text); margin-bottom: 8px;">Language</div>
                    <select style="width: 100%; padding: 10px; border: 1px solid var(--chatbot-border); border-radius: 8px; font-family: 'Inter', sans-serif; font-size: 14px;">
                        <option value="en">English</option>
                        <option value="fr">Fran√ßais</option>
                        <option value="es">Espa√±ol</option>
                        <option value="de">Deutsch</option>
                    </select>
                </div>
                
                <!-- Notifications -->
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: rgba(241, 245, 249, 0.5); border-radius: 12px; margin-bottom: 12px;">
                    <div>
                        <div style="font-weight: 600; color: var(--chatbot-text); margin-bottom: 4px;">Notifications</div>
                        <div style="font-size: 13px; color: var(--chatbot-text-secondary);">Enable push notifications</div>
                    </div>
                    <label style="position: relative; display: inline-block; width: 50px; height: 26px;">
                        <input type="checkbox" id="notificationsCheckbox" checked style="opacity: 0; width: 0; height: 0;">
                        <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--neon-blue); transition: 0.4s; border-radius: 26px;"></span>
                        <span style="position: absolute; content: ''; height: 20px; width: 20px; left: 27px; bottom: 3px; background-color: white; transition: 0.4s; border-radius: 50%;"></span>
                    </label>
                </div>
                
                <!-- Clear History -->
                <button style="width: 100%; padding: 14px; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; border-radius: 12px; font-weight: 600; font-size: 14px; cursor: pointer; margin-top: 20px;">
                    <i class="fas fa-trash-alt"></i> Clear All Conversations
                </button>
            </div>
        </div>
    </div>
    
    <!-- ============================================
         SHARE MODAL
         ============================================ -->
    <div class="share-modal" id="shareModal">
        <div class="share-content">
            <div class="share-header">
                <h3><i class="fas fa-share-alt"></i> Share Conversation</h3>
                <button class="share-close" id="shareClose" aria-label="Close share">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="share-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <p style="color: var(--chatbot-text-secondary); margin-bottom: 16px;">Share this conversation with your team</p>
                    <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                        <button style="padding: 12px 20px; background: #1DA1F2; color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <i class="fab fa-twitter"></i> Twitter
                        </button>
                        <button style="padding: 12px 20px; background: #0077B5; color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <i class="fab fa-linkedin"></i> LinkedIn
                        </button>
                        <button style="padding: 12px 20px; background: #25D366; color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </button>
                    </div>
                </div>
                
                <div style="padding: 16px; background: rgba(241, 245, 249, 0.5); border-radius: 12px;">
                    <div style="font-weight: 600; color: var(--chatbot-text); margin-bottom: 8px;">Share Link</div>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" value="https://alphavault-ai.com/chat/abc123" readonly style="flex: 1; padding: 10px; border: 1px solid var(--chatbot-border); border-radius: 8px; font-family: 'Courier New', monospace; font-size: 13px;">
                        <button style="padding: 10px 20px; background: var(--gradient-primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ============================================
         SCRIPTS
         ============================================ -->
    
    <!-- Particles Background -->
    <script src="assets/js/chatbot-particles.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Chatbot Core Scripts -->
    <script src="assets/js/chatbot-config.js"></script>
    <script src="assets/js/chatbot-gemini.js"></script>
    <script src="assets/js/chatbot-analytics.js"></script>
    <script src="assets/js/chatbot-charts.js"></script>
    <script src="assets/js/chatbot-ipo-analyzer.js"></script>
    <script src="assets/js/chatbot-suggestions.js"></script>
    <script src="assets/js/chatbot-ai-engine.js"></script>
    <script src="assets/js/chatbot-ui.js"></script>
    
    <!-- ============================================
         ‚úÖ SCRIPT POUR G√âRER LA MODAL HISTORIQUE
         ============================================ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Chatbot Full Page initialized');
        
        // ============================================
        // SIDEBAR TOGGLE (Desktop)
        // ============================================
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebarReopenBtn = document.getElementById('sidebarReopenBtn');
        const sidebar = document.getElementById('conversationsSidebar');
        
        if (sidebarToggle && sidebar) {
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
                const icon = sidebarToggle.querySelector('i');
                if (sidebar.classList.contains('collapsed')) {
                    icon.className = 'fas fa-chevron-right';
                } else {
                    icon.className = 'fas fa-chevron-left';
                }
            });
        }
        
        if (sidebarReopenBtn && sidebar) {
            sidebarReopenBtn.addEventListener('click', function() {
                sidebar.classList.remove('collapsed');
                const icon = sidebarToggle.querySelector('i');
                icon.className = 'fas fa-chevron-left';
            });
        }
        
        // ============================================
        // ‚úÖ MODAL HISTORIQUE MOBILE
        // ============================================
        const mobileHistoryBtn = document.getElementById('mobileHistoryBtn');
        const mobileHistoryModal = document.getElementById('mobileHistoryModal');
        const mobileHistoryClose = document.getElementById('mobileHistoryClose');
        const mobileHistoryList = document.getElementById('mobileHistoryList');
        const desktopConversationsList = document.getElementById('conversationsList');
        
        // Fonction pour synchroniser les conversations
        function syncMobileHistory() {
            if (desktopConversationsList && mobileHistoryList) {
                mobileHistoryList.innerHTML = desktopConversationsList.innerHTML;
                console.log('üì± Mobile history synced');
            }
        }
        
        // Ouvrir la modal
        if (mobileHistoryBtn && mobileHistoryModal) {
            mobileHistoryBtn.addEventListener('click', function() {
                syncMobileHistory(); // Synchroniser avant d'ouvrir
                mobileHistoryModal.classList.add('active');
                document.body.style.overflow = 'hidden';
                console.log('üì± Mobile history modal opened');
            });
        }
        
        // Fermer la modal
        function closeHistoryModal() {
            if (mobileHistoryModal) {
                mobileHistoryModal.classList.remove('active');
                document.body.style.overflow = '';
                console.log('üì± Mobile history modal closed');
            }
        }
        
        if (mobileHistoryClose) {
            mobileHistoryClose.addEventListener('click', closeHistoryModal);
        }
        
        // Fermer en cliquant sur le backdrop
        if (mobileHistoryModal) {
            mobileHistoryModal.addEventListener('click', function(e) {
                if (e.target === mobileHistoryModal) {
                    closeHistoryModal();
                }
            });
        }
        
        // Observer les changements dans la sidebar desktop
        if (desktopConversationsList) {
            const observer = new MutationObserver(syncMobileHistory);
            observer.observe(desktopConversationsList, { 
                childList: true, 
                subtree: true 
            });
        }
        
        // Synchroniser au chargement
        syncMobileHistory();
        
        // D√©l√©gation d'√©v√©nements pour les conversations dans la modal mobile
        if (mobileHistoryList) {
            mobileHistoryList.addEventListener('click', function(e) {
                // Gestion du clic sur une conversation
                const conversationItem = e.target.closest('.conversation-item');
                if (conversationItem && !e.target.closest('.conversation-delete')) {
                    const conversationId = conversationItem.dataset.conversationId;
                    console.log('üì± Selected conversation:', conversationId);
                    
                    // Retirer la classe active de toutes les conversations
                    document.querySelectorAll('.conversation-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // Ajouter la classe active √† la conversation s√©lectionn√©e
                    conversationItem.classList.add('active');
                    
                    // Fermer la modal sur mobile
                    closeHistoryModal();
                    
                    // Ici, vous pouvez charger la conversation
                    // loadConversation(conversationId);
                }
                
                // Gestion du bouton supprimer
                const deleteBtn = e.target.closest('.conversation-delete');
                if (deleteBtn) {
                    e.stopPropagation();
                    const conversationItem = deleteBtn.closest('.conversation-item');
                    if (conversationItem && confirm('Delete this conversation?')) {
                        conversationItem.remove();
                        syncMobileHistory();
                        console.log('üóë Conversation deleted');
                    }
                }
            });
        }
        
        // ============================================
        // SETTINGS MODAL
        // ============================================
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const settingsClose = document.getElementById('settingsClose');
        
        if (settingsBtn && settingsModal) {
            settingsBtn.addEventListener('click', function() {
                settingsModal.classList.add('active');
                console.log('‚öô Settings modal opened');
            });
        }
        
        function closeSettingsModal() {
            if (settingsModal) {
                settingsModal.classList.remove('active');
                console.log('‚öô Settings modal closed');
            }
        }
        
        if (settingsClose) {
            settingsClose.addEventListener('click', closeSettingsModal);
        }
        
        if (settingsModal) {
            settingsModal.addEventListener('click', function(e) {
                if (e.target === settingsModal) {
                    closeSettingsModal();
                }
            });
        }
        
        // ============================================
        // SHARE MODAL
        // ============================================
        const shareBtn = document.getElementById('shareBtn');
        const shareModal = document.getElementById('shareModal');
        const shareClose = document.getElementById('shareClose');
        
        if (shareBtn && shareModal) {
            shareBtn.addEventListener('click', function() {
                shareModal.classList.add('active');
                console.log('üîó Share modal opened');
            });
        }
        
        function closeShareModal() {
            if (shareModal) {
                shareModal.classList.remove('active');
                console.log('üîó Share modal closed');
            }
        }
        
        if (shareClose) {
            shareClose.addEventListener('click', closeShareModal);
        }
        
        if (shareModal) {
            shareModal.addEventListener('click', function(e) {
                if (e.target === shareModal) {
                    closeShareModal();
                }
            });
        }
        
        // ============================================
        // DARK MODE TOGGLE
        // ============================================
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeCheckbox = document.getElementById('darkModeCheckbox');
        
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            
            // Update icon
            if (darkModeToggle) {
                const icon = darkModeToggle.querySelector('i');
                icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            }
            
            // Update checkbox
            if (darkModeCheckbox) {
                darkModeCheckbox.checked = isDark;
            }
            
            // Save preference
            localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
            console.log('üåô Dark mode:', isDark ? 'enabled' : 'disabled');
        }
        
        if (darkModeToggle) {
            darkModeToggle.addEventListener('click', toggleDarkMode);
        }
        
        if (darkModeCheckbox) {
            darkModeCheckbox.addEventListener('change', toggleDarkMode);
        }
        
        // Load dark mode preference
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            if (darkModeToggle) {
                const icon = darkModeToggle.querySelector('i');
                icon.className = 'fas fa-sun';
            }
            if (darkModeCheckbox) {
                darkModeCheckbox.checked = true;
            }
        }
        
        // ============================================
        // INPUT AUTO-RESIZE
        // ============================================
        const chatbotInput = document.getElementById('chatbotInput');
        const inputCounter = document.getElementById('inputCounter');
        const inputClearBtn = document.getElementById('inputClearBtn');
        
        if (chatbotInput) {
            chatbotInput.addEventListener('input', function() {
                // Auto-resize
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 150) + 'px';
                
                // Update counter
                if (inputCounter) {
                    const count = this.value.length;
                    inputCounter.textContent = `${count}/2000`;
                    if (count > 1800) {
                        inputCounter.style.color = '#ef4444';
                    } else {
                        inputCounter.style.color = 'var(--chatbot-text-secondary)';
                    }
                }
                
                // Show/hide clear button
                if (inputClearBtn) {
                    if (this.value.length > 0) {
                        inputClearBtn.style.opacity = '1';
                    } else {
                        inputClearBtn.style.opacity = '0';
                    }
                }
            });
            
            // Enter to send, Shift+Enter for new line
            chatbotInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    document.getElementById('chatbotSendBtn').click();
                }
            });
        }
        
        if (inputClearBtn && chatbotInput) {
            inputClearBtn.addEventListener('click', function() {
                chatbotInput.value = '';
                chatbotInput.style.height = 'auto';
                if (inputCounter) {
                    inputCounter.textContent = '0/2000';
                    inputCounter.style.color = 'var(--chatbot-text-secondary)';
                }
                this.style.opacity = '0';
                chatbotInput.focus();
            });
        }
        
        // ============================================
        // WELCOME SUGGESTIONS
        // ============================================
        const welcomeSuggestions = document.querySelectorAll('.welcome-suggestion-btn');
        welcomeSuggestions.forEach(btn => {
            btn.addEventListener('click', function() {
                const suggestion = this.dataset.suggestion;
                if (chatbotInput && suggestion) {
                    chatbotInput.value = suggestion;
                    chatbotInput.focus();
                    chatbotInput.dispatchEvent(new Event('input'));
                    console.log('üí° Suggestion selected:', suggestion);
                }
            });
        });
        
        // ============================================
        // CONVERSATION ITEM CLICKS (Desktop)
        // ============================================
        const conversationItems = document.querySelectorAll('.conversation-item');
        conversationItems.forEach(item => {
            item.addEventListener('click', function(e) {
                if (!e.target.closest('.conversation-delete')) {
                    conversationItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    const conversationId = this.dataset.conversationId;
                    console.log('üí¨ Selected conversation:', conversationId);
                    // Ici, vous pouvez charger la conversation
                }
            });
            
            // Delete button
            const deleteBtn = item.querySelector('.conversation-delete');
            if (deleteBtn) {
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (confirm('Delete this conversation?')) {
                        item.remove();
                        syncMobileHistory();
                        console.log('üóë Conversation deleted');
                    }
                });
            }
        });
        
        console.log('‚úÖ All event listeners attached');
    });
    </script>
    
    <!-- Chatbot Initialization -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ü§ñ Initializing FinanceGPT Chatbot...');
        
        // Check if ChatbotConfig is loaded
        if (typeof ChatbotConfig === 'undefined') {
            console.error('‚ùå ChatbotConfig not defined!');
            console.error('üìÅ Check that assets/js/chatbot-config.js exists');
            return;
        }
        
        console.log('‚úÖ ChatbotConfig loaded');
        
        // Check if ChatbotUI is available
        if (typeof ChatbotUI === 'undefined') {
            console.error('‚ùå ChatbotUI not defined!');
            console.error('üìÅ Check that assets/js/chatbot-ui.js exists');
            return;
        }
        
        console.log('‚úÖ ChatbotUI loaded');
        
        // Initialize chatbot
        try {
            window.financialChatbot = new ChatbotUI(ChatbotConfig);
            console.log('üéâ FinanceGPT Chatbot initialized successfully!');
        } catch (error) {
            console.error('‚ùå Error initializing chatbot:', error);
            console.error('üìã Details:', error.message);
        }
    });
    </script>
</body>
</html>