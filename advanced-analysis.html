<!DOCTYPE html>
<html lang='fr'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Advanced Analysis - Wall Street Edition</title>
    
    <!-- Highcharts -->
    <script src='https://code.highcharts.com/stock/highstock.js'></script>
    <script src='https://code.highcharts.com/highcharts-more.js'></script>
    <script src='https://code.highcharts.com/modules/exporting.js'></script>
    
    <!-- Font Awesome -->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'>
    
    <!-- Styles -->
    <link rel='stylesheet' href='assets/css/common.css'>
    <link rel='stylesheet' href='assets/css/sidebar.css'>
    <link rel="stylesheet" href="assets/css/user-menu.css">
    <link rel="stylesheet" href="assets/css/chatbot-styles.css">
    <link rel='stylesheet' href='assets/css/advanced-analysis.css'>
    
    <!-- âœ… FAVICON DYNAMIQUE -->
    <script src="assets/js/favicon-dynamic.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Configuration Firebase -->
    <script src="assets/js/firebase-config.js"></script>
    
    <!-- Protection de la page (AUTH GUARD) -->
    <script src="assets/js/auth-guard.js"></script>

    <!-- âœ… ACCESS CONTROL -->
    <script src="assets/js/access-control.js"></script>
    
</head>
<body>

    <!-- âš¡ THEME SCRIPT -->
    <script src="assets/js/theme.js"></script>

    <!-- Particles Background -->
    <canvas id="particles-canvas" class="particles-background"></canvas>

    <!-- ðŸŽ¨ THEME CHARTS -->
    <script src="assets/js/theme-charts.js"></script>

    <div class='layout-wrapper'>
        
        <!-- ============================================
             SIDEBAR NAVIGATION
             ============================================ -->
        <aside class='sidebar' id='sidebar'>
            <!-- Header avec Logo 3D -->
            <div class="sidebar-header">
                <div class="logo-container">
                    <div class="logo-3d">
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" class="logo-gradient-1" />
                                    <stop offset="100%" class="logo-gradient-2" />
                                </linearGradient>
                            </defs>
                            <path d="M 20 80 L 30 70 L 40 75 L 50 60 L 60 65 L 70 45 L 80 50 L 90 30" 
                                  stroke="url(#logoGradient)" 
                                  stroke-width="4" 
                                  fill="none" 
                                  stroke-linecap="round" 
                                  stroke-linejoin="round"/>
                            <circle cx="30" cy="70" r="4" fill="url(#logoGradient)"/>
                            <circle cx="50" cy="60" r="4" fill="url(#logoGradient)"/>
                            <circle cx="70" cy="45" r="4" fill="url(#logoGradient)"/>
                            <circle cx="90" cy="30" r="5" fill="url(#logoGradient)"/>
                            <path d="M 85 35 L 90 30 L 85 25" 
                                  stroke="url(#logoGradient)" 
                                  stroke-width="3" 
                                  fill="none" 
                                  stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="brand-text">
                        <h2 class="brand-name">AlphaVault AI</h2>
                        <span class="brand-tagline">Investments</span>
                    </div>
                </div>
                <button class="sidebar-toggle" aria-label="Toggle Sidebar">
                    <i class="fas fa-angle-left"></i>
                </button>
            </div>
            
            <!-- Navigation -->
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <button class="nav-folder" data-tooltip="Home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>
                    <div class="nav-submenu">
                        <a href="index.html" class="nav-link">
                            <i class="fas fa-home"></i>
                            <span>Overview</span>
                        </a>
                    </div>
                </div>
                
                <div class='nav-section'>
                    <button class='nav-folder'>
                        <i class='fas fa-wallet'></i>
                        <span>Budget</span>
                        <i class='fas fa-chevron-down arrow'></i>
                    </button>
                    <div class='nav-submenu'>
                        <a href='dashboard-financier.html' class='nav-link'>
                            <i class='fas fa-home'></i>
                            <span>Dashboard Budget</span>
                        </a>
                        <a href='investment-analytics.html' class='nav-link'>
                            <i class='fas fa-chart-bar'></i>
                            <span>Investment Analytics</span>
                        </a>
                    </div>
                </div>
                
                <div class='nav-section'>
                    <button class='nav-folder'>
                        <i class='fas fa-calculator'></i>
                        <span>Simulation</span>
                        <i class='fas fa-chevron-down arrow'></i>
                    </button>
                    <div class='nav-submenu'>
                        <a href='monte-carlo.html' class='nav-link'>
                            <i class='fas fa-dice'></i>
                            <span>Monte Carlo</span>
                        </a>
                        <a href='portfolio-optimizer.html' class='nav-link'>
                            <i class='fas fa-chart-pie'></i>
                            <span>Markowitz</span>
                        </a>
                        <a href='risk-parity.html' class='nav-link'>
                            <i class='fas fa-balance-scale'></i>
                            <span>Risk Parity</span>
                        </a>
                        <a href='scenario-analysis.html' class='nav-link'>
                            <i class='fas fa-flask'></i>
                            <span>Scenarios</span>
                        </a>
                    </div>
                </div>
                
                <div class='nav-section'>
                    <button class="nav-folder" data-tooltip="Stocks">
                        <i class="fas fa-chart-line"></i>
                        <span>Stocks</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>
                    <div class='nav-submenu' style='display: block;'>
                        <a href='market-data.html' class='nav-link'>
                            <i class='fas fa-database'></i>
                            <span>Market Data</span>
                        </a>
                        <a href='advanced-analysis.html' class='nav-link active'>
                            <i class='fas fa-brain'></i>
                            <span>Advanced Analysis</span>
                        </a>
                        <a href='trend-prediction.html' class='nav-link'>
                            <i class='fas fa-chart-line'></i>
                            <span>Trend Prediction</span>
                        </a>
                        <a href='market-intelligence.html' class='nav-link'>
                            <i class='fas fa-globe'></i>
                            <span>Market Intelligence</span>
                        </a>
                        <a href='company-insights.html' class='nav-link'>
                            <i class='fas fa-building'></i>
                            <span>Company Insights</span>
                        </a>
                        <a href='analyst-coverage.html' class='nav-link'>
                            <i class='fas fa-users'></i>
                            <span>Analyst Coverage</span>
                        </a>
                        <a href='earnings-estimates.html' class='nav-link'>
                            <i class='fas fa-coins'></i>
                            <span>Earnings & Estimates</span>
                        </a>
                    </div>
                </div>

                <div class='nav-section'>
                    <button class="nav-folder" data-tooltip="AI Assistant">
                        <i class="fas fa-robot"></i>
                        <span>AI Assistant</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>
                    <div class='nav-submenu' style='display: block;'>
                        <a href='chatbot-fullpage.html' class='nav-link'>
                            <i class='fas fa-comments'></i>
                            <span>Alphy AI Chat</span>
                        </a>
                    </div>
                </div>
            </nav>
            
            <!-- SIDEBAR FOOTER -->
            <div class="sidebar-footer">
                <div class="sidebar-user-menu">
                    <div class="sidebar-user-trigger" id="sidebarUserTrigger">
                        <img data-user-photo 
                            src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" 
                            alt="Avatar" 
                            class="sidebar-user-avatar">
                        <div class="sidebar-user-info">
                            <span data-user-name class="sidebar-user-name">User</span>
                            <span data-user-plan class="sidebar-user-plan">Free Plan</span>
                        </div>
                        <i class="fas fa-chevron-up sidebar-user-arrow"></i>
                    </div>
                    
                    <div class="sidebar-user-dropdown" id="sidebarUserDropdown">
                        <div class="user-dropdown-header">
                            <img data-user-photo 
                                src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" 
                                alt="Avatar" 
                                class="user-dropdown-avatar">
                            <div class="user-dropdown-details">
                                <h4 data-user-name class="user-dropdown-name">User</h4>
                                <p data-user-email class="user-dropdown-email">email@example.com</p>
                            </div>
                        </div>
                        
                        <div class="user-dropdown-divider"></div>
                        
                        <nav class="user-dropdown-links">
                            <a href="user-profile.html" class="user-dropdown-link">
                                <i class="fas fa-user"></i>
                                <span>My profile</span>
                            </a>
                            <a href="settings.html" class="user-dropdown-link">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </a>
                            <a href="#" class="user-dropdown-link">
                                <i class="fas fa-question-circle"></i>
                                <span>Help</span>
                            </a>
                        </nav>
                        
                        <div class="user-dropdown-divider"></div>
                        
                        <button onclick="logout()" class="user-dropdown-logout">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Disconnect</span>
                        </button>
                    </div>
                </div>
            </div>
        </aside>
        
        <div class='sidebar-overlay' id='sidebarOverlay' aria-hidden='true'></div>
        
        <!-- ============================================
             MAIN CONTENT AREA
             ============================================ -->
        <div class='main-content'>
            <!-- Top Header -->
            <header class='top-header'>
                <div class="header-content-wrapper">
                    <div class='header-left'>
                        <button class='mobile-toggle' id='mobileToggle'>
                            <i class='fas fa-bars'></i>
                        </button>
                        <h1><i class="fas fa-brain"></i> Advanced Technical Analysis - Wall Street Edition</h1>
                    </div>
                </div>
            </header>
            
            <!-- Container -->
            <div class='container'>
                <div class='content'>
                    
                    <!-- ============================================
                         ðŸ†• PORTFOLIO MANAGEMENT SECTION
                         ============================================ -->
                    <div class='portfolio-management-section'>
                        <h2 class='section-title'>
                            <i class='fas fa-briefcase'></i> Portfolio Management
                            <span class='help-icon' onclick='openPortfolioHelp()'>?</span>
                        </h2>
                        
                        <div class='portfolio-toolbar'>
                            <div class='portfolio-selector'>
                                <label>
                                    <i class='fas fa-folder-open'></i> Active Portfolio:
                                </label>
                                <select id='portfolioSelect' class='portfolio-dropdown'>
                                    <option value=''>Loading portfolios...</option>
                                </select>
                            </div>
                            
                            <div class='portfolio-actions'>
                                <button class='btn-portfolio-action' onclick='PortfolioManager.openCreateModal()'>
                                    <i class='fas fa-plus'></i> New Portfolio
                                </button>
                                <button class='btn-portfolio-action' onclick='PortfolioManager.openManageModal()'>
                                    <i class='fas fa-cog'></i> Manage
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ============================================
                         ðŸ†• WATCHLIST SECTION
                         ============================================ -->
                    <div class='watchlist-section'>
                        <h2 class='section-title'>
                            <i class='fas fa-star'></i> Watchlist
                            <span class='help-icon' onclick='openWatchlistHelp()'>?</span>
                        </h2>
                        
                        <div class='watchlist-toolbar'>
                            <div class='watchlist-search'>
                                <input type='text' 
                                       id='watchlistSearchInput' 
                                       placeholder='Add stock to watchlist (e.g., AAPL)...'
                                       autocomplete='off'>
                                <button class='btn-add-watchlist' onclick='WatchlistManager.addFromInput()'>
                                    <i class='fas fa-plus'></i> Add
                                </button>
                            </div>
                            
                            <div class='watchlist-filters'>
                                <button class='filter-btn active' data-filter='all' onclick='WatchlistManager.filterWatchlist("all")'>
                                    All
                                </button>
                                <button class='filter-btn' data-filter='gainers' onclick='WatchlistManager.filterWatchlist("gainers")'>
                                    <i class='fas fa-arrow-up'></i> Gainers
                                </button>
                                <button class='filter-btn' data-filter='losers' onclick='WatchlistManager.filterWatchlist("losers")'>
                                    <i class='fas fa-arrow-down'></i> Losers
                                </button>
                            </div>
                        </div>
                        
                        <div id='watchlistContainer' class='watchlist-container'>
                            <div class='watchlist-empty'>
                                <i class='fas fa-star'></i>
                                <p>No stocks in watchlist</p>
                                <small>Add stocks to track them in real-time</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ============================================
                         ðŸ†• PRICE ALERTS SECTION
                         ============================================ -->
                    <div class='price-alerts-section'>
                        <h2 class='section-title'>
                            <i class='fas fa-bell'></i> Price Alerts
                            <span class='help-icon' onclick='openAlertsHelp()'>?</span>
                        </h2>
                        
                        <div class='alerts-toolbar'>
                            <button class='btn-create-alert' onclick='AlertsManager.openCreateModal()'>
                                <i class='fas fa-plus'></i> Create New Alert
                            </button>
                            
                            <div class='alerts-stats'>
                                <div class='stat-badge'>
                                    <span id='activeAlertsCount'>0</span>
                                    <small>Active</small>
                                </div>
                                <div class='stat-badge'>
                                    <span id='triggeredAlertsCount'>0</span>
                                    <small>Triggered</small>
                                </div>
                            </div>
                        </div>
                        
                        <div id='alertsContainer' class='alerts-container'>
                            <div class='alerts-empty'>
                                <i class='fas fa-bell-slash'></i>
                                <p>No active price alerts</p>
                                <small>Create alerts to get notified when prices reach your targets</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ============================================
                         SEARCH PANEL
                         ============================================ -->
                    <div class='search-panel'>
                        <h2 class='panel-title'>
                            <i class='fas fa-search'></i> Select Stock for Advanced Analysis (40+ Professional Indicators)
                            <span class='help-icon' onclick='openModal("modalIntro")'>?</span>
                        </h2>
                        
                        <div class='search-container'>
                            <div class='search-input-wrapper'>
                                <input type='text' 
                                       id='symbolInput' 
                                       placeholder='Search by symbol or company name (e.g., AAPL, Apple, Tesla)...'
                                       autocomplete='off'
                                       value='AAPL'>
                                <button class='btn-analyze' onclick='AdvancedAnalysis.analyzeStock()'>
                                    <i class='fas fa-chart-area'></i> Analyze Stock
                                </button>
                                <div class='search-suggestions' id='searchSuggestions'></div>
                            </div>
                            
                            <div class='popular-stocks'>
                                <span class='quick-label'>Popular Stocks:</span>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("AAPL")'>
                                    <i class='fab fa-apple'></i> AAPL
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("MSFT")'>
                                    <i class='fab fa-microsoft'></i> MSFT
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("GOOGL")'>
                                    <i class='fab fa-google'></i> GOOGL
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("AMZN")'>
                                    <i class='fab fa-amazon'></i> AMZN
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("TSLA")'>
                                    <i class='fas fa-car'></i> TSLA
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("NVDA")'>
                                    <i class='fas fa-microchip'></i> NVDA
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("META")'>
                                    <i class='fab fa-meta'></i> META
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("NFLX")'>
                                    <i class='fas fa-film'></i> NFLX
                                </button>
                            </div>
                            
                            <div class='prediction-settings'>
                                <div class='setting-group'>
                                    <label>Analysis Period:</label>
                                    <button class='horizon-btn' data-period='1M' onclick='AdvancedAnalysis.changePeriod("1M")'>1M</button>
                                    <button class='horizon-btn' data-period='3M' onclick='AdvancedAnalysis.changePeriod("3M")'>3M</button>
                                    <button class='horizon-btn active' data-period='6M' onclick='AdvancedAnalysis.changePeriod("6M")'>6M</button>
                                    <button class='horizon-btn' data-period='1Y' onclick='AdvancedAnalysis.changePeriod("1Y")'>1Y</button>
                                    <button class='horizon-btn' data-period='5Y' onclick='AdvancedAnalysis.changePeriod("5Y")'>5Y</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Loading Indicator -->
                    <div id='loadingIndicator' class='loading-indicator hidden'>
                        <i class='fas fa-spinner fa-spin'></i> 
                        <span id='loadingText'>Loading data and calculating 40+ professional indicators...</span>
                    </div>
                    
                    <!-- Stock Header -->
                    <div id='stockHeader' class='stock-header hidden'>
                        <div class='header-content'>
                            <div class='stock-info'>
                                <h2 id='stockSymbol'>-</h2>
                                <span id='stockName' class='stock-name'>-</span>
                            </div>
                            <div class='stock-price'>
                                <div id='currentPrice' class='price'>-</div>
                                <div id='priceChange' class='change'>-</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Results Panel -->
                    <div id='resultsPanel' class='results-panel hidden'>
                        
                        <!-- ============================================
                             ðŸ“Š CONSOLIDATED SIGNALS
                             ============================================ -->
                        <div class='signals-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-signal'></i> Consolidated Trading Signals (Based on All Indicators)
                                <span class='help-icon' onclick='openModal("modalSignals")'>?</span>
                            </h3>
                            
                            <div class='signal-gauge'>
                                <div class='gauge-header'>
                                    <h4>Overall Market Signal</h4>
                                </div>
                                <div class='gauge-container'>
                                    <div class='gauge-bar'>
                                        <div class='gauge-fill' id='gaugeFill' style='width: 50%'></div>
                                    </div>
                                    <div class='gauge-value' id='gaugeValue'>NEUTRAL</div>
                                </div>
                            </div>
                            
                            <div class='signals-breakdown' id='signalsBreakdown'>
                                <!-- Rempli dynamiquement -->
                            </div>
                        </div>
                        
                        <!-- ============================================
                             ðŸ“ˆ SECTION 1: MOMENTUM OSCILLATORS
                             ============================================ -->
                        <div class='chart-section'>
                            <h2 class='category-title'>
                                <i class='fas fa-tachometer-alt'></i> Momentum Oscillators
                            </h2>
                        </div>
                        
                        <!-- RSI & MACD Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- RSI -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-chart-line'></i> RSI - Relative Strength Index
                                    <span class='help-icon' onclick='openModal("modalRSI")'>?</span>
                                </h3>
                                <div id='rsiChart' class='chart'></div>
                                <div class='signal-box' id='rsiSignal'>Calculating...</div>
                            </div>
                            
                            <!-- MACD -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-wave-square'></i> MACD - Moving Average Convergence Divergence
                                    <span class='help-icon' onclick='openModal("modalMACD")'>?</span>
                                </h3>
                                <div id='macdChart' class='chart'></div>
                                <div class='signal-box' id='macdSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- Stochastic & Williams Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- Stochastic -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-wave-square'></i> Stochastic Oscillator
                                    <span class='help-icon' onclick='openModal("modalStochastic")'>?</span>
                                </h3>
                                <div id='stochasticChart' class='chart'></div>
                                <div class='signal-box' id='stochasticSignal'>Calculating...</div>
                            </div>
                            
                            <!-- Williams %R -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-chart-line'></i> Williams %R
                                    <span class='help-icon' onclick='openModal("modalWilliams")'>?</span>
                                </h3>
                                <div id='williamsChart' class='chart'></div>
                                <div class='signal-box' id='williamsSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- MFI, CCI, Ultimate Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- MFI -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-coins'></i> MFI - Money Flow Index
                                    <span class='help-icon' onclick='openModal("modalMFI")'>?</span>
                                </h3>
                                <div id='mfiChart' class='chart'></div>
                                <div class='signal-box' id='mfiSignal'>Calculating...</div>
                            </div>
                            
                            <!-- CCI -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-chart-area'></i> CCI - Commodity Channel Index
                                    <span class='help-icon' onclick='openModal("modalCCI")'>?</span>
                                </h3>
                                <div id='cciChart' class='chart'></div>
                                <div class='signal-box' id='cciSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- Ultimate & ROC Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- Ultimate Oscillator -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-layer-group'></i> Ultimate Oscillator
                                    <span class='help-icon' onclick='openModal("modalUltimate")'>?</span>
                                </h3>
                                <div id='ultimateChart' class='chart'></div>
                                <div class='signal-box' id='ultimateSignal'>Calculating...</div>
                            </div>
                            
                            <!-- ROC -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-percentage'></i> ROC - Rate of Change
                                    <span class='help-icon' onclick='openModal("modalROC")'>?</span>
                                </h3>
                                <div id='rocChart' class='chart'></div>
                                <div class='signal-box' id='rocSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- ============================================
                             ðŸ“Š SECTION 2: TREND INDICATORS
                             ============================================ -->
                        <div class='chart-section'>
                            <h2 class='category-title'>
                                <i class='fas fa-chart-line'></i> Trend Indicators
                            </h2>
                        </div>
                        
                        <!-- Ichimoku Cloud -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-cloud'></i> Ichimoku Cloud
                                <span class='help-icon' onclick='openModal("modalIchimoku")'>?</span>
                            </h3>
                            <div id='ichimokuChart' class='chart'></div>
                        </div>
                        
                        <!-- ADX & SAR Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- ADX -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-chart-area'></i> ADX - Trend Strength
                                    <span class='help-icon' onclick='openModal("modalADX")'>?</span>
                                </h3>
                                <div id='adxChart' class='chart'></div>
                                <div class='signal-box' id='adxSignal'>Calculating...</div>
                            </div>
                            
                            <!-- Parabolic SAR -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-dot-circle'></i> Parabolic SAR
                                    <span class='help-icon' onclick='openModal("modalSAR")'>?</span>
                                </h3>
                                <div id='sarChart' class='chart'></div>
                                <div class='signal-box' id='sarSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- Aroon Indicator -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-arrows-alt-h'></i> Aroon Indicator
                                <span class='help-icon' onclick='openModal("modalAroon")'>?</span>
                            </h3>
                            <div id='aroonChart' class='chart'></div>
                            <div class='signal-box' id='aroonSignal'>Calculating...</div>
                        </div>
                        
                        <!-- Moving Averages -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-bezier-curve'></i> Moving Averages (Multiple Timeframes)
                                <span class='help-icon' onclick='openModal("modalMovingAverages")'>?</span>
                            </h3>
                            <div id='movingAveragesChart' class='chart'></div>
                            <div class='signal-box' id='movingAveragesSignal'>Calculating...</div>
                        </div>
                        
                        <!-- Linear Regression -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-chart-line'></i> Linear Regression Channel
                                <span class='help-icon' onclick='openModal("modalLinearRegression")'>?</span>
                            </h3>
                            <div id='linearRegressionChart' class='chart'></div>
                            <div class='signal-box' id='linearRegressionSignal'>Calculating...</div>
                        </div>
                        
                        <!-- ============================================
                             ðŸŽ¯ SECTION 3: VOLATILITY & CHANNELS
                             ============================================ -->
                        <div class='chart-section'>
                            <h2 class='category-title'>
                                <i class='fas fa-arrows-alt-v'></i> Volatility & Channels
                            </h2>
                        </div>
                        
                        <!-- Bollinger Bands -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-compress-arrows-alt'></i> Bollinger Bands
                                <span class='help-icon' onclick='openModal("modalBollinger")'>?</span>
                            </h3>
                            <div id='bollingerChart' class='chart'></div>
                            <div class='signal-box' id='bollingerSignal'>Calculating...</div>
                        </div>
                        
                        <!-- Keltner & Donchian Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- Keltner Channels -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-stream'></i> Keltner Channels
                                    <span class='help-icon' onclick='openModal("modalKeltner")'>?</span>
                                </h3>
                                <div id='keltnerChart' class='chart'></div>
                                <div class='signal-box' id='keltnerSignal'>Calculating...</div>
                            </div>
                            
                            <!-- Donchian Channels -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-grip-lines'></i> Donchian Channels
                                    <span class='help-icon' onclick='openModal("modalDonchian")'>?</span>
                                </h3>
                                <div id='donchianChart' class='chart'></div>
                                <div class='signal-box' id='donchianSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- ATR -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-arrows-alt-v'></i> Average True Range (ATR)
                                <span class='help-icon' onclick='openModal("modalATR")'>?</span>
                            </h3>
                            <div id='atrChart' class='chart'></div>
                            <div class='signal-box' id='atrSignal'>Calculating...</div>
                        </div>
                        
                        <!-- ============================================
                             ðŸ“Š SECTION 4: VOLUME ANALYSIS
                             ============================================ -->
                        <div class='chart-section'>
                            <h2 class='category-title'>
                                <i class='fas fa-chart-bar'></i> Volume Analysis
                            </h2>
                        </div>
                        
                        <!-- OBV & CMF Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- OBV -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-chart-bar'></i> On-Balance Volume
                                    <span class='help-icon' onclick='openModal("modalOBV")'>?</span>
                                </h3>
                                <div id='obvChart' class='chart'></div>
                                <div class='signal-box' id='obvSignal'>Calculating...</div>
                            </div>
                            
                            <!-- CMF -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-water'></i> CMF - Chaikin Money Flow
                                    <span class='help-icon' onclick='openModal("modalCMF")'>?</span>
                                </h3>
                                <div id='cmfChart' class='chart'></div>
                                <div class='signal-box' id='cmfSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- VWAP -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-balance-scale-right'></i> VWAP with Standard Deviation Bands
                                <span class='help-icon' onclick='openModal("modalVWAP")'>?</span>
                            </h3>
                            <div id='vwapChart' class='chart'></div>
                            <div class='signal-box' id='vwapSignal'>Calculating...</div>
                        </div>
                        
                        <!-- Volume Profile -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-layer-group'></i> Volume Profile - Price Distribution
                                <span class='help-icon' onclick='openModal("modalVolumeProfile")'>?</span>
                            </h3>
                            <div id='volumeProfileChart' class='chart'></div>
                            <div class='signal-box' id='volumeProfileSignal'>Calculating...</div>
                        </div>
                        
                        <!-- Elder Ray -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-balance-scale'></i> Elder Ray Index - Bull & Bear Power
                                <span class='help-icon' onclick='openModal("modalElderRay")'>?</span>
                            </h3>
                            <div id='elderRayChart' class='chart'></div>
                            <div class='signal-box' id='elderRaySignal'>Calculating...</div>
                        </div>
                        
                        <!-- ============================================
                             ðŸŽ¯ SECTION 5: SUPPORT/RESISTANCE & PATTERNS
                             ============================================ -->
                        <div class='chart-section'>
                            <h2 class='category-title'>
                                <i class='fas fa-crosshairs'></i> Support/Resistance & Patterns
                            </h2>
                        </div>
                        
                        <!-- Fibonacci Retracements -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-ruler-combined'></i> Fibonacci Retracements
                                <span class='help-icon' onclick='openModal("modalFibonacci")'>?</span>
                            </h3>
                            <div id='fibonacciChart' class='chart'></div>
                            <div id='fibonacciLevels' class='fibonacci-table'></div>
                        </div>
                        
                        <!-- Pivot Points -->
                        <div class='pivot-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-crosshairs'></i> Pivot Points
                                <span class='help-icon' onclick='openModal("modalPivots")'>?</span>
                            </h3>
                            
                            <div class='pivot-grid'>
                                <div class='pivot-card' id='pivotStandard'>
                                    <h4>Standard Pivots</h4>
                                    <div class='pivot-values'></div>
                                </div>
                                
                                <div class='pivot-card' id='pivotFibonacci'>
                                    <h4>Fibonacci Pivots</h4>
                                    <div class='pivot-values'></div>
                                </div>
                                
                                <div class='pivot-card' id='pivotCamarilla'>
                                    <h4>Camarilla Pivots</h4>
                                    <div class='pivot-values'></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Support/Resistance Detection -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-layer-group'></i> Automatic Support & Resistance Detection
                                <span class='help-icon' onclick='openModal("modalSupportResistance")'>?</span>
                            </h3>
                            <div id='supportResistance' class='sr-container'>
                                <!-- Rempli dynamiquement -->
                            </div>
                        </div>
                        
                        <!-- Candlestick Patterns -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-bars'></i> Candlestick Pattern Detection
                                <span class='help-icon' onclick='openModal("modalCandlestickPatterns")'>?</span>
                            </h3>
                            <div id='candlestickPatterns' class='patterns-container'>
                                <!-- Rempli dynamiquement -->
                            </div>
                        </div>
                        
                        <!-- Divergences -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-exchange-alt'></i> Divergence Detection
                                <span class='help-icon' onclick='openModal("modalDivergences")'>?</span>
                            </h3>
                            <div id='divergences' class='divergences-container'>
                                <!-- Rempli dynamiquement -->
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                <!-- Footer -->
                <footer>
                    <p>Advanced Technical Analysis - Wall Street Edition | 40+ Professional Indicators</p>
                </footer>
            </div>
        </div>
        
    </div>
    
    <!-- ============================================
         ðŸ†• MODALS - PORTFOLIO, WATCHLIST & ALERTS
         ============================================ -->
    
    <!-- Modal: Create Portfolio -->
    <div id='modalCreatePortfolio' class='modal'>
        <div class='modal-content modal-small'>
            <div class='modal-header'>
                <h2><i class='fas fa-folder-plus'></i> Create New Portfolio</h2>
                <span class='close-modal' onclick='closeModal("modalCreatePortfolio")'>&times;</span>
            </div>
            <div class='modal-body'>
                <div class='form-group'>
                    <label>Portfolio Name</label>
                    <input type='text' id='newPortfolioName' placeholder='e.g., Tech Stocks, Dividend Portfolio...' class='form-input'>
                </div>
                <div class='modal-actions'>
                    <button class='btn-cancel' onclick='closeModal("modalCreatePortfolio")'>Cancel</button>
                    <button class='btn-confirm' onclick='PortfolioManager.createPortfolio()'>
                        <i class='fas fa-check'></i> Create
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Manage Portfolios -->
    <div id='modalManagePortfolios' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2><i class='fas fa-cog'></i> Manage Portfolios</h2>
                <span class='close-modal' onclick='closeModal("modalManagePortfolios")'>&times;</span>
            </div>
            <div class='modal-body'>
                <div id='portfoliosListManage' class='portfolios-manage-list'>
                    <!-- Rempli dynamiquement -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Create Price Alert -->
    <div id='modalCreateAlert' class='modal'>
        <div class='modal-content modal-small'>
            <div class='modal-header'>
                <h2><i class='fas fa-bell'></i> Create Price Alert</h2>
                <span class='close-modal' onclick='closeModal("modalCreateAlert")'>&times;</span>
            </div>
            <div class='modal-body'>
                <div class='form-group'>
                    <label>Stock Symbol</label>
                    <input type='text' id='alertSymbol' placeholder='e.g., AAPL' class='form-input' style='text-transform: uppercase;'>
                </div>
                <div class='form-group'>
                    <label>Alert Condition</label>
                    <select id='alertCondition' class='form-input'>
                        <option value='above'>Price goes above</option>
                        <option value='below'>Price goes below</option>
                    </select>
                </div>
                <div class='form-group'>
                    <label>Target Price ($)</label>
                    <input type='number' id='alertTargetPrice' placeholder='e.g., 150.00' class='form-input' step='0.01'>
                </div>
                <div class='modal-actions'>
                    <button class='btn-cancel' onclick='closeModal("modalCreateAlert")'>Cancel</button>
                    <button class='btn-confirm' onclick='AlertsManager.createAlert()'>
                        <i class='fas fa-check'></i> Create Alert
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ============================================
         ðŸ“š MODALS - TOUS LES INDICATEURS TECHNIQUES
         ============================================ -->

    <!-- Modal Introduction -->
    <div id='modalIntro' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“Š Advanced Technical Analysis - Wall Street Edition</h2>
                <span class='close-modal' onclick='closeModal("modalIntro")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>ðŸš€ What is This Platform?</h3>
                <p>This is a <span class='key-term'>professional-grade technical analysis platform</span> featuring <strong>40+ institutional-level indicators</strong> used by hedge funds, prop traders, and Wall Street analysts.</p>
                
                <h3>ðŸ”¥ 40+ Available Indicators</h3>
                
                <h4>ðŸ“ˆ Momentum Oscillators (8)</h4>
                <ul>
                    <li>RSI - Relative Strength Index</li>
                    <li>MACD - Moving Average Convergence Divergence</li>
                    <li>Stochastic Oscillator</li>
                    <li>Williams %R</li>
                    <li>MFI - Money Flow Index</li>
                    <li>CCI - Commodity Channel Index</li>
                    <li>Ultimate Oscillator</li>
                    <li>ROC - Rate of Change</li>
                </ul>
                
                <h4>ðŸ“Š Trend Indicators (7)</h4>
                <ul>
                    <li>Ichimoku Cloud</li>
                    <li>ADX - Average Directional Index</li>
                    <li>Parabolic SAR</li>
                    <li>Aroon Indicator</li>
                    <li>Moving Averages (SMA 20/50/200, EMA 9/21)</li>
                    <li>Linear Regression Channel</li>
                </ul>
                
                <h4>ðŸŽ¯ Volatility & Channels (4)</h4>
                <ul>
                    <li>Bollinger Bands</li>
                    <li>Keltner Channels</li>
                    <li>Donchian Channels</li>
                    <li>ATR - Average True Range</li>
                </ul>
                
                <h4>ðŸ“Š Volume Analysis (5)</h4>
                <ul>
                    <li>OBV - On-Balance Volume</li>
                    <li>CMF - Chaikin Money Flow</li>
                    <li>VWAP - Volume Weighted Average Price</li>
                    <li>Volume Profile</li>
                    <li>Elder Ray Index (Bull/Bear Power)</li>
                </ul>
                
                <h4>ðŸŽ¯ Support/Resistance & Patterns (5)</h4>
                <ul>
                    <li>Fibonacci Retracements</li>
                    <li>Pivot Points (Standard, Fibonacci, Camarilla)</li>
                    <li>Automatic Support/Resistance Detection</li>
                    <li>Candlestick Pattern Recognition (20+ patterns)</li>
                    <li>Divergence Detection</li>
                </ul>
                
                <h3>ðŸ“ˆ How to Use</h3>
                <ol>
                    <li><strong>Search:</strong> Enter a stock symbol or company name</li>
                    <li><strong>Period:</strong> Select analysis timeframe (1M to 5Y)</li>
                    <li><strong>Analyze:</strong> Click "Analyze Stock"</li>
                    <li><strong>Review:</strong> Consolidated signals + individual indicators</li>
                    <li><strong>Decide:</strong> Make informed trading decisions</li>
                </ol>
                
                <div class='warning-box'>
                    âš  <strong>Important:</strong> Technical analysis should complement fundamental analysis and proper risk management. Past performance doesn't guarantee future results.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Signals (AMÃ‰LIORÃ‰) -->
    <div id='modalSignals' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸŽ¯ Consolidated Trading Signals</h2>
                <span class='close-modal' onclick='closeModal("modalSignals")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>How Signals Are Calculated</h3>
                <p>The <span class='key-term'>Consolidated Signal</span> aggregates <strong>40+ technical indicators</strong> to provide an overall market sentiment with institutional-grade accuracy.</p>
                
                <h3>Signal Categories</h3>
                <ul>
                    <li><strong>STRONG BUY (80-100%):</strong> Overwhelming bullish consensus across all indicator categories</li>
                    <li><strong>BUY (60-80%):</strong> Clear bullish majority - favorable entry conditions</li>
                    <li><strong>NEUTRAL (40-60%):</strong> Mixed signals - consolidation or uncertainty</li>
                    <li><strong>SELL (20-40%):</strong> Clear bearish majority - exit warning</li>
                    <li><strong>STRONG SELL (0-20%):</strong> Overwhelming bearish consensus - strong exit signal</li>
                </ul>
                
                <h3>Indicators Analyzed (40+)</h3>
                <p>Each indicator contributes <strong>+1 (bullish)</strong>, <strong>0 (neutral)</strong>, or <strong>-1 (bearish)</strong> to the final score:</p>
                
                <h4>ðŸ“ˆ Momentum (8 indicators)</h4>
                <ul>
                    <li>RSI (overbought/oversold levels)</li>
                    <li>MACD (histogram direction & crossovers)</li>
                    <li>Stochastic (K/D crossovers & zones)</li>
                    <li>Williams %R (momentum zones)</li>
                    <li>MFI (money flow strength)</li>
                    <li>CCI (channel extremes)</li>
                    <li>Ultimate Oscillator (multi-timeframe momentum)</li>
                    <li>ROC (momentum direction)</li>
                </ul>
                
                <h4>ðŸ“Š Trend (6 indicators)</h4>
                <ul>
                    <li>Ichimoku Cloud (price vs cloud position)</li>
                    <li>ADX (trend strength & direction)</li>
                    <li>Parabolic SAR (price vs SAR position)</li>
                    <li>Aroon (up/down strength)</li>
                    <li>Moving Averages (price vs SMA/EMA alignment)</li>
                </ul>
                
                <h4>ðŸ“Š Volume (5 indicators)</h4>
                <ul>
                    <li>OBV (volume trend direction)</li>
                    <li>CMF (money flow accumulation/distribution)</li>
                    <li>VWAP (price vs institutional levels)</li>
                    <li>Elder Ray (bull/bear power)</li>
                </ul>
                
                <h3>Calculation Formula</h3>
                <div class='formula-box'>
                    Signal % = [(Total Signal Score + Max Indicators) / (2 Ã— Max Indicators)] Ã— 100<br><br>
                    Example: 15 bullish, 5 neutral, 5 bearish out of 25 indicators<br>
                    Signal Score = (+15) + (0) + (-5) = +10<br>
                    Signal % = [(10 + 25) / (2 Ã— 25)] Ã— 100 = 70% â†’ <strong>BUY</strong>
                </div>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> Wait for signals above 70% or below 30% for highest probability trades. Use multiple timeframes for confirmation.
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         ðŸ“ˆ MOMENTUM OSCILLATORS MODALS
         ============================================ -->

    <!-- Modal RSI -->
    <div id='modalRSI' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“Š RSI - Relative Strength Index</h2>
                <span class='close-modal' onclick='closeModal("modalRSI")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is RSI?</h3>
                <p>The <span class='key-term'>Relative Strength Index</span> is a momentum oscillator developed by J. Welles Wilder that measures the speed and magnitude of price changes. It's one of the most popular technical indicators.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Step 1: Calculate Price Changes</strong><br>
                    Gain = Price(today) - Price(yesterday) if positive, else 0<br>
                    Loss = |Price(today) - Price(yesterday)| if negative, else 0<br><br>
                    
                    <strong>Step 2: Calculate Average Gains & Losses (14 periods)</strong><br>
                    First Avg Gain = Sum of Gains / 14<br>
                    First Avg Loss = Sum of Losses / 14<br><br>
                    
                    <strong>Step 3: Smooth Averages</strong><br>
                    Avg Gain = [(Previous Avg Gain Ã— 13) + Current Gain] / 14<br>
                    Avg Loss = [(Previous Avg Loss Ã— 13) + Current Loss] / 14<br><br>
                    
                    <strong>Step 4: Calculate RS and RSI</strong><br>
                    RS = Avg Gain / Avg Loss<br>
                    RSI = 100 - [100 / (1 + RS)]<br><br>
                    
                    <strong>Range:</strong> 0 to 100
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>RSI > 70:</strong> Overbought zone - potential reversal down (sell signal)</li>
                    <li><strong>RSI < 30:</strong> Oversold zone - potential reversal up (buy signal)</li>
                    <li><strong>RSI 50:</strong> Neutral zone - market equilibrium</li>
                    <li><strong>RSI crossing above 30:</strong> Bullish reversal signal</li>
                    <li><strong>RSI crossing below 70:</strong> Bearish reversal signal</li>
                </ul>
                
                <h3>Advanced Techniques</h3>
                <ul>
                    <li><strong>Divergence:</strong> Price makes higher highs but RSI makes lower highs = bearish divergence (sell)</li>
                    <li><strong>Hidden Divergence:</strong> Price makes lower lows but RSI makes higher lows = bullish (continuation)</li>
                    <li><strong>Centerline Crossover:</strong> RSI crossing above 50 = bullish momentum</li>
                    <li><strong>Failure Swings:</strong> RSI fails to reach overbought/oversold = reversal warning</li>
                </ul>
                
                <div class='warning-box'>
                    âš  <strong>Warning:</strong> In strong trends, RSI can remain overbought (>70) or oversold (<30) for extended periods. Always confirm with trend indicators.
                </div>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> Use RSI 80/20 levels for stocks, 70/30 for indices. In strong uptrends, wait for RSI to dip to 40-50 for entries.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal MACD -->
    <div id='modalMACD' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“ˆ MACD - Moving Average Convergence Divergence</h2>
                <span class='close-modal' onclick='closeModal("modalMACD")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is MACD?</h3>
                <p>The <span class='key-term'>MACD</span> is a trend-following momentum indicator developed by Gerald Appel that shows the relationship between two exponential moving averages. It's one of the most powerful indicators for trend identification.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Step 1: Calculate EMAs</strong><br>
                    EMA(12) = 12-period Exponential Moving Average<br>
                    EMA(26) = 26-period Exponential Moving Average<br>
                    Multiplier = 2 / (Period + 1)<br>
                    EMA = [Close - EMA(previous)] Ã— Multiplier + EMA(previous)<br><br>
                    
                    <strong>Step 2: Calculate MACD Line</strong><br>
                    MACD Line = EMA(12) - EMA(26)<br><br>
                    
                    <strong>Step 3: Calculate Signal Line</strong><br>
                    Signal Line = 9-period EMA of MACD Line<br><br>
                    
                    <strong>Step 4: Calculate Histogram</strong><br>
                    MACD Histogram = MACD Line - Signal Line
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>MACD Line crosses above Signal Line:</strong> BULLISH CROSSOVER - Buy Signal</li>
                    <li><strong>MACD Line crosses below Signal Line:</strong> BEARISH CROSSOVER - Sell Signal</li>
                    <li><strong>Histogram > 0 and increasing:</strong> Bullish momentum strengthening</li>
                    <li><strong>Histogram < 0 and decreasing:</strong> Bearish momentum strengthening</li>
                    <li><strong>Histogram crossing zero:</strong> Momentum shift confirmation</li>
                    <li><strong>MACD crossing zero line:</strong> Trend change confirmation</li>
                </ul>
                
                <h3>Advanced Signals</h3>
                <ul>
                    <li><strong>Bullish Divergence:</strong> Price makes lower lows, MACD makes higher lows â†’ Reversal up</li>
                    <li><strong>Bearish Divergence:</strong> Price makes higher highs, MACD makes lower highs â†’ Reversal down</li>
                    <li><strong>Zero Line Rejection:</strong> MACD bounces at zero line â†’ Strong trend continuation</li>
                    <li><strong>Histogram Peak:</strong> Highest bar before reversal â†’ Momentum exhaustion</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> MACD works best in trending markets. Combine with ADX (>25) for confirmation. In sideways markets, use RSI instead.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Bollinger Bands -->
    <div id='modalBollinger' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“Š Bollinger Bands</h2>
                <span class='close-modal' onclick='closeModal("modalBollinger")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What are Bollinger Bands?</h3>
                <p>Developed by John Bollinger, <span class='key-term'>Bollinger Bands</span> are volatility bands placed above and below a moving average. They expand and contract based on market volatility.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Default Settings: 20-period, 2 standard deviations</strong><br><br>
                    
                    <strong>Step 1: Calculate Middle Band (SMA)</strong><br>
                    Middle Band = 20-period Simple Moving Average<br><br>
                    
                    <strong>Step 2: Calculate Standard Deviation</strong><br>
                    Variance = Î£[(Price - SMA)Â²] / 20<br>
                    Standard Deviation (Ïƒ) = âˆšVariance<br><br>
                    
                    <strong>Step 3: Calculate Bands</strong><br>
                    Upper Band = Middle Band + (2 Ã— Ïƒ)<br>
                    Lower Band = Middle Band - (2 Ã— Ïƒ)<br><br>
                    
                    <strong>Step 4: Calculate %B (Optional)</strong><br>
                    %B = (Price - Lower Band) / (Upper Band - Lower Band)<br>
                    Range: 0 to 1 (or 0% to 100%)
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>Price touches Upper Band:</strong> Overbought - potential sell signal</li>
                    <li><strong>Price touches Lower Band:</strong> Oversold - potential buy signal</li>
                    <li><strong>Price above Middle Band:</strong> Bullish territory</li>
                    <li><strong>Price below Middle Band:</strong> Bearish territory</li>
                    <li><strong>Bands squeezing (narrow):</strong> Low volatility - breakout coming (Bollinger Squeeze)</li>
                    <li><strong>Bands expanding (wide):</strong> High volatility - strong trend</li>
                </ul>
                
                <h3>Advanced Strategies</h3>
                <ul>
                    <li><strong>Double Top/Bottom at Bands:</strong> Strong reversal signal</li>
                    <li><strong>Walking the Bands:</strong> In strong trends, price "walks" along upper/lower band</li>
                    <li><strong>M-Top (W-Bottom):</strong> Price makes 2 touches at upper (lower) band = reversal</li>
                    <li><strong>Bandwidth < 5%:</strong> Extreme squeeze - major breakout imminent</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> 95% of price action occurs within 2 standard deviations. A move outside bands is significant but NOT automatically a reversal signal in strong trends.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal MFI -->
    <div id='modalMFI' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ’° MFI - Money Flow Index</h2>
                <span class='close-modal' onclick='closeModal("modalMFI")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is MFI?</h3>
                <p>The <span class='key-term'>Money Flow Index</span> is a volume-weighted version of RSI that measures buying and selling pressure. It's often called the "volume-weighted RSI".</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Step 1: Calculate Typical Price</strong><br>
                    Typical Price = (High + Low + Close) / 3<br><br>
                    
                    <strong>Step 2: Calculate Money Flow</strong><br>
                    Money Flow = Typical Price Ã— Volume<br><br>
                    
                    <strong>Step 3: Identify Positive/Negative Money Flow (14 periods)</strong><br>
                    If Typical Price(today) > Typical Price(yesterday):<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;Positive Money Flow = Money Flow<br>
                    Else:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;Negative Money Flow = Money Flow<br><br>
                    
                    <strong>Step 4: Calculate Money Flow Ratio</strong><br>
                    Money Flow Ratio = (14-period Positive MF) / (14-period Negative MF)<br><br>
                    
                    <strong>Step 5: Calculate MFI</strong><br>
                    MFI = 100 - [100 / (1 + Money Flow Ratio)]<br><br>
                    
                    <strong>Range:</strong> 0 to 100
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>MFI > 80:</strong> OVERBOUGHT - Strong selling pressure expected</li>
                    <li><strong>MFI < 20:</strong> OVERSOLD - Strong buying pressure expected</li>
                    <li><strong>MFI > 50:</strong> Positive money flow - buyers in control</li>
                    <li><strong>MFI < 50:</strong> Negative money flow - sellers in control</li>
                </ul>
                
                <h3>Advanced Signals</h3>
                <ul>
                    <li><strong>Bullish Divergence:</strong> Price makes lower low, MFI makes higher low â†’ Buy signal</li>
                    <li><strong>Bearish Divergence:</strong> Price makes higher high, MFI makes lower high â†’ Sell signal</li>
                    <li><strong>Failure Swing:</strong> MFI goes above 80, drops below 80, rallies but fails to exceed 80 = top</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> MFI is superior to RSI when volume is significant. Use it for stocks with high trading volume. Divergences are extremely powerful signals.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal CCI -->
    <div id='modalCCI' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“Š CCI - Commodity Channel Index</h2>
                <span class='close-modal' onclick='closeModal("modalCCI")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is CCI?</h3>
                <p>Developed by Donald Lambert, the <span class='key-term'>Commodity Channel Index</span> measures the variation of price from its statistical mean. Despite its name, it works on all instruments, not just commodities.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Default Period: 20</strong><br><br>
                    
                    <strong>Step 1: Calculate Typical Price</strong><br>
                    TP = (High + Low + Close) / 3<br><br>
                    
                    <strong>Step 2: Calculate SMA of Typical Price</strong><br>
                    SMA(TP) = 20-period Simple Moving Average of TP<br><br>
                    
                    <strong>Step 3: Calculate Mean Deviation</strong><br>
                    Mean Deviation = (Î£|TP - SMA(TP)|) / 20<br><br>
                    
                    <strong>Step 4: Calculate CCI</strong><br>
                    CCI = (TP - SMA(TP)) / (0.015 Ã— Mean Deviation)<br><br>
                    
                    <em>Note: 0.015 is a constant to ensure ~70-80% of values fall between -100 and +100</em>
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>CCI > +100:</strong> OVERBOUGHT - Price unusually high, potential reversal</li>
                    <li><strong>CCI < -100:</strong> OVERSOLD - Price unusually low, potential reversal</li>
                    <li><strong>CCI crossing above 0:</strong> Bullish signal</li>
                    <li><strong>CCI crossing below 0:</strong> Bearish signal</li>
                    <li><strong>CCI > +200:</strong> Extreme overbought - very strong reversal signal</li>
                    <li><strong>CCI < -200:</strong> Extreme oversold - very strong reversal signal</li>
                </ul>
                
                <h3>Trading Strategies</h3>
                <ul>
                    <li><strong>Basic Strategy:</strong> Buy when CCI crosses above -100, sell when crosses below +100</li>
                    <li><strong>Extreme Strategy:</strong> Buy when CCI < -200, sell when CCI > +200</li>
                    <li><strong>Trend Following:</strong> Use CCI crossover of 0 line for trend direction</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> CCI is unbounded (no fixed range), so extreme readings (+300, -300) indicate very strong trends. Don't fight these moves!
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Ultimate Oscillator -->
    <div id='modalUltimate' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸŽ¯ Ultimate Oscillator</h2>
                <span class='close-modal' onclick='closeModal("modalUltimate")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is the Ultimate Oscillator?</h3>
                <p>Developed by Larry Williams, the <span class='key-term'>Ultimate Oscillator</span> is a momentum oscillator that uses weighted averages of three different timeframes to reduce false signals and volatility.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Default Periods: 7, 14, 28</strong><br><br>
                    
                    <strong>Step 1: Calculate Buying Pressure (BP) and True Range (TR)</strong><br>
                    BP = Close - MIN(Low, Previous Close)<br>
                    TR = MAX(High, Previous Close) - MIN(Low, Previous Close)<br><br>
                    
                    <strong>Step 2: Calculate Averages for each timeframe</strong><br>
                    Avg7 = (Sum of 7-period BP) / (Sum of 7-period TR)<br>
                    Avg14 = (Sum of 14-period BP) / (Sum of 14-period TR)<br>
                    Avg28 = (Sum of 28-period BP) / (Sum of 28-period TR)<br><br>
                    
                    <strong>Step 3: Calculate Ultimate Oscillator</strong><br>
                    UO = 100 Ã— [(4 Ã— Avg7) + (2 Ã— Avg14) + Avg28] / (4 + 2 + 1)<br><br>
                    
                    <strong>Range:</strong> 0 to 100
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>UO > 70:</strong> Overbought - potential sell signal</li>
                    <li><strong>UO < 30:</strong> Oversold - potential buy signal</li>
                    <li><strong>Bullish Divergence:</strong> Price makes lower low, UO makes higher low â†’ Buy</li>
                    <li><strong>Bearish Divergence:</strong> Price makes higher high, UO makes lower high â†’ Sell</li>
                </ul>
                
                <h3>Larry Williams' Buy Signal (3 conditions)</h3>
                <ol>
                    <li>Bullish divergence occurs (price makes lower low, UO makes higher low)</li>
                    <li>During divergence, UO falls below 30</li>
                    <li>UO then rises above the high reached during the divergence</li>
                </ol>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> The multi-timeframe approach makes this oscillator less prone to false signals than single-period oscillators like RSI or Stochastic.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ROC -->
    <div id='modalROC' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“ˆ ROC - Rate of Change</h2>
                <span class='close-modal' onclick='closeModal("modalROC")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is ROC?</h3>
                <p>The <span class='key-term'>Rate of Change</span> is a pure momentum oscillator that measures the percentage change in price from one period to another. It's one of the simplest yet most effective momentum indicators.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Default Period: 12</strong><br><br>
                    
                    <strong>Formula:</strong><br>
                    ROC = [(Close(today) - Close(n periods ago)) / Close(n periods ago)] Ã— 100<br><br>
                    
                    <strong>Example (12-period ROC):</strong><br>
                    Today's Close = $150<br>
                    Close 12 days ago = $140<br>
                    ROC = [($150 - $140) / $140] Ã— 100 = 7.14%<br><br>
                    
                    <strong>Range:</strong> Unbounded (typically -50% to +50%)
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>ROC > 0:</strong> Positive momentum - price trending up</li>
                    <li><strong>ROC < 0:</strong> Negative momentum - price trending down</li>
                    <li><strong>ROC crossing above 0:</strong> Bullish momentum shift - Buy signal</li>
                    <li><strong>ROC crossing below 0:</strong> Bearish momentum shift - Sell signal</li>
                    <li><strong>ROC > +10%:</strong> Strong upward momentum</li>
                    <li><strong>ROC < -10%:</strong> Strong downward momentum</li>
                </ul>
                
                <h3>Advanced Applications</h3>
                <ul>
                    <li><strong>Divergence:</strong> Price makes new high but ROC doesn't â†’ Bearish divergence</li>
                    <li><strong>Overbought/Oversold:</strong> Extreme ROC values (>+15%, <-15%) suggest reversal</li>
                    <li><strong>Trend Confirmation:</strong> Sustained positive ROC confirms uptrend</li>
                    <li><strong>Momentum Comparison:</strong> Compare ROC across multiple stocks for relative strength</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> ROC is excellent for comparing momentum across different stocks. Use 9-period for short-term, 25-period for medium-term analysis.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Aroon -->
    <div id='modalAroon' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“Š Aroon Indicator</h2>
                <span class='close-modal' onclick='closeModal("modalAroon")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is the Aroon Indicator?</h3>
                <p>Developed by Tushar Chande, the <span class='key-term'>Aroon Indicator</span> (Sanskrit for "dawn's early light") identifies when trends are likely to begin and measures trend strength.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Default Period: 25</strong><br><br>
                    
                    <strong>Aroon Up Formula:</strong><br>
                    Aroon Up = [(25 - Periods Since 25-period High) / 25] Ã— 100<br><br>
                    
                    <strong>Aroon Down Formula:</strong><br>
                    Aroon Down = [(25 - Periods Since 25-period Low) / 25] Ã— 100<br><br>
                    
                    <strong>Example:</strong><br>
                    25-period high occurred 3 days ago:<br>
                    Aroon Up = [(25 - 3) / 25] Ã— 100 = 88%<br><br>
                    
                    25-period low occurred 15 days ago:<br>
                    Aroon Down = [(25 - 15) / 25] Ã— 100 = 40%<br><br>
                    
                    <strong>Range:</strong> 0 to 100 (for both indicators)
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>Aroon Up > 70 & Aroon Down < 30:</strong> STRONG UPTREND</li>
                    <li><strong>Aroon Down > 70 & Aroon Up < 30:</strong> STRONG DOWNTREND</li>
                    <li><strong>Aroon Up crosses above Aroon Down:</strong> Bullish signal - uptrend starting</li>
                    <li><strong>Aroon Down crosses above Aroon Up:</strong> Bearish signal - downtrend starting</li>
                    <li><strong>Both indicators below 50:</strong> Consolidation - no clear trend</li>
                    <li><strong>Aroon Up = 100:</strong> New 25-period high TODAY (very strong)</li>
                    <li><strong>Aroon Down = 100:</strong> New 25-period low TODAY (very weak)</li>
                </ul>
                
                <h3>Aroon Oscillator (Optional)</h3>
                <div class='formula-box'>
                    Aroon Oscillator = Aroon Up - Aroon Down<br>
                    Range: -100 to +100<br><br>
                    > +50: Strong uptrend<br>
                    < -50: Strong downtrend
                </div>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> Aroon is excellent for identifying the START of new trends. Use it before ADX, which only confirms existing trends.
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         ðŸ“Š VOLATILITY & CHANNELS MODALS
         ============================================ -->

    <!-- Modal Keltner Channels -->
    <div id='modalKeltner' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“Š Keltner Channels</h2>
                <span class='close-modal' onclick='closeModal("modalKeltner")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What are Keltner Channels?</h3>
                <p>Developed by Chester Keltner, <span class='key-term'>Keltner Channels</span> are volatility-based envelopes set above and below an exponential moving average. Unlike Bollinger Bands, they use ATR instead of standard deviation.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Default Settings: 20-period EMA, 2Ã— ATR</strong><br><br>
                    
                    <strong>Step 1: Calculate Middle Line</strong><br>
                    Middle Line = 20-period EMA of Close<br><br>
                    
                    <strong>Step 2: Calculate ATR</strong><br>
                    TR = MAX[(High - Low), |High - Previous Close|, |Low - Previous Close|]<br>
                    ATR(14) = 14-period Average of True Range<br><br>
                    
                    <strong>Step 3: Calculate Channels</strong><br>
                    Upper Channel = EMA + (2 Ã— ATR)<br>
                    Lower Channel = EMA - (2 Ã— ATR)<br>
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>Price touches Upper Channel:</strong> Overbought - potential resistance</li>
                    <li><strong>Price touches Lower Channel:</strong> Oversold - potential support</li>
                    <li><strong>Price above Middle Line:</strong> Bullish trend</li>
                    <li><strong>Price below Middle Line:</strong> Bearish trend</li>
                    <li><strong>Breakout above Upper Channel:</strong> Very strong bullish signal (continuation likely)</li>
                    <li><strong>Breakdown below Lower Channel:</strong> Very strong bearish signal</li>
                </ul>
                
                <h3>Keltner vs Bollinger Bands</h3>
                <ul>
                    <li><strong>Keltner:</strong> Uses ATR (actual volatility) - smoother, less reactive</li>
                    <li><strong>Bollinger:</strong> Uses Std Dev (statistical) - more reactive to price spikes</li>
                    <li><strong>Strategy:</strong> When Bollinger Bands expand outside Keltner Channels = extreme volatility</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> Use Keltner Channels for trend-following strategies. When price consistently stays above upper channel, it's a strong uptrend - don't fight it!
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Donchian Channels -->
    <div id='modalDonchian' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“ˆ Donchian Channels</h2>
                <span class='close-modal' onclick='closeModal("modalDonchian")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What are Donchian Channels?</h3>
                <p>Developed by Richard Donchian, <span class='key-term'>Donchian Channels</span> are formed by the highest high and lowest low over a specified period. Used by the famous Turtle Traders.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Default Period: 20</strong><br><br>
                    
                    <strong>Upper Channel:</strong><br>
                    Highest High over the last 20 periods<br><br>
                    
                    <strong>Lower Channel:</strong><br>
                    Lowest Low over the last 20 periods<br><br>
                    
                    <strong>Middle Line (optional):</strong><br>
                    (Upper Channel + Lower Channel) / 2
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>Price breaks above Upper Channel:</strong> BREAKOUT - Strong buy signal (new 20-period high)</li>
                    <li><strong>Price breaks below Lower Channel:</strong> BREAKDOWN - Strong sell signal (new 20-period low)</li>
                    <li><strong>Price near Upper Channel:</strong> Strong uptrend - resistance level</li>
                    <li><strong>Price near Lower Channel:</strong> Strong downtrend - support level</li>
                    <li><strong>Narrow channel:</strong> Low volatility - breakout imminent</li>
                    <li><strong>Wide channel:</strong> High volatility - strong trending market</li>
                </ul>
                
                <h3>Turtle Trading Rules</h3>
                <ul>
                    <li><strong>System 1 (Aggressive):</strong> Enter long on 20-day high breakout, exit on 10-day low</li>
                    <li><strong>System 2 (Conservative):</strong> Enter long on 55-day high breakout, exit on 20-day low</li>
                    <li><strong>Principle:</strong> "Trade the breakouts" - follow new highs/lows</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> Donchian Channels are THE indicator for breakout trading. When price makes a new 20-period high, it's a powerful momentum signal. This is how the Turtles made millions!
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         ðŸ“Š VOLUME ANALYSIS MODALS
         ============================================ -->

    <!-- Modal CMF -->
    <div id='modalCMF' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ’§ CMF - Chaikin Money Flow</h2>
                <span class='close-modal' onclick='closeModal("modalCMF")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is Chaikin Money Flow?</h3>
                <p>Developed by Marc Chaikin, <span class='key-term'>CMF</span> measures the amount of Money Flow Volume over a specific period. It identifies buying and selling pressure.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Default Period: 20</strong><br><br>
                    
                    <strong>Step 1: Calculate Money Flow Multiplier</strong><br>
                    MFM = [(Close - Low) - (High - Close)] / (High - Low)<br>
                    Range: -1 to +1<br><br>
                    
                    <strong>Step 2: Calculate Money Flow Volume</strong><br>
                    MFV = MFM Ã— Volume<br><br>
                    
                    <strong>Step 3: Calculate CMF</strong><br>
                    CMF = (20-period Sum of MFV) / (20-period Sum of Volume)<br><br>
                    
                    <strong>Range:</strong> -1 to +1 (or -100% to +100%)
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>CMF > +0.05:</strong> STRONG BUYING PRESSURE - Accumulation phase</li>
                    <li><strong>CMF < -0.05:</strong> STRONG SELLING PRESSURE - Distribution phase</li>
                    <li><strong>CMF > 0:</strong> Buyers in control (positive money flow)</li>
                    <li><strong>CMF < 0:</strong> Sellers in control (negative money flow)</li>
                    <li><strong>CMF crossing above 0:</strong> Bullish signal - accumulation starting</li>
                    <li><strong>CMF crossing below 0:</strong> Bearish signal - distribution starting</li>
                </ul>
                
                <h3>Advanced Signals</h3>
                <ul>
                    <li><strong>Bullish Divergence:</strong> Price makes lower low, CMF makes higher low â†’ Reversal up</li>
                    <li><strong>Bearish Divergence:</strong> Price makes higher high, CMF makes lower high â†’ Reversal down</li>
                    <li><strong>CMF + Price Confirmation:</strong> Rising price + rising CMF = strong uptrend</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> CMF is more reliable than OBV because it considers WHERE the price closes within the range, not just up/down. Use it to confirm trends and spot institutional accumulation/distribution.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Volume Profile -->
    <div id='modalVolumeProfile' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“Š Volume Profile - Price Distribution</h2>
                <span class='close-modal' onclick='closeModal("modalVolumeProfile")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is Volume Profile?</h3>
                <p><span class='key-term'>Volume Profile</span> is an advanced charting tool that displays trading activity over a specified time period at specified price levels. It shows WHERE the most volume traded.</p>
                
                <h3>Key Components</h3>
                <ul>
                    <li><strong>POC (Point of Control):</strong> Price level with HIGHEST traded volume - peak of histogram</li>
                    <li><strong>Value Area (VA):</strong> Price range where 70% of volume traded</li>
                    <li><strong>VAH (Value Area High):</strong> Upper boundary of value area</li>
                    <li><strong>VAL (Value Area Low):</strong> Lower boundary of value area</li>
                    <li><strong>HVN (High Volume Node):</strong> Price levels with significant volume - strong support/resistance</li>
                    <li><strong>LVN (Low Volume Node):</strong> Price levels with little volume - price moves through quickly</li>
                </ul>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>Price at POC:</strong> FAIR VALUE - maximum acceptance, high liquidity</li>
                    <li><strong>Price above VA:</strong> BULLISH - buyers in control</li>
                    <li><strong>Price below VA:</strong> BEARISH - sellers in control</li>
                    <li><strong>Price approaching POC:</strong> Expect support/resistance</li>
                    <li><strong>Price in LVN:</strong> Fast movement expected (low liquidity)</li>
                    <li><strong>Price in HVN:</strong> Consolidation expected (high liquidity)</li>
                </ul>
                
                <h3>Trading Strategies</h3>
                <ul>
                    <li><strong>Mean Reversion:</strong> When price moves far from POC, expect return to POC</li>
                    <li><strong>Breakout Trading:</strong> Price breaking above VAH or below VAL = strong signal</li>
                    <li><strong>Support/Resistance:</strong> Use HVN levels as support/resistance zones</li>
                    <li><strong>Trend Confirmation:</strong> POC rising = uptrend, POC falling = downtrend</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> Volume Profile is used by institutional traders to identify fair value. The POC acts like a magnet - price often returns to it. HVN levels are STRONG support/resistance.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Elder Ray -->
    <div id='modalElderRay' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>âš– Elder Ray Index - Bull & Bear Power</h2>
                <span class='close-modal' onclick='closeModal("modalElderRay")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is the Elder Ray Index?</h3>
                <p>Developed by Dr. Alexander Elder, this indicator measures the <span class='key-term'>power of bulls and bears</span> in the market by comparing price extremes to an exponential moving average.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Default: 13-period EMA</strong><br><br>
                    
                    <strong>Bull Power Formula:</strong><br>
                    Bull Power = High - EMA(13)<br><br>
                    
                    <strong>Bear Power Formula:</strong><br>
                    Bear Power = Low - EMA(13)<br><br>
                    
                    <strong>Interpretation:</strong><br>
                    Bull Power > 0: Bulls pushing above average<br>
                    Bear Power < 0: Bears pushing below average
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>Both Bull & Bear Power > 0:</strong> STRONG BULLS - Uptrend (Buy)</li>
                    <li><strong>Both Bull & Bear Power < 0:</strong> STRONG BEARS - Downtrend (Sell)</li>
                    <li><strong>Bull Power > 0, Bear Power < 0:</strong> Mixed signals - consolidation</li>
                    <li><strong>Bull Power rising:</strong> Bulls gaining strength</li>
                    <li><strong>Bear Power falling:</strong> Bears gaining strength</li>
                </ul>
                
                <h3>Dr. Elder's Trading Rules</h3>
                <ul>
                    <li><strong>Buy Signal:</strong> EMA rising + Bear Power negative but rising + Bull Power positive</li>
                    <li><strong>Sell Signal:</strong> EMA falling + Bull Power positive but falling + Bear Power negative</li>
                    <li><strong>Strongest Buy:</strong> Bear Power turns positive (both indicators > 0)</li>
                    <li><strong>Strongest Sell:</strong> Bull Power turns negative (both indicators < 0)</li>
                </ul>
                
                <h3>Divergence Signals</h3>
                <ul>
                    <li><strong>Bullish Divergence:</strong> Price makes lower low, Bear Power makes higher low â†’ Reversal up</li>
                    <li><strong>Bearish Divergence:</strong> Price makes higher high, Bull Power makes lower high â†’ Reversal down</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> Elder Ray is best used WITH trend indicators. In uptrends, wait for Bear Power to become less negative for entries. In downtrends, wait for Bull Power to weaken for shorts.
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         ðŸ“Š TREND INDICATORS MODALS (RESTANTS)
         ============================================ -->

    <!-- Modal Moving Averages -->
    <div id='modalMovingAverages' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“ˆ Moving Averages - Multiple Timeframes</h2>
                <span class='close-modal' onclick='closeModal("modalMovingAverages")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What are Moving Averages?</h3>
                <p><span class='key-term'>Moving Averages</span> smooth price data to identify trend direction. They are the foundation of technical analysis and used by 90% of traders worldwide.</p>
                
                <h3>Types of Moving Averages</h3>
                
                <h4>1. Simple Moving Average (SMA)</h4>
                <div class='formula-box'>
                    <strong>Formula:</strong><br>
                    SMA = (Pâ‚ + Pâ‚‚ + Pâ‚ƒ + ... + Pâ‚™) / n<br><br>
                    
                    <strong>Example (5-day SMA):</strong><br>
                    Prices: 100, 102, 101, 103, 105<br>
                    SMA = (100 + 102 + 101 + 103 + 105) / 5 = 102.2
                </div>
                
                <h4>2. Exponential Moving Average (EMA)</h4>
                <div class='formula-box'>
                    <strong>Formula:</strong><br>
                    Multiplier = 2 / (Period + 1)<br>
                    EMA = [Close - EMA(previous)] Ã— Multiplier + EMA(previous)<br><br>
                    
                    <strong>Characteristics:</strong><br>
                    - Gives MORE weight to recent prices<br>
                    - More responsive to price changes than SMA<br>
                    - Preferred for short-term trading
                </div>
                
                <h3>Common Periods Used</h3>
                <ul>
                    <li><strong>SMA 20:</strong> Short-term trend (1 month)</li>
                    <li><strong>SMA 50:</strong> Medium-term trend (2.5 months)</li>
                    <li><strong>SMA 200:</strong> Long-term trend (10 months) - "Line in the sand"</li>
                    <li><strong>EMA 9:</strong> Very short-term momentum</li>
                    <li><strong>EMA 21:</strong> Short-term trend with more responsiveness</li>
                </ul>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>Price above MA:</strong> Uptrend - bullish</li>
                    <li><strong>Price below MA:</strong> Downtrend - bearish</li>
                    <li><strong>MA sloping up:</strong> Trend is up</li>
                    <li><strong>MA sloping down:</strong> Trend is down</li>
                    <li><strong>MA flat:</strong> Consolidation/ranging</li>
                </ul>
                
                <h3>ðŸŒŸ Golden Cross & Death Cross</h3>
                <div class='formula-box'>
                    <strong>Golden Cross (BULLISH):</strong><br>
                    SMA 50 crosses ABOVE SMA 200<br>
                    â†’ Major buy signal, start of long-term uptrend<br><br>
                    
                    <strong>Death Cross (BEARISH):</strong><br>
                    SMA 50 crosses BELOW SMA 200<br>
                    â†’ Major sell signal, start of long-term downtrend
                </div>
                
                <h3>Perfect MA Alignment (Strongest Signal)</h3>
                <ul>
                    <li><strong>Bullish Alignment:</strong> Price > EMA 9 > EMA 21 > SMA 50 > SMA 200</li>
                    <li><strong>Bearish Alignment:</strong> Price < EMA 9 < EMA 21 < SMA 50 < SMA 200</li>
                </ul>
                
                <h3>Trading Strategies</h3>
                <ul>
                    <li><strong>Support/Resistance:</strong> MAs act as dynamic support in uptrends, resistance in downtrends</li>
                    <li><strong>Pullback Entry:</strong> In uptrend, buy when price pulls back to SMA 20 or SMA 50</li>
                    <li><strong>Crossover:</strong> Buy when fast MA crosses above slow MA</li>
                    <li><strong>200 SMA Rule:</strong> Only buy when price is above SMA 200 (stay on right side of trend)</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> The SMA 200 is watched by EVERY institutional trader. When price breaks above/below it, expect massive volume. Golden/Death crosses are among the most reliable signals in all of technical analysis.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Linear Regression -->
    <div id='modalLinearRegression' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ“‰ Linear Regression Channel</h2>
                <span class='close-modal' onclick='closeModal("modalLinearRegression")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is Linear Regression?</h3>
                <p><span class='key-term'>Linear Regression</span> is a statistical tool that finds the best-fit line through price data. It identifies the dominant trend and potential support/resistance levels.</p>
                
                <h3>Mathematical Calculation</h3>
                <div class='formula-box'>
                    <strong>Default Period: 100</strong><br><br>
                    
                    <strong>Step 1: Linear Regression Formula (Least Squares Method)</strong><br>
                    For data points (x, y), find the line y = mx + b where:<br><br>
                    
                    Slope (m) = [n(Î£xy) - (Î£x)(Î£y)] / [n(Î£xÂ²) - (Î£x)Â²]<br>
                    Intercept (b) = [Î£y - m(Î£x)] / n<br><br>
                    
                    Where:<br>
                    - x = period number (0, 1, 2, ...)<br>
                    - y = closing price<br>
                    - n = number of periods<br><br>
                    
                    <strong>Step 2: Calculate Standard Deviation</strong><br>
                    For each point, calculate deviation from regression line<br>
                    Standard Deviation (Ïƒ) = âˆš[Î£(Price - Regression)Â² / n]<br><br>
                    
                    <strong>Step 3: Draw Channel</strong><br>
                    Upper Channel = Regression Line + (2 Ã— Ïƒ)<br>
                    Middle Line = Regression Line<br>
                    Lower Channel = Regression Line - (2 Ã— Ïƒ)
                </div>
                
                <h3>How to Interpret</h3>
                <ul>
                    <li><strong>Positive Slope:</strong> UPTREND - slope > 0.5 is strong</li>
                    <li><strong>Negative Slope:</strong> DOWNTREND - slope < -0.5 is strong</li>
                    <li><strong>Near-Zero Slope:</strong> SIDEWAYS - no clear trend</li>
                    <li><strong>Price above Middle Line:</strong> Bullish bias</li>
                    <li><strong>Price below Middle Line:</strong> Bearish bias</li>
                </ul>
                
                <h3>Channel Trading</h3>
                <ul>
                    <li><strong>Price at Upper Channel:</strong> Overbought - potential sell/short</li>
                    <li><strong>Price at Lower Channel:</strong> Oversold - potential buy/cover</li>
                    <li><strong>Price breaking above Upper Channel:</strong> Very strong momentum - breakout</li>
                    <li><strong>Price breaking below Lower Channel:</strong> Very weak - breakdown</li>
                    <li><strong>Channel narrowing:</strong> Volatility decreasing</li>
                    <li><strong>Channel widening:</strong> Volatility increasing</li>
                </ul>
                
                <h3>Advanced Applications</h3>
                <ul>
                    <li><strong>Trend Strength:</strong> Steeper slope = stronger trend</li>
                    <li><strong>Mean Reversion:</strong> When price deviates from line, expect return to mean</li>
                    <li><strong>Breakout Confirmation:</strong> Wait for price to break channel AND slope to change</li>
                    <li><strong>Multi-Timeframe:</strong> Use on daily + weekly for best accuracy</li>
                </ul>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> Linear regression is OBJECTIVE - it removes emotion. The slope tells you the trend direction mathematically. Use 100-period for swing trading, 50-period for day trading.
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         ðŸŽ¯ PATTERN DETECTION MODALS
         ============================================ -->

    <!-- Modal Support/Resistance -->
    <div id='modalSupportResistance' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸŽ¯ Automatic Support & Resistance Detection</h2>
                <span class='close-modal' onclick='closeModal("modalSupportResistance")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What is Support & Resistance?</h3>
                <p><span class='key-term'>Support and Resistance</span> are price levels where buying/selling pressure is historically concentrated. They are the most fundamental concepts in technical analysis.</p>
                
                <h3>Support (Floor)</h3>
                <ul>
                    <li><strong>Definition:</strong> Price level where demand is strong enough to prevent further decline</li>
                    <li><strong>Psychology:</strong> Buyers see value at this level and step in</li>
                    <li><strong>Behavior:</strong> Price bounces up from support</li>
                    <li><strong>Break Below:</strong> Becomes resistance (role reversal)</li>
                </ul>
                
                <h3>Resistance (Ceiling)</h3>
                <ul>
                    <li><strong>Definition:</strong> Price level where selling pressure is strong enough to prevent further rise</li>
                    <li><strong>Psychology:</strong> Sellers see price as expensive and take profits</li>
                    <li><strong>Behavior:</strong> Price bounces down from resistance</li>
                    <li><strong>Break Above:</strong> Becomes support (role reversal)</li>
                </ul>
                
                <h3>How Our Algorithm Detects Levels</h3>
                <div class='formula-box'>
                    <strong>Method: Swing High/Low Detection</strong><br><br>
                    
                    <strong>Step 1: Find Swing Highs (Resistance)</strong><br>
                    A high where:<br>
                    - High(i) > High(i-1) AND High(i) > High(i-2)<br>
                    - High(i) > High(i+1) AND High(i) > High(i+2)<br><br>
                    
                    <strong>Step 2: Find Swing Lows (Support)</strong><br>
                    A low where:<br>
                    - Low(i) < Low(i-1) AND Low(i) < Low(i-2)<br>
                    - Low(i) < Low(i+1) AND Low(i) < Low(i+2)<br><br>
                    
                    <strong>Step 3: Cluster Similar Levels</strong><br>
                    Group levels within 2% of each other<br>
                    Take average of cluster as final level
                </div>
                
                <h3>Strength of Levels</h3>
                <ul>
                    <li><strong>Number of Touches:</strong> More touches = stronger level</li>
                    <li><strong>Volume:</strong> High volume at level = stronger</li>
                    <li><strong>Time:</strong> Older levels are often stronger</li>
                    <li><strong>Round Numbers:</strong> $100, $150, $200 are psychological levels</li>
                </ul>
                
                <h3>How to Trade S/R</h3>
                <ul>
                    <li><strong>Buy at Support:</strong> When price approaches support in uptrend</li>
                    <li><strong>Sell at Resistance:</strong> When price approaches resistance in downtrend</li>
                    <li><strong>Breakout Trading:</strong> Buy when price breaks above resistance with volume</li>
                    <li><strong>Breakdown Trading:</strong> Sell when price breaks below support with volume</li>
                    <li><strong>Role Reversal:</strong> Old resistance becomes new support (and vice versa)</li>
                </ul>
                
                <h3>Confirmation Signals</h3>
                <ul>
                    <li>Wait for price to CLOSE above resistance (not just touch)</li>
                    <li>Look for increased volume on breakout</li>
                    <li>Use candlestick patterns at levels for confirmation</li>
                    <li>Check multiple timeframes for level confluence</li>
                </ul>
                
                <div class='warning-box'>
                    âš  <strong>Warning:</strong> S/R levels are ZONES, not exact prices. Allow 0.5-1% flexibility. False breakouts are common - wait for confirmation.
                </div>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> The best trades happen at the CONFLUENCE of multiple S/R levels (e.g., daily support + weekly support + 200 SMA). Stack your levels for highest probability!
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Candlestick Patterns -->
    <div id='modalCandlestickPatterns' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ•¯ Candlestick Pattern Recognition</h2>
                <span class='close-modal' onclick='closeModal("modalCandlestickPatterns")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What are Candlestick Patterns?</h3>
                <p><span class='key-term'>Candlestick Patterns</span> are formations created by one or more candlesticks that indicate potential reversals or continuations. Developed in 18th century Japan by rice trader Homma Munehisa.</p>
                
                <h3>Candlestick Anatomy</h3>
                <div class='formula-box'>
                    <strong>Components:</strong><br>
                    - <strong>Body:</strong> Range between Open and Close<br>
                    - <strong>Upper Shadow:</strong> High - max(Open, Close)<br>
                    - <strong>Lower Shadow:</strong> min(Open, Close) - Low<br>
                    - <strong>Green/White:</strong> Close > Open (Bullish)<br>
                    - <strong>Red/Black:</strong> Close < Open (Bearish)
                </div>
                
                <h3>ðŸŸ¢ Bullish Reversal Patterns (20+ Detected)</h3>
                
                <h4>1. Hammer</h4>
                <ul>
                    <li><strong>Structure:</strong> Small body at top, long lower shadow (2x body), tiny upper shadow</li>
                    <li><strong>Location:</strong> Must appear at bottom of downtrend</li>
                    <li><strong>Meaning:</strong> Sellers pushed down, buyers pushed back up - reversal</li>
                    <li><strong>Confirmation:</strong> Next candle closes above hammer</li>
                </ul>
                
                <h4>2. Inverted Hammer</h4>
                <ul>
                    <li><strong>Structure:</strong> Small body at bottom, long upper shadow, tiny lower shadow</li>
                    <li><strong>Meaning:</strong> Buyers tried to push up, failed, but pressure is building</li>
                </ul>
                
                <h4>3. Bullish Engulfing</h4>
                <ul>
                    <li><strong>Structure:</strong> Small red candle followed by large green candle that engulfs it</li>
                    <li><strong>Meaning:</strong> Strong shift from bearish to bullish sentiment</li>
                    <li><strong>Strength:</strong> Larger the green candle, stronger the signal</li>
                </ul>
                
                <h4>4. Morning Star (3-candle pattern)</h4>
                <ul>
                    <li><strong>Candle 1:</strong> Long red candle (downtrend)</li>
                    <li><strong>Candle 2:</strong> Small body (indecision) - gaps down</li>
                    <li><strong>Candle 3:</strong> Long green candle closing above midpoint of candle 1</li>
                    <li><strong>Signal:</strong> VERY STRONG reversal (one of the best patterns)</li>
                </ul>
                
                <h4>5. Piercing Line</h4>
                <ul>
                    <li><strong>Structure:</strong> Red candle followed by green candle that opens below low and closes above 50% of red body</li>
                    <li><strong>Strength:</strong> The deeper into red candle it penetrates, the stronger</li>
                </ul>
                
                <h3>ðŸ”´ Bearish Reversal Patterns</h3>
                
                <h4>1. Hanging Man</h4>
                <ul>
                    <li><strong>Structure:</strong> Identical to hammer but appears at TOP of uptrend</li>
                    <li><strong>Meaning:</strong> Sellers are starting to appear</li>
                </ul>
                
                <h4>2. Shooting Star</h4>
                <ul>
                    <li><strong>Structure:</strong> Small body at bottom, long upper shadow</li>
                    <li><strong>Location:</strong> Top of uptrend</li>
                    <li><strong>Meaning:</strong> Buyers tried to push higher but failed - reversal</li>
                </ul>
                
                <h4>3. Bearish Engulfing</h4>
                <ul>
                    <li><strong>Structure:</strong> Small green candle followed by large red candle that engulfs it</li>
                    <li><strong>Meaning:</strong> Strong shift from bullish to bearish</li>
                </ul>
                
                <h4>4. Evening Star</h4>
                <ul>
                    <li><strong>Opposite of Morning Star</strong></li>
                    <li><strong>Signal:</strong> VERY STRONG bearish reversal</li>
                </ul>
                
                <h4>5. Dark Cloud Cover</h4>
                <ul>
                    <li><strong>Structure:</strong> Green candle followed by red candle that opens above high and closes below 50% of green body</li>
                </ul>
                
                <h3>âšª Indecision Patterns</h3>
                
                <h4>Doji</h4>
                <ul>
                    <li><strong>Structure:</strong> Open = Close (tiny/no body)</li>
                    <li><strong>Meaning:</strong> Perfect balance between buyers/sellers</li>
                    <li><strong>Context:</strong> At top of trend = reversal warning, at bottom = potential reversal</li>
                    <li><strong>Types:</strong> Long-legged Doji, Dragonfly Doji, Gravestone Doji</li>
                </ul>
                
                <h3>Pattern Strength Factors</h3>
                <ul>
                    <li><strong>Volume:</strong> Higher volume = stronger signal</li>
                    <li><strong>Trend Context:</strong> Patterns work best at trend extremes</li>
                    <li><strong>Support/Resistance:</strong> Patterns at S/R levels are most powerful</li>
                    <li><strong>Confirmation:</strong> Wait for next candle to confirm direction</li>
                </ul>
                
                <div class='warning-box'>
                    âš  <strong>Warning:</strong> NEVER trade candlestick patterns in isolation. Always combine with:
                    - Trend analysis (is there a trend to reverse?)
                    - Support/Resistance levels
                    - Volume confirmation
                    - Other technical indicators
                </div>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> The most reliable patterns are:
                    1. Morning Star / Evening Star (reversal)
                    2. Bullish/Bearish Engulfing (reversal)
                    3. Hammer at support / Shooting Star at resistance
                    
                    Learn these 5 patterns FIRST before others!
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Divergences -->
    <div id='modalDivergences' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>ðŸ”„ Divergence Detection</h2>
                <span class='close-modal' onclick='closeModal("modalDivergences")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What are Divergences?</h3>
                <p><span class='key-term'>Divergences</span> occur when price and an indicator (like RSI or MACD) move in opposite directions. They are among the MOST POWERFUL reversal signals in technical analysis.</p>
                
                <h3>Types of Divergences</h3>
                
                <h4>ðŸŸ¢ Regular Bullish Divergence (Reversal Signal)</h4>
                <div class='formula-box'>
                    <strong>Pattern:</strong><br>
                    - Price: Lower Low (LL)<br>
                    - Indicator: Higher Low (HL)<br><br>
                    
                    <strong>Meaning:</strong><br>
                    Price is making new lows, but momentum is weakening<br>
                    â†’ Downtrend is losing steam<br>
                    â†’ POTENTIAL REVERSAL UP<br><br>
                    
                    <strong>Action:</strong> Look for BUY opportunities<br>
                    <strong>Best Indicators:</strong> RSI, MACD, Stochastic
                </div>
                
                <h4>ðŸ”´ Regular Bearish Divergence (Reversal Signal)</h4>
                <div class='formula-box'>
                    <strong>Pattern:</strong><br>
                    - Price: Higher High (HH)<br>
                    - Indicator: Lower High (LH)<br><br>
                    
                    <strong>Meaning:</strong><br>
                    Price is making new highs, but momentum is weakening<br>
                    â†’ Uptrend is losing steam<br>
                    â†’ POTENTIAL REVERSAL DOWN<br><br>
                    
                    <strong>Action:</strong> Look for SELL opportunities
                </div>
                
                <h4>ðŸŸ¢ Hidden Bullish Divergence (Continuation Signal)</h4>
                <div class='formula-box'>
                    <strong>Pattern:</strong><br>
                    - Price: Higher Low (HL)<br>
                    - Indicator: Lower Low (LL)<br><br>
                    
                    <strong>Meaning:</strong><br>
                    Price pullback is shallow, but indicator shows strength<br>
                    â†’ Uptrend will CONTINUE<br><br>
                    
                    <strong>Action:</strong> Buy the dip in uptrend
                </div>
                
                <h4>ðŸ”´ Hidden Bearish Divergence (Continuation Signal)</h4>
                <div class='formula-box'>
                    <strong>Pattern:</strong><br>
                    - Price: Lower High (LH)<br>
                    - Indicator: Higher High (HH)<br><br>
                    
                    <strong>Meaning:</strong><br>
                    Price rally is weak, but indicator shows weakness persists<br>
                    â†’ Downtrend will CONTINUE<br><br>
                    
                    <strong>Action:</strong> Sell the rally in downtrend
                </div>
                
                <h3>How to Identify Divergences</h3>
                <ol>
                    <li><strong>Identify Clear Trend:</strong> Need at least 2 swing highs/lows</li>
                    <li><strong>Connect Price Swings:</strong> Draw trendline connecting swing points</li>
                    <li><strong>Connect Indicator Swings:</strong> Draw trendline on same timepoints</li>
                    <li><strong>Compare Slopes:</strong> If lines diverge (opposite slopes) = divergence</li>
                </ol>
                
                <h3>Best Indicators for Divergences</h3>
                <ul>
                    <li><strong>RSI:</strong> Most reliable, clear swings</li>
                    <li><strong>MACD Histogram:</strong> Very visual, easy to spot</li>
                    <li><strong>Stochastic:</strong> Good for short-term divergences</li>
                    <li><strong>MFI:</strong> Adds volume component</li>
                    <li><strong>OBV:</strong> Volume-based divergences are powerful</li>
                </ul>
                
                <h3>Confirmation Checklist</h3>
                <ul>
                    <li>âœ… Clear uptrend/downtrend exists</li>
                    <li>âœ… At least 2 swing points visible</li>
                    <li>âœ… Indicator makes clear opposite move</li>
                    <li>âœ… Divergence at key support/resistance level</li>
                    <li>âœ… Volume decreasing on price move (shows weakness)</li>
                    <li>âœ… Candlestick reversal pattern appears</li>
                </ul>
                
                <h3>Trading Divergences</h3>
                <ul>
                    <li><strong>Entry:</strong> When price breaks trendline in direction of divergence</li>
                    <li><strong>Stop Loss:</strong> Beyond the swing high/low that created divergence</li>
                    <li><strong>Target:</strong> Previous swing point or key S/R level</li>
                    <li><strong>Confirmation:</strong> Wait for price to reverse (don't trade the divergence alone)</li>
                </ul>
                
                <h3>Common Mistakes</h3>
                <ul>
                    <li>âŒ Trading divergences in strong trends (wait for trend exhaustion)</li>
                    <li>âŒ Using too short timeframes (divergences work best on daily charts)</li>
                    <li>âŒ Not waiting for confirmation (price must actually reverse)</li>
                    <li>âŒ Ignoring the broader trend context</li>
                </ul>
                
                <div class='warning-box'>
                    âš  <strong>Critical Rule:</strong> Divergences predict potential reversals but don't guarantee them. ALWAYS wait for:
                    1. Price to break the trendline
                    2. Candlestick confirmation pattern
                    3. Volume spike in reversal direction
                    
                    Never enter on divergence alone!
                </div>
                
                <div class='tip-box'>
                    ðŸ’¡ <strong>Pro Tip:</strong> The STRONGEST divergences occur:
                    - At key S/R levels
                    - On multiple indicators simultaneously (RSI + MACD)
                    - On higher timeframes (daily > hourly)
                    - With decreasing volume (shows trend exhaustion)
                    
                    When all 4 align, you have a HIGH PROBABILITY reversal!
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS DÃ‰JÃ€ EXISTANTS (CONSERVÃ‰S) -->
    <!-- Modal Stochastic - DÃ‰JÃ€ INCLUS DANS PARTIE 1 -->
    <!-- Modal Williams - DÃ‰JÃ€ INCLUS DANS PARTIE 1 -->
    <!-- Modal ADX - DÃ‰JÃ€ INCLUS DANS PARTIE 1 -->
    <!-- Modal SAR - DÃ‰JÃ€ INCLUS DANS PARTIE 1 -->
    <!-- Modal OBV - DÃ‰JÃ€ INCLUS DANS PARTIE 1 -->
    <!-- Modal ATR - DÃ‰JÃ€ INCLUS DANS PARTIE 1 -->
    <!-- Modal Fibonacci - DÃ‰JÃ€ INCLUS DANS PARTIE 1 -->
    <!-- Modal Pivots - DÃ‰JÃ€ INCLUS DANS PARTIE 1 -->
    <!-- Modal VWAP - DÃ‰JÃ€ INCLUS DANS PARTIE 1 -->
    <!-- Modal Ichimoku - DÃ‰JÃ€ INCLUS DANS PARTIE 1 -->

    <!-- ============================================
         ðŸ“œ SCRIPTS FINAUX
         ============================================ -->
    
    <!-- Core Scripts -->
    <script src='assets/js/config.js'></script>
    <script src='assets/js/api-client.js'></script>
    <script src='assets/js/dark-mode.js'></script>
    <script src='assets/js/common.js'></script>
    <script src='assets/js/sidebar.js'></script>
    
    <!-- Advanced Analysis Script (WALL STREET EDITION) -->
    <script src='assets/js/advanced-analysis.js'></script>
    
    <!-- ðŸ†• Portfolio, Watchlist & Alerts Manager -->
    <script src='assets/js/portfolio-watchlist-alerts.js'></script>
    
    <!-- Modal Functions -->
    <script>
    // ============================================
    // MODAL MANAGEMENT FUNCTIONS
    // ============================================
    
    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
    }

    // Close modal when clicking outside
    window.addEventListener('click', (event) => {
        if (event.target.classList.contains('modal')) {
            event.target.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
            document.querySelectorAll('.modal.active').forEach(modal => {
                modal.classList.remove('active');
            });
            document.body.style.overflow = 'auto';
        }
    });
    
    // ============================================
    // HELPER FUNCTIONS FOR NEW FEATURES
    // ============================================
    
    function openPortfolioHelp() {
        const helpText = `
ðŸ“ PORTFOLIO MANAGEMENT HELP

âœ¨ Features:
â€¢ Create multiple portfolios to organize your stocks
â€¢ Each portfolio can track different strategies (e.g., "Growth Stocks", "Dividend Portfolio", "Tech Sector")
â€¢ Switch between portfolios using the dropdown
â€¢ All data is automatically saved to Firebase in real-time

ðŸŽ¯ How to Use:
1. Click "New Portfolio" to create a portfolio
2. Give it a meaningful name
3. Select it from the dropdown to make it active
4. Add stocks to your watchlist - they'll be saved to this portfolio
5. Create price alerts - they're portfolio-specific

ðŸ’¾ Data Sync:
â€¢ All portfolios sync across devices
â€¢ Automatic backup to Firebase
â€¢ Never lose your tracking data

âš™ Management:
â€¢ Click "Manage" to rename or delete portfolios
â€¢ You can have unlimited portfolios
â€¢ Default portfolio is created automatically
        `;
        alert(helpText);
    }
    
    function openWatchlistHelp() {
        const helpText = `
â­ WATCHLIST HELP

âœ¨ Features:
â€¢ Track multiple stocks in real-time
â€¢ See live price changes and percentage moves
â€¢ Filter by gainers/losers
â€¢ One-click analysis of any stock

ðŸŽ¯ How to Use:
1. Type a stock symbol (e.g., AAPL) in the search box
2. Click "Add" or press Enter
3. Stock appears in your watchlist with live data
4. Click on a stock card to analyze it with all 40+ indicators
5. Remove stocks by clicking the trash icon

ðŸ“Š Features:
â€¢ Real-time price updates
â€¢ Color-coded gains (green) and losses (red)
â€¢ Quick filters: All / Gainers / Losers
â€¢ Automatic sync to Firebase
â€¢ Portfolio-specific (each portfolio has its own watchlist)

ðŸ’¡ Pro Tips:
â€¢ Add stocks BEFORE market opens to track opening moves
â€¢ Use "Gainers" filter to spot momentum stocks
â€¢ Watchlist persists across sessions
â€¢ Maximum 50 stocks per watchlist (performance)
        `;
        alert(helpText);
    }
    
    function openAlertsHelp() {
        const helpText = `
ðŸ”” PRICE ALERTS HELP

âœ¨ Features:
â€¢ Get notified when stocks reach your target prices
â€¢ Set "above" or "below" conditions
â€¢ Toggle alerts on/off without deleting
â€¢ Alerts check automatically every 60 seconds

ðŸŽ¯ How to Use:
1. Click "Create New Alert"
2. Enter stock symbol (e.g., TSLA)
3. Choose condition: "Price goes above" or "Price goes below"
4. Enter target price (e.g., 250.00)
5. Click "Create Alert"

ðŸ“Š Alert Types:
â€¢ ABOVE alerts: Trigger when price crosses above target
â€¢ BELOW alerts: Trigger when price crosses below target

ðŸ”” Notifications:
â€¢ Browser notification when alert triggers
â€¢ Email notification (if enabled in settings)
â€¢ Sound alert (can be disabled)
â€¢ Alert status changes to "Triggered"

âš™ Management:
â€¢ Toggle alerts on/off with switch
â€¢ Delete alerts individually
â€¢ View triggered vs active count
â€¢ Alerts are portfolio-specific

ðŸ’¡ Pro Tips:
â€¢ Set alerts at key support/resistance levels
â€¢ Use with Fibonacci retracement levels
â€¢ Create both buy (below) and sell (above) alerts
â€¢ Review triggered alerts regularly for opportunities
        `;
        alert(helpText);
    }
    </script>
    
    <!-- Chatbot Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="assets/js/chatbot-config.js"></script>
    <script src="assets/js/chatbot-gemini.js"></script>
    <script src="assets/js/chatbot-analytics.js"></script>
    <script src="assets/js/chatbot-charts.js"></script>
    <script src="assets/js/chatbot-ipo-analyzer.js"></script>
    <script src="assets/js/chatbot-suggestions.js"></script>
    <script src="assets/js/chatbot-ai-engine.js"></script>
    <script src="assets/js/chatbot-ui.js"></script>
    <script src="assets/js/chatbot-particles.js"></script>

    <!-- Chatbot Initialization -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const initChatbotWhenReady = () => {
            const accessDenied = sessionStorage.getItem('accessDenied') === 'true';
            if (accessDenied) return;
            
            if (typeof ChatbotConfig === 'undefined' || typeof ChatbotUI === 'undefined') return;
            
            try {
                window.financialChatbot = new ChatbotUI(ChatbotConfig);
                console.log('ðŸŽ‰ Chatbot FinanceGPT initialized successfully');
            } catch (error) {
                console.error('âŒ Chatbot initialization error:', error);
            }
        };
        
        setTimeout(initChatbotWhenReady, 500);
    });
    </script>

    <!-- Sidebar User Menu -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const sidebarUserTrigger = document.getElementById('sidebarUserTrigger');
        const sidebarUserDropdown = document.getElementById('sidebarUserDropdown');
        
        if (sidebarUserTrigger && sidebarUserDropdown) {
            sidebarUserTrigger.addEventListener('click', (e) => {
                e.stopPropagation();
                sidebarUserTrigger.classList.toggle('active');
                sidebarUserDropdown.classList.toggle('active');
            });
            
            document.addEventListener('click', (e) => {
                if (!sidebarUserDropdown.contains(e.target) && 
                    !sidebarUserTrigger.contains(e.target)) {
                    sidebarUserTrigger.classList.remove('active');
                    sidebarUserDropdown.classList.remove('active');
                }
            });
            
            sidebarUserDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }
    });
    </script>

    <!-- ============================================
         ðŸŽ¨ CUSTOM STYLING FOR NEW INDICATORS
         ============================================ -->
    <style>
    /* Category Title Styling */
    .category-title {
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--text-primary);
        margin: 3rem 0 1.5rem 0;
        padding: 1rem 1.5rem;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: 12px;
        color: white;
        display: flex;
        align-items: center;
        gap: 1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .category-title i {
        font-size: 1.8rem;
    }

    /* Formula Box Styling */
    .formula-box {
        background: linear-gradient(135deg, #f6f8fb 0%, #e9ecef 100%);
        border-left: 4px solid var(--primary-color);
        padding: 1.5rem;
        margin: 1rem 0;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 0.95rem;
        line-height: 1.8;
        overflow-x: auto;
    }

    body.dark-mode .formula-box {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        color: #e2e8f0;
    }

    .formula-box strong {
        color: var(--primary-color);
        display: block;
        margin-bottom: 0.5rem;
    }

    /* Key Term Styling */
    .key-term {
        color: var(--primary-color);
        font-weight: 700;
        background: rgba(38, 73, 178, 0.1);
        padding: 2px 8px;
        border-radius: 4px;
    }

    body.dark-mode .key-term {
        background: rgba(74, 116, 243, 0.2);
        color: var(--secondary-color);
    }

    /* Tip Box Styling */
    .tip-box {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        border-left: 4px solid #10b981;
        padding: 1rem 1.5rem;
        margin: 1.5rem 0;
        border-radius: 8px;
        font-size: 0.95rem;
    }

    body.dark-mode .tip-box {
        background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
        color: #d1fae5;
    }

    .tip-box strong {
        color: #059669;
    }

    body.dark-mode .tip-box strong {
        color: #34d399;
    }

    /* Warning Box Styling */
    .warning-box {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border-left: 4px solid #f59e0b;
        padding: 1rem 1.5rem;
        margin: 1.5rem 0;
        border-radius: 8px;
        font-size: 0.95rem;
    }

    body.dark-mode .warning-box {
        background: linear-gradient(135deg, #78350f 0%, #92400e 100%);
        color: #fef3c7;
    }

    .warning-box strong {
        color: #d97706;
    }

    body.dark-mode .warning-box strong {
        color: #fbbf24;
    }

    /* Support/Resistance Grid */
    .sr-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 1.5rem;
    }

    .sr-column h4 {
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .sr-column ul {
        list-style: none;
        padding: 0;
    }

    .sr-column li {
        background: var(--card-background);
        padding: 0.75rem 1rem;
        margin-bottom: 0.5rem;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .sr-column li:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .distance {
        font-size: 0.9rem;
        font-weight: 500;
        opacity: 0.8;
    }

    /* Pattern & Divergence Containers */
    .patterns-container,
    .divergences-container {
        margin-top: 1.5rem;
    }

    .patterns-container table {
        width: 100%;
        border-collapse: collapse;
        background: var(--card-background);
        border-radius: 12px;
        overflow: hidden;
    }

    .patterns-container th,
    .patterns-container td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
    }

    .patterns-container th {
        background: var(--primary-color);
        color: white;
        font-weight: 700;
    }

    .strength-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 700;
        text-transform: uppercase;
    }

    .strength-badge.very-strong {
        background: #10b981;
        color: white;
    }

    .strength-badge.strong {
        background: #3b82f6;
        color: white;
    }

    .strength-badge.medium {
        background: #f59e0b;
        color: white;
    }

    .divergence-item {
        background: var(--card-background);
        padding: 1rem 1.5rem;
        margin-bottom: 1rem;
        border-radius: 12px;
        border-left: 4px solid var(--border-color);
        transition: all 0.3s ease;
    }

    .divergence-item:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .divergence-item.bullish {
        border-left-color: var(--success-color);
        background: linear-gradient(90deg, rgba(16, 185, 129, 0.05) 0%, var(--card-background) 100%);
    }

    .divergence-item.bearish {
        border-left-color: var(--danger-color);
        background: linear-gradient(90deg, rgba(220, 53, 69, 0.05) 0%, var(--card-background) 100%);
    }

    .divergence-item strong {
        font-size: 1.1rem;
        display: block;
        margin-bottom: 0.5rem;
    }

    .divergence-item p {
        margin: 0;
        opacity: 0.9;
    }
    </style>

</body>
</html>