<!DOCTYPE html>
<html lang='fr'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Monte Carlo Simulation</title>
    
    <!-- Highcharts -->
    <script src='https://code.highcharts.com/highcharts.js'></script>
    <script src='https://code.highcharts.com/highcharts-3d.js'></script>
    <script src='https://code.highcharts.com/modules/heatmap.js'></script>
    <script src='https://code.highcharts.com/modules/exporting.js'></script>
    <script src='https://code.highcharts.com/modules/export-data.js'></script>
    
    <!-- jsPDF -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js'></script>
    
    <!-- Font Awesome -->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'>
    
    <!-- Styles -->
    <link rel='stylesheet' href='assets/css/common.css'>
    <link rel='stylesheet' href='assets/css/sidebar.css'>
    <link rel="stylesheet" href="assets/css/user-menu.css">
    <link rel="stylesheet" href="assets/css/chatbot-styles.css">
    <link rel='stylesheet' href='assets/css/monte-carlo.css'>
    
    <script src="assets/js/favicon-dynamic.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/auth-guard.js"></script>
    <script src="assets/js/access-control.js"></script>
</head>
<body>

    <script src="assets/js/theme.js"></script>
    <script src="assets/js/theme-charts.js"></script>

    <canvas id="particles-canvas" class="particles-background"></canvas>

    <div class='layout-wrapper'>
        
        <!-- Sidebar Navigation -->
        <aside class='sidebar' id='sidebar'>
            <div class="sidebar-header">
                <div class="logo-container">
                    <div class="logo-3d">
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" class="logo-gradient-1" />
                                    <stop offset="100%" class="logo-gradient-2" />
                                </linearGradient>
                            </defs>
                            <path d="M 20 80 L 30 70 L 40 75 L 50 60 L 60 65 L 70 45 L 80 50 L 90 30" 
                                  stroke="url(#logoGradient)" stroke-width="4" fill="none" 
                                  stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="30" cy="70" r="4" fill="url(#logoGradient)"/>
                            <circle cx="50" cy="60" r="4" fill="url(#logoGradient)"/>
                            <circle cx="70" cy="45" r="4" fill="url(#logoGradient)"/>
                            <circle cx="90" cy="30" r="5" fill="url(#logoGradient)"/>
                            <path d="M 85 35 L 90 30 L 85 25" stroke="url(#logoGradient)" 
                                  stroke-width="3" fill="none" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="brand-text">
                        <h2 class="brand-name">AlphaVault AI</h2>
                        <span class="brand-tagline">Investments</span>
                    </div>
                </div>
                <button class="sidebar-toggle" aria-label="Toggle Sidebar">
                    <i class="fas fa-angle-left"></i>
                </button>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <button class="nav-folder" data-tooltip="Home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>
                    <div class="nav-submenu">
                        <a href="index.html" class="nav-link">
                            <i class="fas fa-home"></i>
                            <span>Overview</span>
                        </a>
                    </div>
                </div>
                
                <div class='nav-section'>
                    <button class='nav-folder'>
                        <i class='fas fa-wallet'></i>
                        <span>Budget</span>
                        <i class='fas fa-chevron-down arrow'></i>
                    </button>
                    <div class='nav-submenu'>
                        <a href='dashboard-financier.html' class='nav-link'>
                            <i class='fas fa-home'></i>
                            <span>Dashboard Budget</span>
                        </a>
                        <a href='investment-analytics.html' class='nav-link'>
                            <i class='fas fa-chart-bar'></i>
                            <span>Investment Analytics</span>
                        </a>
                    </div>
                </div>
                
                <div class='nav-section'>
                    <button class='nav-folder'>
                        <i class='fas fa-calculator'></i>
                        <span>Simulation</span>
                        <i class='fas fa-chevron-down arrow'></i>
                    </button>
                    <div class='nav-submenu'>
                        <a href='monte-carlo.html' class='nav-link active'>
                            <i class='fas fa-dice'></i>
                            <span>Monte Carlo</span>
                        </a>
                        <a href='portfolio-optimizer.html' class='nav-link'>
                            <i class='fas fa-chart-pie'></i>
                            <span>Markowitz</span>
                        </a>
                        <a href='risk-parity.html' class='nav-link'>
                            <i class='fas fa-balance-scale'></i>
                            <span>Risk Parity</span>
                        </a>
                        <a href='scenario-analysis.html' class='nav-link'>
                            <i class='fas fa-flask'></i>
                            <span>Scenarios</span>
                        </a>
                    </div>
                </div>
                
                <div class='nav-section'>
                    <button class="nav-folder" data-tooltip="Stocks">
                        <i class="fas fa-chart-line"></i>
                        <span>Stocks</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>
                    <div class='nav-submenu' style='display: block;'>
                        <a href='advanced-analysis.html' class='nav-link'>
                            <i class='fas fa-brain'></i>
                            <span>Advanced Analysis</span>
                        </a>
                        <a href='forex-converter.html' class='nav-link'>
                            <i class='fas fa-exchange-alt'></i>
                            <span>Forex Converter</span>
                        </a>
                        <!-- <a href='trend-prediction.html' class='nav-link'>
                            <i class='fas fa-chart-line'></i>
                            <span>Trend Prediction</span>
                        </a>
                        <a href='market-intelligence.html' class='nav-link'>
                            <i class='fas fa-globe'></i>
                            <span>Market Intelligence</span>
                        </a>
                        <a href='company-insights.html' class='nav-link'>
                            <i class='fas fa-building'></i>
                            <span>Company Insights</span>
                        </a>
                        <a href='analyst-coverage.html' class='nav-link active'>
                            <i class='fas fa-users'></i>
                            <span>Analyst Coverage</span>
                        </a>
                        <a href='earnings-estimates.html' class='nav-link'>
                            <i class='fas fa-coins'></i>
                            <span>Earnings & Estimates</span>
                        </a>
                    </div> -->
                </div>

                <div class='nav-section'>
                    <button class="nav-folder" data-tooltip="AI Assistant">
                        <i class="fas fa-robot"></i>
                        <span>AI Assistant</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>
                    <div class='nav-submenu' style='display: block;'>
                        <a href='chatbot-fullpage.html' class='nav-link'>
                            <i class='fas fa-comments'></i>
                            <span>Alphy AI Chat</span>
                        </a>
                    </div>
                </div>

                <div class='nav-section'>
                    <button class='nav-folder'>
                        <i class='fas fa-globe-americas'></i>
                        <span>Economic Data</span>
                        <i class='fas fa-chevron-down arrow'></i>
                    </button>
                    <div class='nav-submenu' style='display: block;'>
                        <a href='economic-dashboard.html' class='nav-link'>
                            <i class='fas fa-tachometer-alt'></i>
                            <span>Macro Economic Dasboard</span>
                        </a>
                        <a href='inflation-calculator.html' class='nav-link'>
                            <i class='fas fa-calculator'></i>
                            <span>Inflation Calculator</span>
                        </a>
                        <a href='interest-rate-tracker.html' class='nav-link'>
                            <i class='fas fa-percent'></i>
                            <span>Interest Rates</span>
                        </a>
                        <a href='recession-indicator.html' class='nav-link'>
                            <i class='fas fa-exclamation-triangle'></i>
                            <span>Recession Indicators</span>
                        </a>
                    </div>
                </div>

                <!-- ‚ú® NOUVELLE SECTION NEWS -->
                <div class='nav-section'>
                    <button class="nav-folder" data-tooltip="News & Analysis">
                        <i class="fas fa-newspaper"></i>
                        <span>News & Analysis</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>
                    <div class='nav-submenu'>
                        <a href='news-terminal.html' class='nav-link'>
                            <i class='fas fa-desktop'></i>
                            <span>News Terminal</span>
                        </a>
                        <a href='market-sentiment.html' class='nav-link'>
                            <i class='fas fa-chart-pie'></i>
                            <span>Market Sentiment</span>
                        </a>
                        <a href='trending-topics.html' class='nav-link'>
                            <i class='fas fa-fire'></i>
                            <span>Trending Topics</span>
                        </a>
                    </div>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="sidebar-user-menu">
                    <div class="sidebar-user-trigger" id="sidebarUserTrigger">
                        <img data-user-photo 
                            src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" 
                            alt="Avatar" class="sidebar-user-avatar">
                        <div class="sidebar-user-info">
                            <span data-user-name class="sidebar-user-name">User</span>
                            <span data-user-plan class="sidebar-user-plan">Free Plan</span>
                        </div>
                        <i class="fas fa-chevron-up sidebar-user-arrow"></i>
                    </div>
                    
                    <div class="sidebar-user-dropdown" id="sidebarUserDropdown">
                        <div class="user-dropdown-header">
                            <img data-user-photo 
                                src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" 
                                alt="Avatar" class="user-dropdown-avatar">
                            <div class="user-dropdown-details">
                                <h4 data-user-name class="user-dropdown-name">User</h4>
                                <p data-user-email class="user-dropdown-email">email@example.com</p>
                            </div>
                        </div>
                        
                        <div class="user-dropdown-divider"></div>
                        
                        <nav class="user-dropdown-links">
                            <a href="user-profile.html" class="user-dropdown-link">
                                <i class="fas fa-user"></i>
                                <span>My profile</span>
                            </a>
                            <a href="settings.html" class="user-dropdown-link">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </a>
                            <a href="#" class="user-dropdown-link">
                                <i class="fas fa-question-circle"></i>
                                <span>Help</span>
                            </a>
                        </nav>
                        
                        <div class="user-dropdown-divider"></div>
                        
                        <button onclick="logout()" class="user-dropdown-logout">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Disconnect</span>
                        </button>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <div class='main-content'>
            <header class='top-header'>
                <div class="header-content-wrapper">
                    <div class='header-left'>
                        <button class='mobile-toggle' id='mobileToggle'>
                            <i class='fas fa-bars'></i>
                        </button>
                        <h1>
                            </i> Monte Carlo Simulation
                            <span class='help-icon help-icon-small' onclick='openModal("modalMCIntro")' title='What is Monte Carlo?'>?</span>
                        </h1>
                    </div>
                </div>
            </header>
            
            <div class='container'>
                <div class='content'>
                    
                    <!-- Quick Templates -->
                    <div class='quick-templates'>
                        <h2 class='section-title'>
                            <i class="fas fa-rocket"></i> Quick Start Templates
                            <span class='help-icon help-icon-small' onclick='openModal("modalTemplates")' title='Learn about templates'>?</span>
                        </h2>
                        <div class='templates-grid'>
                            <button class='template-btn template-conservative' onclick='MonteCarlo.loadTemplate("conservative")'>
                                <i class="fas fa-shield-alt"></i>
                                <span class='template-name'>Conservative</span>
                                <span class='template-desc'>Low risk ‚Ä¢ Stable</span>
                            </button>
                            <button class='template-btn template-balanced' onclick='MonteCarlo.loadTemplate("balanced")'>
                                <i class="fas fa-balance-scale"></i>
                                <span class='template-name'>Balanced</span>
                                <span class='template-desc'>Medium risk</span>
                            </button>
                            <button class='template-btn template-aggressive' onclick='MonteCarlo.loadTemplate("aggressive")'>
                                <i class="fas fa-chart-line"></i>
                                <span class='template-name'>Aggressive</span>
                                <span class='template-desc'>High growth</span>
                            </button>
                            <button class='template-btn template-retirement' onclick='MonteCarlo.loadTemplate("retirement")'>
                                <i class="fas fa-umbrella-beach"></i>
                                <span class='template-name'>Retirement</span>
                                <span class='template-desc'>Withdrawal</span>
                            </button>
                            <button class='template-btn template-crypto' onclick='MonteCarlo.loadTemplate("crypto")'>
                                <i class="fab fa-bitcoin"></i>
                                <span class='template-name'>Crypto</span>
                                <span class='template-desc'>High volatility</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Scenario Manager -->
                    <div class='scenario-manager'>
                        <h2 class='section-title'>
                            <i class="fas fa-save"></i> Scenario Manager
                            <span class='help-icon help-icon-small' onclick='openModal("modalScenarios")' title='How to manage scenarios'>?</span>
                        </h2>
                        <div class='scenario-controls'>
                            <button class='btn-scenario' onclick='MonteCarlo.saveCurrentScenario()'>
                                <i class="fas fa-save"></i> Save Scenario
                            </button>
                            <button class='btn-scenario' onclick='MonteCarlo.compareScenarios()'>
                                <i class="fas fa-code-compare"></i> Compare Scenarios
                            </button>
                            <button class='btn-scenario' onclick='MonteCarlo.clearScenarios()'>
                                <i class="fas fa-trash"></i> Clear All
                            </button>
                        </div>
                        <div id='savedScenariosList' class='saved-scenarios-list'></div>
                    </div>
                    
                    <!-- Parameters Panel -->
                    <div class='params-panel'>
                        <h2 class='panel-title'>
                            <i class="fas fa-sliders-h"></i> Simulation Parameters
                        </h2>
                        
                        <!-- Distribution Model -->
                        <div class='advanced-section'>
                            <h3 class='advanced-section-title'>
                                <i class="fas fa-chart-area"></i> Return Distribution Model
                                <span class='help-icon help-icon-small' onclick='openModal("modalDistribution")' title='Distribution models explained'>?</span>
                            </h3>
                            <div class='distribution-grid'>
                                <label class='radio-card'>
                                    <input type='radio' name='distribution' value='normal' checked>
                                    <div class='radio-card-content'>
                                        <i class="fas fa-chart-line"></i>
                                        <span class='radio-title'>Normal</span>
                                        <span class='radio-desc'>Gaussian</span>
                                    </div>
                                </label>
                                <label class='radio-card'>
                                    <input type='radio' name='distribution' value='studentt'>
                                    <div class='radio-card-content'>
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <span class='radio-title'>Student-t</span>
                                        <span class='radio-desc'>Fat tails</span>
                                    </div>
                                </label>
                                <label class='radio-card'>
                                    <input type='radio' name='distribution' value='lognormal'>
                                    <div class='radio-card-content'>
                                        <i class="fas fa-wave-square"></i>
                                        <span class='radio-title'>Log-Normal</span>
                                        <span class='radio-desc'>Skewed right</span>
                                    </div>
                                </label>
                                <label class='radio-card'>
                                    <input type='radio' name='distribution' value='jump'>
                                    <div class='radio-card-content'>
                                        <i class="fas fa-bolt"></i>
                                        <span class='radio-title'>Jump Diffusion</span>
                                        <span class='radio-desc'>Sudden shocks</span>
                                    </div>
                                </label>
                                <label class='radio-card'>
                                    <input type='radio' name='distribution' value='regime'>
                                    <div class='radio-card-content'>
                                        <i class="fas fa-random"></i>
                                        <span class='radio-title'>Regime Switch</span>
                                        <span class='radio-desc'>Bull/Bear</span>
                                    </div>
                                </label>
                                <label class='radio-card'>
                                    <input type='radio' name='distribution' value='garch'>
                                    <div class='radio-card-content'>
                                        <i class="fas fa-project-diagram"></i>
                                        <span class='radio-title'>GARCH</span>
                                        <span class='radio-desc'>Volatility clusters</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Strategy Mode -->
                        <div class='advanced-section'>
                            <h3 class='advanced-section-title'>
                                <i class="fas fa-project-diagram"></i> Investment Strategy
                            </h3>
                            <div class='strategy-toggle'>
                                <label class='toggle-option'>
                                    <input type='radio' name='strategy' value='dca' checked>
                                    <span>DCA (Monthly)</span>
                                </label>
                                <label class='toggle-option'>
                                    <input type='radio' name='strategy' value='lumpsum'>
                                    <span>Lump Sum</span>
                                </label>
                                <label class='toggle-option'>
                                    <input type='radio' name='strategy' value='compare'>
                                    <span>Compare Both</span>
                                </label>
                                <label class='toggle-option'>
                                    <input type='radio' name='strategy' value='withdrawal'>
                                    <span>Retirement Plan</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Parameters Grid -->
                        <div class='params-grid'>
                            <div class='param-group'>
                                <label for='monthlyInvestment'>
                                    Monthly Investment (EUR)
                                    <span class='help-icon help-icon-small' onclick='openModal("modalMCInvest")' title='What is DCA?'>?</span>
                                </label>
                                <input type='number' id='monthlyInvestment' value='200' step='10'>
                                <div class='hint'>DCA amount</div>
                            </div>
                            
                            <div class='param-group' id='lumpSumGroup' style='display: none;'>
                                <label for='lumpSumAmount'>Lump Sum Amount (EUR)</label>
                                <input type='number' id='lumpSumAmount' value='60000' step='1000'>
                                <div class='hint'>One-time investment</div>
                            </div>
                            
                            <div class='param-group' id='withdrawalRateGroup' style='display: none;'>
                                <label for='withdrawalRate'>Annual Withdrawal Rate (%)</label>
                                <input type='number' id='withdrawalRate' value='4' step='0.1' min='0' max='10'>
                                <div class='hint'>e.g., 4% rule</div>
                            </div>
                            
                            <div class='param-group' id='withdrawalStartGroup' style='display: none;'>
                                <label for='withdrawalStartYear'>Withdrawal Start Year</label>
                                <input type='number' id='withdrawalStartYear' value='15' step='1' min='1'>
                                <div class='hint'>When to retire</div>
                            </div>
                            
                            <div class='param-group'>
                                <label for='monthlyYield'>
                                    Est. Monthly Yield (%)
                                    <span class='help-icon help-icon-small' onclick='openModal("modalMCYield")' title='How to estimate yield?'>?</span>
                                </label>
                                <input type='number' id='monthlyYield' value='0.67' step='0.01'>
                                <div class='hint'>Expected return</div>
                            </div>
                            
                            <div class='param-group'>
                                <label for='volatility'>
                                    Volatility (%)
                                    <span class='help-icon help-icon-small' onclick='openModal("modalMCVol")' title='Understanding volatility'>?</span>
                                </label>
                                <input type='number' id='volatility' value='15' step='0.5'>
                                <div class='hint'>Annual std dev</div>
                            </div>
                            
                            <div class='param-group' id='degreesOfFreedomGroup' style='display: none;'>
                                <label for='degreesOfFreedom'>
                                    Student-t DF
                                    <span class='help-icon help-icon-small' onclick='openModal("modalStudentDF")' title='What is Degrees of Freedom?'>?</span>
                                </label>
                                <input type='number' id='degreesOfFreedom' value='5' step='1' min='2' max='30'>
                                <div class='hint'>2-10 recommended</div>
                            </div>

                            <div class='param-group' id='jumpIntensityGroup' style='display: none;'>
                                <label for='jumpIntensity'>
                                    Jump Intensity (Œª)
                                    <span class='help-icon help-icon-small' onclick='openModal("modalJumpIntensity")' title='What is Jump Intensity?'>?</span>
                                </label>
                                <input type='number' id='jumpIntensity' value='0.1' step='0.01' min='0' max='1'>
                                <div class='hint'>Jumps/year</div>
                            </div>

                            <div class='param-group' id='jumpMagnitudeGroup' style='display: none;'>
                                <label for='jumpMagnitude'>
                                    Jump Magnitude (%)
                                    <span class='help-icon help-icon-small' onclick='openModal("modalJumpMagnitude")' title='What is Jump Magnitude?'>?</span>
                                </label>
                                <input type='number' id='jumpMagnitude' value='-10' step='1'>
                                <div class='hint'>Average jump size</div>
                            </div>
                            
                            <div class='param-group'>
                                <label for='years'>Horizon (Years)</label>
                                <input type='number' id='years' value='25' step='1' min='1' max='50'>
                                <div class='hint'>Projection period</div>
                            </div>
                            
                            <div class='param-group'>
                                <label for='simulations'>
                                    Number of Simulations
                                    <span class='help-icon help-icon-small' onclick='openModal("modalMCSim")' title='How many simulations?'>?</span>
                                </label>
                                <input type='number' id='simulations' value='1000' step='100' min='100' max='50000'>
                                <div class='hint'>Max: 50,000</div>
                            </div>
                            
                            <div class='param-group'>
                                <label for='targetValue'>Target Value (EUR)</label>
                                <input type='number' id='targetValue' value='100000' step='1000'>
                                <div class='hint'>Goal amount</div>
                            </div>
                            
                            <div class='param-group'>
                                <label for='inflationRateMC'>Inflation Rate (%)</label>
                                <input type='number' id='inflationRateMC' value='2.5' step='0.1'>
                                <div class='hint'>Annual inflation</div>
                            </div>
                        </div>
                        
                        <!-- Options -->
                        <div class='advanced-toggles'>
                            <label class='toggle-checkbox'>
                                <input type='checkbox' id='showInflationMC'>
                                <span>Show Inflation-Adjusted Values</span>
                            </label>
                        </div>
                        
                        <button class='btn-simulate' onclick='MonteCarlo.runSimulation()'>
                            <i class="fas fa-play"></i> Run Simulation
                        </button>
                        
                        <!-- Progress -->
                        <div id='simulationProgress' class='simulation-progress' style='display: none;'>
                            <div class='progress-bar'>
                                <div class='progress-fill' id='progressFill'></div>
                            </div>
                            <div class='progress-text' id='progressText'>Initializing...</div>
                        </div>
                    </div>
                    
                    <!-- Results Panel -->
                    <div id='resultsPanel' class='results-panel hidden'>
                        
                        <!-- Export Controls -->
                        <div class='export-controls'>
                            <button class='btn-export' onclick='MonteCarlo.exportPDF()'>
                                <i class="fas fa-file-pdf"></i> Export PDF
                            </button>
                            <button class='btn-export' onclick='MonteCarlo.exportExcel()'>
                                <i class="fas fa-file-excel"></i> Export CSV
                            </button>
                        </div>
                        
                        <h2 class='section-title'>
                            <i class="fas fa-chart-bar"></i> Simulation Results
                            <span class='help-icon help-icon-small' onclick='openModal("modalMCResults")' title='How to read results?'>?</span>
                        </h2>
                        
                        <!-- Stats -->
                        <h3 class='subsection-title'>Final Portfolio Value</h3>
                        <div id='statsContainer' class='stats-grid'></div>
                        
                        <!-- Advanced Risk -->
                        <h3 class='subsection-title'>
                            <i class="fas fa-shield-alt"></i> Advanced Risk Metrics
                            <span class='help-icon help-icon-small' onclick='openModal("modalAdvancedRisk")' title='Advanced metrics explained'>?</span>
                        </h3>
                        <div id='advancedRiskMetrics' class='stats-grid'></div>
                        
                        <!-- Portfolio Evolution -->
                        <h3 class='subsection-title'>Portfolio Evolution Over Time</h3>
                        <div id='chart1' class='chart'></div>
                        
                        <!-- Distribution Charts -->
                        <div class='charts-grid-2'>
                            <div>
                                <h3 class='subsection-title'>Return Distribution</h3>
                                <div id='chart2' class='chart chart-medium'></div>
                            </div>
                            <div>
                                <h3 class='subsection-title'>Probability Analysis</h3>
                                <div id='chart3' class='chart chart-medium'></div>
                            </div>
                        </div>
                        
                        <!-- Max Drawdown -->
                        <h3 class='subsection-title'>
                            <i class="fas fa-arrow-down"></i> Maximum Drawdown
                            <span class='help-icon help-icon-small' onclick='openModal("modalDrawdown")' title='What is drawdown?'>?</span>
                        </h3>
                        <div id='drawdownStats' class='stats-grid'></div>
                        <div id='chartDrawdown' class='chart'></div>
                        
                        <!-- Risk Analysis -->
                        <h3 class='subsection-title'>
                            <i class="fas fa-exclamation-triangle"></i> Risk Analysis
                            <span class='help-icon help-icon-small' onclick='openModal("modalMCRisk")' title='Risk metrics explained'>?</span>
                        </h3>
                        <div id='riskAnalysis' class='stats-grid'></div>
                        
                        <!-- Tornado Diagram -->
                        <h3 class='subsection-title'>
                            <i class="fas fa-wind"></i> Sensitivity Analysis (Tornado)
                            <span class='help-icon help-icon-small' onclick='openModal("modalTornado")' title='What is a tornado diagram?'>?</span>
                        </h3>
                        <div id='chartTornado' class='chart'></div>
                        
                        <!-- Heat Map -->
                        <h3 class='subsection-title'>
                            <i class="fas fa-th"></i> 2D Parameter Heat Map
                            <span class='help-icon help-icon-small' onclick='openModal("modalHeatMap")' title='How to read heat map?'>?</span>
                        </h3>
                        <div id='chartHeatMap' class='chart'></div>
                        
                        <!-- Correlation Matrix -->
                        <h3 class='subsection-title'>
                            <i class="fas fa-table"></i> Metrics Correlation Matrix
                            <span class='help-icon help-icon-small' onclick='openModal("modalCorrelation")' title='How to read correlation?'>?</span>
                        </h3>
                        <div id='chartCorrelation' class='chart'></div>

                        <!-- Efficient Frontier -->
                        <h3 class='subsection-title'>
                            <i class="fas fa-chart-scatter"></i> Risk-Return Efficient Frontier
                            <span class='help-icon help-icon-small' onclick='openModal("modalFrontier")' title='What is efficient frontier?'>?</span>
                        </h3>
                        <div id='chartFrontier' class='chart'></div>

                        <!-- Stress Testing -->
                        <h3 class='subsection-title'>
                            Stress Testing
                            <span class='help-icon help-icon-small' onclick='openModal("modalStressTesting")' title='What is stress testing?'>?</span>
                        </h3>
                        <div id='chart4' class='chart'></div>

                        <!-- Time to Target -->
                        <h3 class='subsection-title'>
                            Time to Target
                            <span class='help-icon help-icon-small' onclick='openModal("modalTimeToTarget")' title='Understanding time to target'>?</span>
                        </h3>
                        <div id='chart5' class='chart'></div>

                        <!-- Rolling Sharpe -->
                        <h3 class='subsection-title'>
                            <i class="fas fa-clock"></i> Rolling Sharpe Ratio
                            <span class='help-icon help-icon-small' onclick='openModal("modalRollingSharpe")' title='What is rolling Sharpe?'>?</span>
                        </h3>
                        <div id='chartRollingSharpe' class='chart'></div>
                        
                        <!-- Strategy Comparison -->
                        <div id='strategyComparisonSection' style='display: none;'>
                            <h3 class='subsection-title'>
                                <i class="fas fa-code-compare"></i> DCA vs Lump Sum Comparison
                            </h3>
                            <div id='chartStrategyComparison' class='chart'></div>
                            <div id='strategyComparisonStats' class='stats-grid'></div>
                        </div>
                        
                        <!-- Withdrawal Analysis -->
                        <div id='withdrawalAnalysisSection' style='display: none;'>
                            <h3 class='subsection-title'>
                                <i class="fas fa-piggy-bank"></i> Retirement Withdrawal
                            </h3>
                            <div id='chartWithdrawal' class='chart'></div>
                            <div id='withdrawalStats' class='stats-grid'></div>
                        </div>
                    </div>
                </div>
                
                <footer>
                    <p>Monte Carlo Simulations</p>
                </footer>
            </div>
        </div>
        
    </div>
    
    <!-- ============================================
         TOUS LES MODALS
         ============================================ -->
    
    <!-- Modal: Introduction Monte Carlo -->
    <div id='modalMCIntro' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üé≤ Advanced Monte Carlo Simulation</h2>
                <span class='close-modal' onclick='closeModal("modalMCIntro")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üìä What's This?</h3>
                <p>This <strong>ultra-advanced</strong> Monte Carlo simulation includes professional-grade features:</p>
                
                <ul>
                    <li><strong>6 Distribution Models:</strong> Normal, Student-t, Log-Normal, Jump Diffusion, Regime Switching, GARCH</li>
                    <li><strong>4 Strategies:</strong> DCA, Lump Sum, Comparison, Retirement Withdrawal</li>
                    <li><strong>Advanced Metrics:</strong> CVaR, Maximum Drawdown, Sharpe, Sortino, Calmar Ratios</li>
                    <li><strong>Professional Charts:</strong> Tornado Diagram, Heat Maps, Correlation Matrix, Efficient Frontier</li>
                    <li><strong>Up to 50,000 simulations</strong> for maximum accuracy</li>
                </ul>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Pro Tip:</strong> Start with a Quick Template, then customize parameters for your specific needs!
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Templates -->
    <div id='modalTemplates' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üöÄ Quick Start Templates</h2>
                <span class='close-modal' onclick='closeModal("modalTemplates")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>Available Templates</h3>
                
                <h4>üõ° Conservative</h4>
                <ul>
                    <li>Monthly Investment: 500 EUR</li>
                    <li>Expected Yield: 0.4% monthly (‚âà5% annual)</li>
                    <li>Volatility: 8% (low risk)</li>
                    <li>Ideal for: Risk-averse investors, near retirement</li>
                </ul>
                
                <h4>‚öñ Balanced</h4>
                <ul>
                    <li>Monthly Investment: 300 EUR</li>
                    <li>Expected Yield: 0.58% monthly (‚âà7% annual)</li>
                    <li>Volatility: 12% (moderate risk)</li>
                    <li>Ideal for: Diversified 60/40 portfolio</li>
                </ul>
                
                <h4>üìà Aggressive</h4>
                <ul>
                    <li>Monthly Investment: 200 EUR</li>
                    <li>Expected Yield: 0.83% monthly (‚âà10% annual)</li>
                    <li>Volatility: 18% (high risk)</li>
                    <li>Ideal for: Long-term growth, young investors</li>
                </ul>
                
                <h4>üèñ Retirement</h4>
                <ul>
                    <li>Accumulation: 15 years @ 400 EUR/month</li>
                    <li>Withdrawal: 4% annual rule</li>
                    <li>Volatility: 10%</li>
                    <li>Ideal for: Retirement planning</li>
                </ul>
                
                <h4>‚Çø Crypto</h4>
                <ul>
                    <li>Monthly Investment: 100 EUR</li>
                    <li>Expected Yield: 1.5% monthly (‚âà20% annual)</li>
                    <li>Volatility: 60% (extreme risk)</li>
                    <li>Distribution: Jump Diffusion (captures crashes)</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Modal: Distribution Models -->
    <div id='modalDistribution' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìä Distribution Models Explained</h2>
                <span class='close-modal' onclick='closeModal("modalDistribution")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>Why Different Distributions?</h3>
                <p>Real markets don't follow perfect bell curves. Advanced models capture <strong>fat tails</strong> (crashes), <strong>jumps</strong> (sudden shocks), and <strong>regime changes</strong> (bull/bear cycles).</p>
                
                <h4>1‚É£ Normal (Gaussian)</h4>
                <p>Classic assumption: returns are symmetrically distributed around the mean.</p>
                <ul>
                    <li>‚úÖ Simple, widely used</li>
                    <li>‚ùå Underestimates extreme events (2008 crash, COVID)</li>
                </ul>
                
                <h4>2‚É£ Student-t</h4>
                <p>Heavier tails ‚Üí captures rare but severe crashes.</p>
                <ul>
                    <li>Parameter: Degrees of freedom (df). Lower df = fatter tails.</li>
                    <li>‚úÖ More realistic for equities</li>
                    <li>Recommended df: 5-10</li>
                </ul>
                
                <h4>3‚É£ Log-Normal</h4>
                <p>Returns are skewed to the right. Common in finance since prices can't go below zero.</p>
                <ul>
                    <li>‚úÖ Realistic for stock prices</li>
                    <li>‚úÖ Prevents negative values</li>
                </ul>
                
                <h4>4‚É£ Jump Diffusion (Merton Model)</h4>
                <p>Combines smooth drift + sudden jumps (e.g., market crashes).</p>
                <ul>
                    <li>Parameters: Jump intensity (Œª), jump magnitude</li>
                    <li>‚úÖ Models flash crashes, circuit breakers</li>
                </ul>
                
                <h4>5‚É£ Regime Switching</h4>
                <p>Markets alternate between <strong>bull</strong> (high return, low vol) and <strong>bear</strong> (low/negative return, high vol).</p>
                <ul>
                    <li>‚úÖ Captures economic cycles</li>
                    <li>Uses Markov chain for state transitions</li>
                </ul>
                
                <h4>6‚É£ GARCH</h4>
                <p>Volatility changes over time (volatility clustering).</p>
                <ul>
                    <li>‚úÖ Captures periods of high/low volatility</li>
                    <li>‚úÖ More realistic than constant volatility</li>
                </ul>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Recommendation:</strong> Use Student-t for stocks, Jump Diffusion for volatile assets, Normal for bonds.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Scenarios -->
    <div id='modalScenarios' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üíæ Scenario Manager</h2>
                <span class='close-modal' onclick='closeModal("modalScenarios")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>Save & Compare Simulations</h3>
                <p>The Scenario Manager lets you:</p>
                
                <ul>
                    <li><strong>Save</strong> up to 10 different simulation scenarios in Firebase</li>
                    <li><strong>Load</strong> saved scenarios to restore all parameters</li>
                    <li><strong>Compare</strong> 2-5 scenarios side-by-side in interactive charts</li>
                    <li><strong>Name</strong> each scenario for easy reference</li>
                    <li><strong>Delete</strong> unwanted scenarios</li>
                </ul>
                
                <h3>How to Load a Scenario</h3>
                <ol>
                    <li>Click the <strong>"Load"</strong> button on any saved scenario card</li>
                    <li>All parameters (distribution, strategy, values) will be restored</li>
                    <li>Click <strong>"Run Simulation"</strong> to reproduce the exact same results</li>
                </ol>
                
                <h3>How to Compare Scenarios</h3>
                <ol>
                    <li>Run 2-5 different simulations (e.g., Conservative vs Aggressive)</li>
                    <li>Click <strong>"Save Scenario"</strong> for each one</li>
                    <li>Check the boxes next to scenarios you want to compare</li>
                    <li>Click <strong>"Compare Scenarios"</strong></li>
                    <li>A detailed comparison modal will open with charts and statistics</li>
                </ol>
                
                <div class='example-box' style='background: linear-gradient(135deg, rgba(118, 75, 162, 0.12) 0%, rgba(102, 126, 234, 0.08) 100%); padding: 20px; border-radius: 16px; margin: 20px 0;'>
                    <strong>Example Use Case:</strong><br>
                    Compare "Conservative 2025" vs "Aggressive 2025" to see which strategy gives you the best risk-adjusted returns.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Monthly Investment -->
    <div id='modalMCInvest' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üí∞ Monthly Investment Strategy</h2>
                <span class='close-modal' onclick='closeModal("modalMCInvest")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üìà What Is Dollar-Cost Averaging (DCA)?</h3>
                <p>Investing a <strong>fixed amount regularly</strong> (e.g., 200 EUR/month) regardless of market conditions.</p>
                
                <h3>‚úÖ Advantages</h3>
                <ul>
                    <li><strong>Reduces timing risk:</strong> You buy more when prices are low, less when high</li>
                    <li><strong>Discipline:</strong> Automates investing, removes emotions</li>
                    <li><strong>Accessible:</strong> No need for large lump sum</li>
                    <li><strong>Compound growth:</strong> Early investments grow the longest</li>
                </ul>
                
                <h3>üìä Example</h3>
                <p>Investing 200 EUR/month for 25 years at 8% annual return:</p>
                <ul>
                    <li>Total Invested: 60,000 EUR</li>
                    <li>Expected Value: ~200,000 EUR</li>
                    <li>Gain: ~140,000 EUR (233% return)</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Modal: Monthly Yield -->
    <div id='modalMCYield' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìä Expected Monthly Yield</h2>
                <span class='close-modal' onclick='closeModal("modalMCYield")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üìê Definition</h3>
                <p>The <span class='key-term' style='background: linear-gradient(135deg, #667eea, #4A74F3); color: white; padding: 4px 12px; border-radius: 6px;'>Expected Yield</span> is the average return you anticipate <strong>per month</strong>. It's the central tendency around which random returns fluctuate.</p>
                
                <div class='formula-box' style='background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 28px; border-radius: 16px; margin: 25px 0; border-left: 6px solid #764ba2; font-family: monospace; font-size: 1.15rem;'>
                    <strong>Conversion Formula:</strong><br>
                    Monthly Yield = (1 + Annual Return)<sup>1/12</sup> - 1<br><br>
                    <strong>Approximation:</strong><br>
                    Monthly Yield ‚âà Annual Return / 12
                </div>
                
                <h3>üìà Common Values</h3>
                <ul>
                    <li><strong>0.4%/month</strong> ‚âà 5% annual (Conservative)</li>
                    <li><strong>0.58%/month</strong> ‚âà 7% annual (Balanced)</li>
                    <li><strong>0.67%/month</strong> ‚âà 8% annual (S&P 500 historical)</li>
                    <li><strong>0.83%/month</strong> ‚âà 10% annual (Aggressive)</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Modal: Volatility -->
    <div id='modalMCVol' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìâ Understanding Volatility</h2>
                <span class='close-modal' onclick='closeModal("modalMCVol")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üìä Definition</h3>
                <p><span class='key-term' style='background: linear-gradient(135deg, #667eea, #4A74F3); color: white; padding: 4px 12px; border-radius: 6px;'>Volatility</span> measures how much returns fluctuate around the average. High volatility = big swings up and down. Low volatility = stable returns.</p>
                
                <h3>üìà Typical Values (Annual)</h3>
                <ul>
                    <li><strong>Cash/Bonds:</strong> 2-6%</li>
                    <li><strong>Balanced Portfolio (60/40):</strong> 10-12%</li>
                    <li><strong>Global Stocks (S&P 500):</strong> 15-20%</li>
                    <li><strong>Emerging Markets:</strong> 25-35%</li>
                    <li><strong>Cryptocurrencies:</strong> 60-100%+</li>
                </ul>
                
                <h3>‚ö† Impact on Results</h3>
                <p>Higher volatility means:</p>
                <ul>
                    <li>Wider range of possible outcomes</li>
                    <li>Higher chance of extreme losses (and gains)</li>
                    <li>Lower probability of hitting specific targets</li>
                    <li>Higher risk-adjusted returns needed (Sharpe Ratio)</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Modal: Number of Simulations -->
    <div id='modalMCSim' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üî¢ Number of Simulations</h2>
                <span class='close-modal' onclick='closeModal("modalMCSim")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üéØ Why Multiple Simulations?</h3>
                <p>Each simulation is one possible future. Running many simulations creates a <strong>probability distribution</strong> of outcomes, giving you confidence intervals.</p>
                
                <h3>üìä How Many Do You Need?</h3>
                <ul>
                    <li><strong>100-500:</strong> Quick test, rough estimate (¬±5% accuracy)</li>
                    <li><strong>1,000:</strong> Standard (¬±2% accuracy) ‚Üí <strong>Recommended</strong></li>
                    <li><strong>5,000:</strong> High precision (¬±1% accuracy)</li>
                    <li><strong>10,000:</strong> Professional use (¬±0.5% accuracy)</li>
                    <li><strong>50,000:</strong> Academic/research (¬±0.2% accuracy)</li>
                </ul>
                
                <h3>‚ö° Performance Impact</h3>
                <p>Higher simulation counts take longer to compute:</p>
                <ul>
                    <li>1,000 sims: ~1-2 seconds</li>
                    <li>10,000 sims: ~5-10 seconds</li>
                    <li>50,000 sims: ~30-60 seconds</li>
                </ul>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Sweet Spot:</strong> 1,000-2,000 simulations offers the best balance between accuracy and speed for most use cases.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Student-t Degrees of Freedom -->
    <div id='modalStudentDF' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìä Student-t Degrees of Freedom (DF)</h2>
                <span class='close-modal' onclick='closeModal("modalStudentDF")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What Is It?</h3>
                <p>The <span class='key-term' style='background: linear-gradient(135deg, #667eea, #4A74F3); color: white; padding: 4px 12px; border-radius: 6px;'>Degrees of Freedom (DF)</span> is a parameter that controls the "thickness" of the tails in the Student-t distribution.</p>
                
                <h3>Why Student-t Instead of Normal?</h3>
                <p>Real financial markets have <strong>fat tails</strong> (more extreme events than the normal distribution predicts):</p>
                <ul>
                    <li>Normal distribution underestimates crashes (2008, COVID-19)</li>
                    <li>Student-t distribution captures extreme moves better</li>
                    <li>More realistic for equity and crypto markets</li>
                </ul>
                
                <div class='formula-box' style='background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 28px; border-radius: 16px; margin: 25px 0; border-left: 6px solid #764ba2;'>
                    <strong>Key Rule:</strong><br>
                    Lower DF = Fatter tails = More extreme events<br>
                    Higher DF ‚Üí Normal distribution (DF ‚â• 30)
                </div>
                
                <h3>Common DF Values & Their Meaning</h3>
                
                <h4>DF = 2-3 (Extreme Fat Tails)</h4>
                <ul>
                    <li>Extremely heavy tails</li>
                    <li>Use for: Cryptocurrencies, emerging markets</li>
                    <li>Frequent large swings (¬±20% moves common)</li>
                    <li>‚ö† High uncertainty</li>
                </ul>
                
                <h4>DF = 4-6 (Moderate Fat Tails) ‚≠ê RECOMMENDED</h4>
                <ul>
                    <li>Good balance for stocks</li>
                    <li>Use for: Equities, ETFs, moderate portfolios</li>
                    <li>Captures 2008-style crashes without being too extreme</li>
                    <li>‚úÖ Default choice for most simulations</li>
                </ul>
                
                <h4>DF = 7-10 (Slightly Fat Tails)</h4>
                <ul>
                    <li>Closer to normal but still realistic</li>
                    <li>Use for: Diversified portfolios, blue-chip stocks</li>
                    <li>Conservative approach</li>
                </ul>
                
                <h4>DF = 30+ (Essentially Normal)</h4>
                <ul>
                    <li>Behaves like a normal distribution</li>
                    <li>Use for: Bonds, cash-heavy portfolios</li>
                    <li>Underestimates tail risk</li>
                </ul>
                
                <h3>Visual Comparison</h3>
                <div class='example-box' style='background: linear-gradient(135deg, rgba(118, 75, 162, 0.12) 0%, rgba(102, 126, 234, 0.08) 100%); padding: 20px; border-radius: 16px; margin: 15px 0;'>
                    <strong>Example:</strong><br>
                    <strong>Normal Distribution:</strong> 99.7% of returns within ¬±3 standard deviations<br>
                    <strong>Student-t (DF=5):</strong> More returns beyond ¬±3œÉ (captures Black Swans)<br><br>
                    <strong>Real Impact:</strong> Student-t predicts a -30% crash every 10 years, while Normal might say "once in 100 years"
                </div>
                
                <h3>How to Choose DF</h3>
                <ol>
                    <li><strong>For stocks/ETFs:</strong> Use DF = 5 (default)</li>
                    <li><strong>For crypto:</strong> Use DF = 3</li>
                    <li><strong>For bonds:</strong> Use DF = 10-15 or Normal</li>
                    <li><strong>For diversified portfolios:</strong> Use DF = 6-8</li>
                </ol>
                
                <h3>Technical Note</h3>
                <p>The Student-t distribution was discovered by William Sealy Gosset (pen name "Student") in 1908 while working at Guinness Brewery. It's one of the most important distributions in statistics!</p>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Pro Tip:</strong> When in doubt, use DF = 5. It's the sweet spot between realism and stability for most financial assets.
                </div>
                
                <h3>Warning Signs You Need Student-t</h3>
                <ul>
                    <li>Your asset has experienced sudden crashes</li>
                    <li>Historical returns show outliers beyond ¬±3œÉ</li>
                    <li>You want to stress-test for tail risk</li>
                    <li>You're investing in volatile sectors (tech, energy, crypto)</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Modal: Jump Intensity -->
    <div id='modalJumpIntensity' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>‚ö° Jump Intensity (Œª) Explained</h2>
                <span class='close-modal' onclick='closeModal("modalJumpIntensity")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What Is It?</h3>
                <p>The <span class='key-term' style='background: linear-gradient(135deg, #667eea, #4A74F3); color: white; padding: 4px 12px; border-radius: 6px;'>Jump Intensity (Œª)</span> is the <strong>average number of sudden jumps (crashes or spikes) per year</strong> in the Jump Diffusion model.</p>
                
                <h3>The Jump Diffusion Model (Merton 1976)</h3>
                <p>Financial assets don't move smoothly. They experience:</p>
                <ul>
                    <li><strong>Normal drift:</strong> Gradual day-to-day movements</li>
                    <li><strong>Jumps:</strong> Sudden large moves (crashes, flash rallies)</li>
                </ul>
                
                <div class='formula-box' style='background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 28px; border-radius: 16px; margin: 25px 0; border-left: 6px solid #764ba2; font-family: monospace; font-size: 1.05rem;'>
                    <strong>Model Formula:</strong><br>
                    dS = ŒºS dt + œÉS dW + J dN<br><br>
                    Where:<br>
                    ‚Ä¢ ŒºS dt = Normal drift<br>
                    ‚Ä¢ œÉS dW = Normal volatility<br>
                    ‚Ä¢ J dN = Jump component<br>
                    ‚Ä¢ Œª (lambda) = Jump frequency<br>
                    ‚Ä¢ J = Jump magnitude
                </div>
                
                <h3>What Does Œª Mean?</h3>
                
                <h4>Œª = 0.1 (Low Jump Frequency)</h4>
                <ul>
                    <li>Meaning: <strong>1 jump every 10 years</strong> on average</li>
                    <li>Use for: Stable markets, blue-chip stocks</li>
                    <li>Example: Large-cap indices (S&P 500)</li>
                </ul>
                
                <h4>Œª = 0.2-0.3 (Moderate) ‚≠ê RECOMMENDED</h4>
                <ul>
                    <li>Meaning: <strong>1 jump every 3-5 years</strong></li>
                    <li>Use for: General equities, growth stocks</li>
                    <li>Realistic for most markets</li>
                    <li>Captures occasional crashes (2008, 2020, etc.)</li>
                </ul>
                
                <h4>Œª = 0.5-0.7 (High Jump Frequency)</h4>
                <ul>
                    <li>Meaning: <strong>1 jump every 1.5-2 years</strong></li>
                    <li>Use for: Small-caps, emerging markets</li>
                    <li>Volatile sectors (biotech, energy)</li>
                </ul>
                
                <h4>Œª = 1.0+ (Extreme Volatility)</h4>
                <ul>
                    <li>Meaning: <strong>‚â• 1 jump per year</strong></li>
                    <li>Use for: Cryptocurrencies, penny stocks</li>
                    <li>‚ö† Very high uncertainty</li>
                </ul>
                
                <h3>Real-World Examples</h3>
                <div class='example-box' style='background: linear-gradient(135deg, rgba(118, 75, 162, 0.12) 0%, rgba(102, 126, 234, 0.08) 100%); padding: 20px; border-radius: 16px; margin: 15px 0;'>
                    <strong>Historical Jumps (S&P 500):</strong><br>
                    ‚Ä¢ 1987: Black Monday (-20% in one day)<br>
                    ‚Ä¢ 2008: Lehman collapse (-9% in one day)<br>
                    ‚Ä¢ 2020: COVID crash (-12% in one day)<br>
                    ‚Ä¢ 2020: Recovery rally (+9% in one day)<br><br>
                    <strong>Analysis:</strong> ~4 major jumps in 35 years ‚Üí Œª ‚âà 0.11
                </div>
                
                <h3>How Jumps Are Simulated</h3>
                <p>In each month of simulation:</p>
                <ol>
                    <li>Calculate probability of jump: P = Œª / 12 (monthly)</li>
                    <li>Roll a random number (0 to 1)</li>
                    <li>If random &lt; P, a jump occurs</li>
                    <li>Add the jump magnitude to that month's return</li>
                </ol>
                
                <div class='formula-box' style='background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 20px; border-radius: 12px; margin: 15px 0; font-family: monospace;'>
                    <strong>Example Calculation:</strong><br>
                    Œª = 0.3 (3 jumps per 10 years)<br>
                    Monthly probability = 0.3 / 12 = 0.025 = 2.5%<br><br>
                    Result: Each month has a 2.5% chance of experiencing a jump
                </div>
                
                <h3>Choosing the Right Œª</h3>
                <table style='width: 100%; border-collapse: collapse; margin: 20px 0;'>
                    <tr style='background: linear-gradient(135deg, #667eea, #764ba2); color: white;'>
                        <th style='padding: 12px; text-align: left; border-radius: 8px 0 0 0;'>Asset Type</th>
                        <th style='padding: 12px; text-align: center; border-radius: 0 8px 0 0;'>Recommended Œª</th>
                    </tr>
                    <tr style='background: rgba(102, 126, 234, 0.1);'>
                        <td style='padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.1);'>Government Bonds</td>
                        <td style='padding: 10px; text-align: center; border-bottom: 1px solid rgba(0,0,0,0.1);'>0.05 - 0.1</td>
                    </tr>
                    <tr>
                        <td style='padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.1);'>Large-Cap Stocks</td>
                        <td style='padding: 10px; text-align: center; border-bottom: 1px solid rgba(0,0,0,0.1);'>0.1 - 0.2</td>
                    </tr>
                    <tr style='background: rgba(102, 126, 234, 0.1);'>
                        <td style='padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.1);'>Growth Stocks</td>
                        <td style='padding: 10px; text-align: center; border-bottom: 1px solid rgba(0,0,0,0.1);'>0.2 - 0.4</td>
                    </tr>
                    <tr>
                        <td style='padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.1);'>Small-Caps / EM</td>
                        <td style='padding: 10px; text-align: center; border-bottom: 1px solid rgba(0,0,0,0.1);'>0.4 - 0.7</td>
                    </tr>
                    <tr style='background: rgba(102, 126, 234, 0.1);'>
                        <td style='padding: 10px; border-radius: 0 0 0 8px;'>Cryptocurrencies</td>
                        <td style='padding: 10px; text-align: center; border-radius: 0 0 8px 0;'>0.8 - 2.0</td>
                    </tr>
                </table>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Pro Tip:</strong> Start with Œª = 0.3 for stocks. If your asset has experienced more frequent crashes historically, increase to 0.5. For very stable assets, decrease to 0.1.
                </div>
                
                <h3>Combined with Jump Magnitude</h3>
                <p>Jump Intensity (Œª) and Jump Magnitude work together:</p>
                <ul>
                    <li><strong>High Œª + Small magnitude:</strong> Frequent small jumps</li>
                    <li><strong>Low Œª + Large magnitude:</strong> Rare but severe crashes (‚ö† most realistic)</li>
                    <li><strong>High Œª + Large magnitude:</strong> Extremely volatile (crypto-like)</li>
                </ul>
                
                <div class='warning-box' style='background: linear-gradient(135deg, #9D5CE6 0%, #C39BD3 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    ‚ö† <strong>Warning:</strong> Setting Œª too high (&gt; 1.0) with large negative jumps can result in unrealistically pessimistic scenarios. Calibrate based on historical data.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Jump Magnitude -->
    <div id='modalJumpMagnitude' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìâ Jump Magnitude (%) Explained</h2>
                <span class='close-modal' onclick='closeModal("modalJumpMagnitude")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What Is It?</h3>
                <p>The <span class='key-term' style='background: linear-gradient(135deg, #667eea, #4A74F3); color: white; padding: 4px 12px; border-radius: 6px;'>Jump Magnitude</span> is the <strong>average size of sudden moves</strong> (in percentage) when a jump occurs in the Jump Diffusion model.</p>
                
                <h3>Understanding the Parameter</h3>
                <ul>
                    <li><strong>Negative value:</strong> Average jump is a crash (down move)</li>
                    <li><strong>Positive value:</strong> Average jump is a spike (up move)</li>
                    <li><strong>Zero:</strong> Jumps can be up or down equally</li>
                </ul>
                
                <div class='formula-box' style='background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 28px; border-radius: 16px; margin: 25px 0; border-left: 6px solid #764ba2;'>
                    <strong>How It Works:</strong><br>
                    When a jump occurs (determined by Œª):<br>
                    1. The jump size is drawn from a distribution<br>
                    2. The average of this distribution = Jump Magnitude<br>
                    3. Example: -10% means average crash of 10%
                </div>
                
                <h3>Common Jump Magnitude Values</h3>
                
                <h4>-5% to -8% (Moderate Corrections)</h4>
                <ul>
                    <li>Use for: Stable stocks, diversified portfolios</li>
                    <li>Represents: Standard market corrections</li>
                    <li>Real example: Tech selloffs, profit-taking</li>
                </ul>
                
                <h4>-10% to -15% (Significant Crashes) ‚≠ê RECOMMENDED</h4>
                <ul>
                    <li>Use for: General equities, growth stocks</li>
                    <li>Represents: Major market events</li>
                    <li>Real examples:</li>
                    <ul>
                        <li>2020 COVID initial drop: -12%</li>
                        <li>2008 Lehman: -9%</li>
                        <li>Flash crashes: -10% to -15%</li>
                    </ul>
                </ul>
                
                <h4>-20% to -30% (Severe Crashes)</h4>
                <ul>
                    <li>Use for: High-risk assets, emerging markets</li>
                    <li>Represents: Black Swan events</li>
                    <li>Real example: 1987 Black Monday (-20%)</li>
                </ul>
                
                <h4>-40%+ (Catastrophic Events)</h4>
                <ul>
                    <li>Use for: Cryptocurrencies, extremely volatile assets</li>
                    <li>Represents: Wipeout scenarios</li>
                    <li>Real examples: Crypto crashes (BTC -50% days)</li>
                </ul>
                
                <h3>Positive Jumps (Rally Spikes)</h3>
                <p>You can also model <strong>positive jumps</strong> for sudden rallies:</p>
                
                <h4>+5% to +10% (Strong Rallies)</h4>
                <ul>
                    <li>Use for: Growth stocks, tech sector</li>
                    <li>Real examples:</li>
                    <ul>
                        <li>2020 vaccine rally: +9%</li>
                        <li>Fed pivot rallies: +5% to +8%</li>
                    </ul>
                </ul>
                
                <h4>+15%+ (Extreme Bull Moves)</h4>
                <ul>
                    <li>Use for: Meme stocks, crypto</li>
                    <li>Real examples: GME (+100% days), crypto pumps</li>
                </ul>
                
                <h3>Historical Market Jumps</h3>
                <div class='example-box' style='background: linear-gradient(135deg, rgba(118, 75, 162, 0.12) 0%, rgba(102, 126, 234, 0.08) 100%); padding: 20px; border-radius: 16px; margin: 15px 0;'>
                    <strong>S&P 500 Largest Single-Day Moves (Since 1950):</strong><br><br>
                    <strong>Crashes (Negative):</strong><br>
                    ‚Ä¢ Oct 1987: <span style='color: #f5576c; font-weight: 800;'>-20.5%</span> (Black Monday)<br>
                    ‚Ä¢ Oct 2008: <span style='color: #f5576c; font-weight: 800;'>-9.0%</span> (Financial Crisis)<br>
                    ‚Ä¢ Mar 2020: <span style='color: #f5576c; font-weight: 800;'>-12.0%</span> (COVID)<br><br>
                    <strong>Rallies (Positive):</strong><br>
                    ‚Ä¢ Oct 2008: <span style='color: #43e97b; font-weight: 800;'>+11.6%</span> (Bear rally)<br>
                    ‚Ä¢ Mar 2020: <span style='color: #43e97b; font-weight: 800;'>+9.4%</span> (Recovery)<br>
                    ‚Ä¢ Mar 2009: <span style='color: #43e97b; font-weight: 800;'>+10.8%</span> (Bottom)<br><br>
                    <strong>Average crash magnitude: -10% to -12%</strong>
                </div>
                
                <h3>Asymmetric Jumps (Realistic Approach)</h3>
                <p>Markets tend to:</p>
                <ul>
                    <li><strong>Crash faster than they rally</strong> ("Stairs up, elevator down")</li>
                    <li><strong>Have larger negative jumps than positive</strong></li>
                    <li>This is called <strong>negative skewness</strong></li>
                </ul>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Pro Tip:</strong> For equities, use <strong>-10% to -15%</strong> jump magnitude. This captures realistic crash scenarios without being overly pessimistic.
                </div>
                
                <h3>Calibrating Jump Magnitude</h3>
                
                <h4>Method 1: Historical Data</h4>
                <ol>
                    <li>Find the 5 largest down days for your asset</li>
                    <li>Calculate the average of these moves</li>
                    <li>Use this as your Jump Magnitude</li>
                </ol>
                
                <h4>Method 2: Stress Scenario</h4>
                <ol>
                    <li>Ask: "What's a realistic worst-case single-day drop?"</li>
                    <li>For stocks: -10% to -15%</li>
                    <li>For crypto: -30% to -50%</li>
                    <li>For bonds: -2% to -5%</li>
                </ol>
                
                <h3>Combined with Jump Intensity</h3>
                <table style='width: 100%; border-collapse: collapse; margin: 20px 0;'>
                    <tr style='background: linear-gradient(135deg, #667eea, #764ba2); color: white;'>
                        <th style='padding: 12px; text-align: left;'>Jump Intensity (Œª)</th>
                        <th style='padding: 12px; text-align: center;'>Jump Magnitude</th>
                        <th style='padding: 12px; text-align: right;'>Scenario</th>
                    </tr>
                    <tr style='background: rgba(102, 126, 234, 0.1);'>
                        <td style='padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.1);'>Low (0.1)</td>
                        <td style='padding: 10px; text-align: center; border-bottom: 1px solid rgba(0,0,0,0.1);'>Large (-20%)</td>
                        <td style='padding: 10px; text-align: right; border-bottom: 1px solid rgba(0,0,0,0.1);'>Rare catastrophes</td>
                    </tr>
                    <tr>
                        <td style='padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.1);'>Moderate (0.3)</td>
                        <td style='padding: 10px; text-align: center; border-bottom: 1px solid rgba(0,0,0,0.1);'>Moderate (-10%)</td>
                        <td style='padding: 10px; text-align: right; border-bottom: 1px solid rgba(0,0,0,0.1);'>‚≠ê Realistic (stocks)</td>
                    </tr>
                    <tr style='background: rgba(102, 126, 234, 0.1);'>
                        <td style='padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.1);'>High (0.7)</td>
                        <td style='padding: 10px; text-align: center; border-bottom: 1px solid rgba(0,0,0,0.1);'>Small (-5%)</td>
                        <td style='padding: 10px; text-align: right; border-bottom: 1px solid rgba(0,0,0,0.1);'>Frequent corrections</td>
                    </tr>
                    <tr>
                        <td style='padding: 10px;'>Very High (1.5)</td>
                        <td style='padding: 10px; text-align: center;'>Very Large (-40%)</td>
                        <td style='padding: 10px; text-align: right;'>Crypto chaos</td>
                    </tr>
                </table>
                
                <h3>Advanced: Variable Jump Magnitude</h3>
                <p>In reality, not all jumps are the same size. The model assumes:</p>
                <ul>
                    <li>Jump size follows a <strong>normal distribution</strong></li>
                    <li>Your input is the <strong>mean</strong> of this distribution</li>
                    <li>Actual jumps vary around this mean</li>
                </ul>
                
                <div class='formula-box' style='background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 20px; border-radius: 12px; margin: 15px 0; font-family: monospace;'>
                    <strong>Example:</strong><br>
                    Jump Magnitude = -10%<br>
                    Standard Deviation = 5%<br><br>
                    Possible jump outcomes:<br>
                    ‚Ä¢ 68% of jumps: -15% to -5%<br>
                    ‚Ä¢ 95% of jumps: -20% to 0%<br>
                    ‚Ä¢ Occasional extreme: -25% or worse
                </div>
                
                <h3>Recommended Settings by Asset Class</h3>
                <ul>
                    <li><strong>S&P 500 / Large-Cap ETFs:</strong> -10% (realistic crashes)</li>
                    <li><strong>Tech / Growth Stocks:</strong> -12% to -15% (higher volatility)</li>
                    <li><strong>Small-Caps:</strong> -15% to -20% (wild swings)</li>
                    <li><strong>Emerging Markets:</strong> -20% to -25% (geopolitical risk)</li>
                    <li><strong>Bitcoin / Crypto:</strong> -30% to -50% (extreme moves)</li>
                    <li><strong>Bonds:</strong> -3% to -5% (stable, low jumps)</li>
                </ul>
                
                <div class='warning-box' style='background: linear-gradient(135deg, #9D5CE6 0%, #C39BD3 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    ‚ö† <strong>Important:</strong> Jump Magnitude is applied to the <strong>monthly return</strong>, not the portfolio value. A -10% jump means that month's return drops by an additional 10 percentage points.
                </div>
                
                <h3>Testing Your Settings</h3>
                <p>After running the simulation, check:</p>
                <ol>
                    <li><strong>Maximum Drawdown:</strong> Does it match historical crashes?</li>
                    <li><strong>Worst Case scenario:</strong> Is it realistic or too extreme?</li>
                    <li><strong>Frequency of large drops:</strong> Compare to actual market history</li>
                </ol>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Final Tip:</strong> Conservative approach: Use Œª = 0.3 and Jump Magnitude = -10% for stocks. This captures the risk of a significant crash every 3-4 years, similar to real market behavior.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Results Interpretation -->
    <div id='modalMCResults' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìä How to Read Your Results</h2>
                <span class='close-modal' onclick='closeModal("modalMCResults")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üìà Key Metrics Explained</h3>
                
                <h4>1‚É£ Median (50th Percentile)</h4>
                <p>The <span class='key-term' style='background: linear-gradient(135deg, #667eea, #4A74F3); color: white; padding: 4px 12px; border-radius: 6px;'>middle value</span> when all outcomes are sorted. <strong>50% of simulations are above</strong> this, 50% below.</p>
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 15px; border-radius: 12px; margin: 15px 0;'>üí° <strong>Use this</strong> as your most likely outcome.</div>
                
                <h4>2‚É£ 10th Percentile (Pessimistic)</h4>
                <p>Only <strong>10% of scenarios are worse</strong> than this. Think of it as a "bad luck" scenario.</p>
                
                <h4>3‚É£ 90th Percentile (Optimistic)</h4>
                <p>Only <strong>10% of scenarios are better</strong> than this. Think of it as a "good luck" scenario.</p>
                
                <h4>4‚É£ Average</h4>
                <p>The arithmetic mean of all outcomes. Can be skewed by extreme values.</p>
                
                <h4>5‚É£ Best/Worst Case</h4>
                <p>The extreme outcomes. Useful for understanding the full range of possibilities.</p>
                
                <h3>üìä Interpreting the Range</h3>
                <p>The difference between P10 and P90 shows your <strong>uncertainty</strong>:</p>
                <ul>
                    <li>Narrow range (P90/P10 &lt; 2x): Predictable outcome</li>
                    <li>Wide range (P90/P10 &gt; 3x): High uncertainty</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Modal: Risk Metrics -->
    <div id='modalMCRisk' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>‚ö† Risk Metrics Explained</h2>
                <span class='close-modal' onclick='closeModal("modalMCRisk")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üìä Key Risk Indicators</h3>
                
                <h4>1‚É£ Value at Risk (VaR) 5%</h4>
                <p><span class='key-term' style='background: linear-gradient(135deg, #667eea, #4A74F3); color: white; padding: 4px 12px; border-radius: 6px;'>VaR 5%</span> = The 5th percentile outcome. <strong>95% of scenarios are better</strong> than this.</p>
                <p>Example: VaR 5% = 50,000 EUR means there's only a 5% chance you'll end up with less than 50,000 EUR.</p>
                
                <h4>2‚É£ Loss Probability</h4>
                <p>% of simulations where you <strong>end up with less than you invested</strong> (no gains, or losses).</p>
                <p>Lower is better. Ideally &lt;5%.</p>
                
                <h4>3‚É£ Average/Median Return</h4>
                <p>Your expected return as a percentage of total invested capital.</p>
                
                <div class='warning-box' style='background: linear-gradient(135deg, #9D5CE6 0%, #C39BD3 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    ‚ö† <strong>Important:</strong> These metrics assume historical patterns continue. Past performance does not guarantee future results.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Advanced Risk Metrics -->
    <div id='modalAdvancedRisk' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìâ Advanced Risk Metrics</h2>
                <span class='close-modal' onclick='closeModal("modalAdvancedRisk")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>Professional Risk Measures</h3>
                
                <h4>1‚É£ CVaR (Conditional Value at Risk)</h4>
                <p>Also called <strong>Expected Shortfall</strong>. Average loss in the worst 5% of cases.</p>
                <div class='formula-box' style='background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 20px; border-radius: 12px; margin: 15px 0; font-family: monospace;'>
                    CVaR = E[Loss | Loss &gt; VaR]
                </div>
                <p>More conservative than VaR (used by Basel III banking regulations).</p>
                
                <h4>2‚É£ Maximum Drawdown</h4>
                <p>Largest peak-to-trough decline during the investment period.</p>
                <p>Shows the worst loss you'd experience before recovery.</p>
                
                <h4>3‚É£ Sharpe Ratio</h4>
                <p>Risk-adjusted return. Higher is better (&gt;1 is good, &gt;2 is excellent).</p>
                
                <h4>4‚É£ Sortino Ratio</h4>
                <p>Like Sharpe Ratio but only penalizes <strong>downside volatility</strong>.</p>
                
                <h4>5‚É£ Calmar Ratio</h4>
                <p>Annual return divided by maximum drawdown. Higher is better.</p>
                
                <h4>6‚É£ Skewness & Kurtosis</h4>
                <ul>
                    <li><strong>Skewness:</strong> Asymmetry (negative = more left-tail risk)</li>
                    <li><strong>Kurtosis:</strong> Tail thickness (&gt;3 = fat tails, more extreme events)</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Modal: Maximum Drawdown -->
    <div id='modalDrawdown' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìâ Maximum Drawdown Explained</h2>
                <span class='close-modal' onclick='closeModal("modalDrawdown")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>Definition</h3>
                <p><strong>Maximum Drawdown (MDD)</strong> is the largest percentage drop from a peak to a trough in your portfolio value.</p>
                
                <div class='formula-box' style='background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 20px; border-radius: 12px; margin: 15px 0; font-family: monospace;'>
                    MDD = (Trough Value - Peak Value) / Peak Value √ó 100%
                </div>
                
                <h3>Why It Matters</h3>
                <ul>
                    <li><strong>Psychological Test:</strong> Can you stomach a -30% drop?</li>
                    <li><strong>Recovery Time:</strong> How long to get back to break-even?</li>
                    <li><strong>Strategy Viability:</strong> Too deep = strategy may fail</li>
                </ul>
                
                <h3>Example</h3>
                <div class='example-box' style='background: linear-gradient(135deg, rgba(118, 75, 162, 0.12) 0%, rgba(102, 126, 234, 0.08) 100%); padding: 20px; border-radius: 12px; margin: 15px 0;'>
                    Your portfolio peaks at 100,000 EUR, then drops to 70,000 EUR.<br>
                    <strong>MDD = -30%</strong><br><br>
                    To recover, you need a <strong>+42.9% gain</strong> (not +30%)!
                </div>
                
                <div class='warning-box' style='background: linear-gradient(135deg, #9D5CE6 0%, #C39BD3 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    ‚ö† <strong>Rule of Thumb:</strong> Most investors panic-sell after 20-30% drawdowns. Plan accordingly!
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Tornado Diagram -->
    <div id='modalTornado' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üå™ Tornado Diagram (Sensitivity Analysis)</h2>
                <span class='close-modal' onclick='closeModal("modalTornado")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What Is It?</h3>
                <p>A <strong>tornado diagram</strong> shows which input parameters have the <strong>biggest impact</strong> on your final portfolio value.</p>
                
                <h3>How to Read It</h3>
                <ul>
                    <li>Each bar shows the effect of ¬±10% change in that parameter</li>
                    <li>Longer bars = more sensitive (higher impact)</li>
                    <li>Bars are sorted by impact (largest first)</li>
                    <li>Red = decrease (-10%), Green = increase (+10%)</li>
                </ul>
                
                <div class='example-box' style='background: linear-gradient(135deg, rgba(118, 75, 162, 0.12) 0%, rgba(102, 126, 234, 0.08) 100%); padding: 20px; border-radius: 12px; margin: 15px 0;'>
                    <strong>Example:</strong><br>
                    If <strong>Volatility</strong> has the longest bar, reducing volatility will have the biggest positive effect on your outcomes.
                </div>
                
                <h3>Why It's Useful</h3>
                <ul>
                    <li>Identify <strong>key drivers</strong> of portfolio success</li>
                    <li>Focus optimization efforts on high-impact parameters</li>
                    <li>Understand which assumptions matter most</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Modal: Heat Map -->
    <div id='modalHeatMap' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üå° 2D Parameter Heat Map</h2>
                <span class='close-modal' onclick='closeModal("modalHeatMap")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What Is It?</h3>
                <p>A <strong>heat map</strong> visualizes portfolio outcomes across different combinations of <strong>Expected Return</strong> (X-axis) and <strong>Volatility</strong> (Y-axis).</p>
                
                <h3>Color Legend</h3>
                <ul>
                    <li>üî¥ <strong>Red:</strong> Low portfolio values (worse outcomes)</li>
                    <li>üü° <strong>Yellow:</strong> Moderate values</li>
                    <li>üü¢ <strong>Green:</strong> High portfolio values (better outcomes)</li>
                </ul>
                
                <h3>How to Use It</h3>
                <ul>
                    <li>Find your current parameters on the map</li>
                    <li>Explore "what-if" scenarios by moving to different cells</li>
                    <li>Identify the <strong>optimal risk/return balance</strong></li>
                </ul>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Insight:</strong> The heat map often shows diminishing returns at very high volatility levels. There's a sweet spot!
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Correlation Matrix -->
    <div id='modalCorrelation' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìä Correlation Matrix Explained</h2>
                <span class='close-modal' onclick='closeModal("modalCorrelation")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What Is It?</h3>
                <p>A <strong>correlation matrix</strong> shows how different metrics are related to each other. Values range from -1 to +1.</p>
                
                <h3>How to Read It</h3>
                <ul>
                    <li><strong>+1 (Green):</strong> Perfect positive correlation. When one goes up, the other goes up.</li>
                    <li><strong>0 (White):</strong> No correlation. Metrics are independent.</li>
                    <li><strong>-1 (Red):</strong> Perfect negative correlation. When one goes up, the other goes down.</li>
                </ul>
                
                <h3>Metrics Analyzed</h3>
                <ul>
                    <li><strong>Final Value:</strong> Your portfolio at the end of the simulation</li>
                    <li><strong>Max Drawdown:</strong> Largest peak-to-trough decline</li>
                    <li><strong>Volatility:</strong> How much returns fluctuate</li>
                    <li><strong>Sharpe Ratio:</strong> Risk-adjusted return</li>
                </ul>
                
                <div class='example-box' style='background: linear-gradient(135deg, rgba(118, 75, 162, 0.12) 0%, rgba(102, 126, 234, 0.08) 100%); padding: 20px; border-radius: 16px; margin: 15px 0;'>
                    <strong>Example Interpretation:</strong><br>
                    If <strong>Volatility</strong> and <strong>Max Drawdown</strong> show +0.85, it means high volatility usually leads to larger drawdowns.
                </div>
                
                <h3>Why It's Useful</h3>
                <ul>
                    <li>Identify hidden relationships between risk metrics</li>
                    <li>Understand which factors move together</li>
                    <li>Validate your risk management assumptions</li>
                </ul>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Pro Tip:</strong> Look for unexpected correlations. If Final Value and Max Drawdown have low correlation, your strategy might be well-balanced!
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Efficient Frontier -->
    <div id='modalFrontier' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìà Efficient Frontier Explained</h2>
                <span class='close-modal' onclick='closeModal("modalFrontier")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What Is It?</h3>
                <p>The <strong>Efficient Frontier</strong> is a curve showing the best possible return for each level of risk (volatility).</p>
                
                <h3>Key Concept</h3>
                <p>Invented by Harry Markowitz (Nobel Prize 1990), the Efficient Frontier represents portfolios that offer:</p>
                <ul>
                    <li>Maximum return for a given level of risk</li>
                    <li>Minimum risk for a given level of return</li>
                </ul>
                
                <div class='formula-box' style='background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 20px; border-radius: 12px; margin: 15px 0; font-family: monospace;'>
                    <strong>Modern Portfolio Theory:</strong><br>
                    Optimal Portfolio = Max(Return) / Risk<br>
                    Subject to: Risk ‚â§ Risk_Tolerance
                </div>
                
                <h3>How to Read the Chart</h3>
                <ul>
                    <li><strong>X-axis:</strong> Volatility (Risk) in %</li>
                    <li><strong>Y-axis:</strong> Annual Return in %</li>
                    <li><strong>The Curve:</strong> Points on the curve are "efficient" (optimal risk/return)</li>
                    <li><strong>Below the Curve:</strong> Suboptimal portfolios (can do better)</li>
                </ul>
                
                <h3>The Sweet Spot</h3>
                <div class='example-box' style='background: linear-gradient(135deg, rgba(118, 75, 162, 0.12) 0%, rgba(102, 126, 234, 0.08) 100%); padding: 20px; border-radius: 16px; margin: 15px 0;'>
                    <strong>Look for the "elbow" of the curve:</strong><br>
                    This is where you get the most return for the least additional risk. Beyond this point, you take much more risk for diminishing returns.
                </div>
                
                <h3>Practical Use</h3>
                <ul>
                    <li>Find your <strong>risk tolerance</strong> on the X-axis</li>
                    <li>Read the corresponding <strong>expected return</strong> on the Y-axis</li>
                    <li>Portfolios to the right = higher risk, higher potential return</li>
                    <li>Portfolios to the left = lower risk, lower return</li>
                </ul>
                
                <div class='warning-box' style='background: linear-gradient(135deg, #9D5CE6 0%, #C39BD3 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    ‚ö† <strong>Important:</strong> The frontier is based on historical data and assumptions. Real markets can behave differently, especially during crises.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Stress Testing -->
    <div id='modalStressTesting' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>‚ö° Stress Testing Explained</h2>
                <span class='close-modal' onclick='closeModal("modalStressTesting")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What Is It?</h3>
                <p><strong>Stress testing</strong> simulates how your portfolio would perform under extreme market conditions (crashes, recessions, bull markets).</p>
                
                <h3>The 4 Scenarios</h3>
                
                <h4>1‚É£ Crisis (-40%)</h4>
                <p>Severe market crash (like 2008 Financial Crisis or COVID-19 initial shock).</p>
                <ul>
                    <li>Your portfolio value drops by 40%</li>
                    <li>Tests worst-case resilience</li>
                    <li>Historical example: S&P 500 fell 57% in 2008-2009</li>
                </ul>
                
                <h4>2‚É£ Recession (-20%)</h4>
                <p>Moderate economic downturn (typical recession).</p>
                <ul>
                    <li>Portfolio value drops by 20%</li>
                    <li>More common than severe crises</li>
                    <li>Historical example: 2022 bear market (-25%)</li>
                </ul>
                
                <h4>3‚É£ Normal (0%)</h4>
                <p>Baseline scenario with no additional shock.</p>
                <ul>
                    <li>Your expected median outcome</li>
                    <li>Reference point for comparison</li>
                </ul>
                
                <h4>4‚É£ Bull Market (+20%)</h4>
                <p>Strong economic growth (like 2020-2021 recovery).</p>
                <ul>
                    <li>Portfolio value increases by 20%</li>
                    <li>Upside potential scenario</li>
                    <li>Historical example: 2019 (+31%), 2021 (+27%)</li>
                </ul>
                
                <h3>How to Use It</h3>
                <div class='example-box' style='background: linear-gradient(135deg, rgba(118, 75, 162, 0.12) 0%, rgba(102, 126, 234, 0.08) 100%); padding: 20px; border-radius: 16px; margin: 15px 0;'>
                    <strong>Ask yourself:</strong><br>
                    - Can I afford to lose 40% in a crisis?<br>
                    - Will the Crisis scenario still meet my minimum needs?<br>
                    - Am I psychologically prepared for the worst case?
                </div>
                
                <h3>Why It Matters</h3>
                <ul>
                    <li><strong>Risk Management:</strong> Know your downside before it happens</li>
                    <li><strong>Peace of Mind:</strong> Reduce panic-selling during crashes</li>
                    <li><strong>Strategic Planning:</strong> Adjust asset allocation if stress results are unacceptable</li>
                </ul>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Pro Tip:</strong> If the "Crisis" scenario still leaves you with an acceptable portfolio value, your strategy is robust!
                </div>
                
                <h3>Regulatory Use</h3>
                <p>Banks and institutions are required by law (Basel III, Dodd-Frank) to perform stress tests to ensure financial stability. You're using the same professional techniques!</p>
            </div>
        </div>
    </div>
    
    <!-- Modal: Time to Target -->
    <div id='modalTimeToTarget' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>‚è± Time to Target Explained</h2>
                <span class='close-modal' onclick='closeModal("modalTimeToTarget")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What Is It?</h3>
                <p>This chart shows <strong>how long it takes</strong> (in months/years) to reach your target portfolio value across all simulations.</p>
                
                <h3>How to Read It</h3>
                <ul>
                    <li><strong>X-axis:</strong> Number of months</li>
                    <li><strong>Y-axis:</strong> Frequency (how many simulations)</li>
                    <li><strong>Peak of the curve:</strong> Most likely time to reach your goal</li>
                    <li><strong>Subtitle shows:</strong> Success rate & median time</li>
                </ul>
                
                <h3>Key Metrics</h3>
                
                <h4>Success Rate</h4>
                <p>Percentage of simulations that reached the target within the time horizon.</p>
                <div class='example-box' style='background: linear-gradient(135deg, rgba(118, 75, 162, 0.12) 0%, rgba(102, 126, 234, 0.08) 100%); padding: 20px; border-radius: 16px; margin: 15px 0;'>
                    <strong>Example:</strong><br>
                    Success Rate: 85% means 850 out of 1,000 simulations reached your target. 150 simulations did not.
                </div>
                
                <h4>Median Time</h4>
                <p>The middle value: 50% of successful simulations reached the target faster, 50% slower.</p>
                
                <h3>Interpreting the Shape</h3>
                <ul>
                    <li><strong>Narrow peak:</strong> Predictable timeline (low uncertainty)</li>
                    <li><strong>Wide spread:</strong> High uncertainty (depends heavily on market conditions)</li>
                    <li><strong>Skewed right:</strong> Some simulations take much longer (tail risk)</li>
                </ul>
                
                <h3>What If Target Is Not Reached?</h3>
                <p>If many simulations don't reach your target, you can:</p>
                <ul>
                    <li>Increase monthly investment amount</li>
                    <li>Extend time horizon</li>
                    <li>Lower target value</li>
                    <li>Accept higher risk (higher expected return)</li>
                </ul>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Pro Tip:</strong> If the median time is much shorter than your time horizon, you might be able to reduce risk (lower volatility) and still reach your goal!
                </div>
                
                <h3>Real-World Example</h3>
                <div class='formula-box' style='background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 20px; border-radius: 12px; margin: 15px 0;'>
                    <strong>Scenario:</strong><br>
                    Target: 100,000 EUR<br>
                    Median time: 18.5 years<br>
                    Success: 92%<br><br>
                    <strong>Interpretation:</strong> You have a 92% chance of reaching 100k, most likely in about 18-19 years.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Rolling Sharpe -->
    <div id='modalRollingSharpe' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìà Rolling Sharpe Ratio Explained</h2>
                <span class='close-modal' onclick='closeModal("modalRollingSharpe")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>What Is Sharpe Ratio?</h3>
                <p>The <strong>Sharpe Ratio</strong> measures risk-adjusted return. It answers: "How much return am I getting per unit of risk?"</p>
                
                <div class='formula-box' style='background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 28px; border-radius: 16px; margin: 25px 0; border-left: 6px solid #764ba2; font-family: monospace; font-size: 1.15rem;'>
                    <strong>Formula:</strong><br>
                    Sharpe Ratio = (Return - Risk-Free Rate) / Volatility<br><br>
                    <strong>Simplified:</strong><br>
                    Sharpe = Reward / Risk
                </div>
                
                <h3>Sharpe Ratio Scale</h3>
                <ul>
                    <li><strong>&lt; 0:</strong> Losing money (bad)</li>
                    <li><strong>0 to 1:</strong> Suboptimal (could do better)</li>
                    <li><strong>1 to 2:</strong> Good risk-adjusted returns</li>
                    <li><strong>2 to 3:</strong> Excellent (top-tier funds)</li>
                    <li><strong>&gt; 3:</strong> Outstanding (rare, verify if sustainable)</li>
                </ul>
                
                <h3>What Is "Rolling" Sharpe?</h3>
                <p>Instead of calculating one Sharpe Ratio for the entire period, we calculate it over <strong>moving 12-month windows</strong>.</p>
                
                <h4>Why Rolling?</h4>
                <ul>
                    <li>Shows how risk-adjusted performance <strong>changes over time</strong></li>
                    <li>Reveals periods of strong vs. weak performance</li>
                    <li>Helps identify trends and regime changes</li>
                </ul>
                
                <h3>How to Read the Chart</h3>
                <ul>
                    <li><strong>X-axis:</strong> Month number</li>
                    <li><strong>Y-axis:</strong> Sharpe Ratio</li>
                    <li><strong>Line going up:</strong> Improving risk-adjusted returns</li>
                    <li><strong>Line going down:</strong> Deteriorating performance (more risk for same return)</li>
                </ul>
                
                <div class='example-box' style='background: linear-gradient(135deg, rgba(118, 75, 162, 0.12) 0%, rgba(102, 126, 234, 0.08) 100%); padding: 20px; border-radius: 16px; margin: 15px 0;'>
                    <strong>Interpretation Example:</strong><br>
                    If Rolling Sharpe drops from 1.8 to 0.5 around month 120, it means your strategy experienced a rough patch (market downturn) where risk was high but returns were low.
                </div>
                
                <h3>What to Look For</h3>
                <ul>
                    <li><strong>Stable line around 1-2:</strong> Consistently good risk management</li>
                    <li><strong>Volatile line:</strong> Performance varies significantly (market-dependent)</li>
                    <li><strong>Downward trend:</strong> May indicate strategy decay or regime change</li>
                    <li><strong>Recovery after dips:</strong> Resilient strategy</li>
                </ul>
                
                <h3>Professional Use</h3>
                <p>Hedge funds and institutional investors use rolling Sharpe Ratio to:</p>
                <ul>
                    <li>Monitor strategy performance in real-time</li>
                    <li>Identify when to rebalance portfolios</li>
                    <li>Compare different investment strategies</li>
                    <li>Communicate risk-adjusted returns to clients</li>
                </ul>
                
                <div class='tip-box' style='background: linear-gradient(135deg, #4A74F3 0%, #6C8BE0 100%); color: white; padding: 20px; border-radius: 14px; margin: 20px 0;'>
                    üí° <strong>Pro Tip:</strong> A strategy with a consistently high Rolling Sharpe (>1.5) across all market conditions is likely to be more robust than one with occasional spikes to 3+ but frequent drops below 0.5.
                </div>
                
                <h3>Limitations</h3>
                <ul>
                    <li>Assumes returns are normally distributed (not always true)</li>
                    <li>Doesn't capture tail risk (extreme events)</li>
                    <li>Sensitive to the chosen time window (12 months in our case)</li>
                    <li>Historical metric (past performance ‚â† future results)</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Modal: Scenario Comparison (NOUVEAU) -->
    <div id='modalCompareScenarios' class='modal modal-large'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìä Compare Scenarios</h2>
                <span class='close-modal' onclick='closeModal("modalCompareScenarios")'>&times;</span>
            </div>
            <div class='modal-body'>
                <div id='comparisonChartContainer' class='chart' style='min-height: 500px;'></div>
                
                <h3 style='margin-top: 30px;'>Comparative Statistics</h3>
                <div id='comparisonStatsContainer' class='stats-grid'></div>
                
                <div style='margin-top: 30px; text-align: center;'>
                    <button class='btn-export' onclick='MonteCarlo.exportComparisonPDF()'>
                        <i class="fas fa-file-pdf"></i> Export Comparison PDF
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src='assets/js/dark-mode.js'></script>
    <script src='assets/js/common.js'></script>
    <script src='assets/js/sidebar.js'></script>
    <script src='assets/js/monte-carlo.js'></script>

    <!-- Chatbot -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="assets/js/chatbot-config.js"></script>
    <script src="assets/js/chatbot-gemini.js"></script>
    <script src="assets/js/chatbot-analytics.js"></script>
    <script src="assets/js/chatbot-charts.js"></script>
    <script src="assets/js/chatbot-ipo-analyzer.js"></script>
    <script src="assets/js/chatbot-suggestions.js"></script>
    <script src="assets/js/chatbot-ai-engine.js"></script>
    <script src="assets/js/chatbot-ui.js"></script>
    <script src="assets/js/chatbot-particles.js"></script>

    <!-- ============================================
         ‚úÖ FIX MENU UTILISATEUR
         ============================================ -->
    <script>
        (function forceUserMenuInit() {
            console.log('üîß Force initializing user menu...');
            
            const initMenu = () => {
                const trigger = document.getElementById('sidebarUserTrigger');
                const dropdown = document.getElementById('sidebarUserDropdown');
                
                if (!trigger || !dropdown) {
                    console.error('‚ùå User menu elements not found');
                    return;
                }
                
                const newTrigger = trigger.cloneNode(true);
                trigger.parentNode.replaceChild(newTrigger, trigger);
                
                const freshTrigger = document.getElementById('sidebarUserTrigger');
                const freshDropdown = document.getElementById('sidebarUserDropdown');
                
                console.log('‚úÖ Adding click event to trigger...');
                
                freshTrigger.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    console.log('üëÜ User menu trigger clicked!');
                    
                    const isActive = freshDropdown.classList.contains('active');
                    
                    if (isActive) {
                        freshDropdown.classList.remove('active');
                        console.log('üîΩ Closing dropdown');
                    } else {
                        freshDropdown.classList.add('active');
                        console.log('üîº Opening dropdown');
                    }
                    
                    const arrow = freshTrigger.querySelector('.sidebar-user-arrow');
                    if (arrow) {
                        arrow.style.transform = isActive ? 'rotate(0deg)' : 'rotate(180deg)';
                        arrow.style.transition = 'transform 0.3s ease';
                    }
                });
                
                document.addEventListener('click', function(e) {
                    if (!freshTrigger.contains(e.target) && !freshDropdown.contains(e.target)) {
                        freshDropdown.classList.remove('active');
                        const arrow = freshTrigger.querySelector('.sidebar-user-arrow');
                        if (arrow) {
                            arrow.style.transform = 'rotate(0deg)';
                        }
                    }
                });
                
                freshDropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
                
                console.log('‚úÖ User menu initialized successfully!');
            };
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initMenu);
            } else {
                setTimeout(initMenu, 100);
            }
        })();
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const initChatbotWhenReady = () => {
            const accessDenied = sessionStorage.getItem('accessDenied') === 'true';
            if (accessDenied) return;
            if (typeof ChatbotConfig === 'undefined' || typeof ChatbotUI === 'undefined') return;
            try {
                window.financialChatbot = new ChatbotUI(ChatbotConfig);
            } catch (error) {
                console.error('Chatbot init error:', error);
            }
        };
        setTimeout(initChatbotWhenReady, 500);
    });
    </script>

</body>
</html>