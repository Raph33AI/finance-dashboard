<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>GÃ©nÃ©rateur de Liens Index Firestore</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="assets/js/firebase-config.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            margin: 0;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #1e293b;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .project-info {
            background: #f1f5f9;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 24px;
            font-weight: 700;
            color: #475569;
        }
        .index-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }
        .index-title {
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }
        .index-details {
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 12px;
            font-family: 'Courier New', monospace;
        }
        .btn {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
        }
        .success {
            color: #10b981;
            font-weight: 700;
        }
        .error {
            color: #ef4444;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”— GÃ©nÃ©rateur de Liens Index Firestore</h1>
        
        <div id="projectInfo" class="project-info">
            ðŸ“¦ DÃ©tection du projet Firebase en cours...
        </div>

        <div id="indexLinks"></div>
    </div>

    <script>
        // âœ… CORRECTION : Utiliser firebase.app() au lieu de const app
        const projectId = firebase.app().options.projectId;
        const databaseId = '(default)';

        console.log('ðŸ”¥ Firebase Project ID:', projectId);

        document.getElementById('projectInfo').innerHTML = `
            ðŸ“¦ <strong>Projet Firebase:</strong> ${projectId}<br>
            ðŸ—„ <strong>Database:</strong> ${databaseId}
        `;

        // âœ… DÃ‰FINITION DES INDEX NÃ‰CESSAIRES
        const indexes = [
            {
                name: '1. Leaderboard - Top Contributors',
                collection: 'users',
                fields: [
                    { field: 'points', mode: 'DESCENDING' }
                ]
            },
            {
                name: '2. Posts par Channel + Date',
                collection: 'posts',
                fields: [
                    { field: 'channelId', mode: 'ASCENDING' },
                    { field: 'createdAt', mode: 'DESCENDING' }
                ]
            },
            {
                name: '3. Posts par Channel + Vues',
                collection: 'posts',
                fields: [
                    { field: 'channelId', mode: 'ASCENDING' },
                    { field: 'views', mode: 'DESCENDING' }
                ]
            },
            {
                name: '4. Posts par Tag + Date (Array)',
                collection: 'posts',
                fields: [
                    { field: 'tags', mode: 'ARRAY_CONTAINS' },
                    { field: 'createdAt', mode: 'DESCENDING' }
                ]
            },
            {
                name: '5. Commentaires par Post + Date',
                collection: 'comments',
                fields: [
                    { field: 'postId', mode: 'ASCENDING' },
                    { field: 'createdAt', mode: 'DESCENDING' }
                ]
            }
        ];

        // âœ… GÃ‰NÃ‰RATION DES LIENS
        function generateIndexLink(index) {
            const baseUrl = `https://console.firebase.google.com/v1/r/project/${projectId}/firestore/indexes`;
            
            const fieldsParam = index.fields.map(f => {
                if (f.mode === 'ARRAY_CONTAINS') {
                    return `${f.field}:CONTAINS`;
                } else {
                    return `${f.field}:${f.mode === 'DESCENDING' ? 'DESC' : 'ASC'}`;
                }
            }).join(',');

            return `${baseUrl}?create_composite=${index.collection}:${fieldsParam}`;
        }

        // âœ… AFFICHAGE DES LIENS
        let html = '';
        indexes.forEach((index, i) => {
            const link = generateIndexLink(index);
            
            html += `
                <div class="index-card">
                    <div class="index-title">ðŸ“Š ${index.name}</div>
                    <div class="index-details">
                        Collection: <strong>${index.collection}</strong><br>
                        Fields: ${index.fields.map(f => `${f.field} (${f.mode})`).join(', ')}
                    </div>
                    <a href="${link}" target="_blank" class="btn">
                        ðŸ”— CrÃ©er cet index
                    </a>
                </div>
            `;
        });

        document.getElementById('indexLinks').innerHTML = html;
    </script>
</body>
</html>