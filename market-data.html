<!DOCTYPE html>
<html lang='fr'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Market Data - Raphael NARDONE</title>
    
    <!-- Highcharts - ORDRE IMPORTANT -->
    <script src='https://code.highcharts.com/stock/highstock.js'></script>
    <script src='https://code.highcharts.com/stock/indicators/indicators-all.js'></script>
    <script src='https://code.highcharts.com/stock/modules/drag-panes.js'></script>
    <script src='https://code.highcharts.com/modules/annotations-advanced.js'></script>
    <script src='https://code.highcharts.com/modules/price-indicator.js'></script>
    <script src='https://code.highcharts.com/modules/full-screen.js'></script>
    <script src='https://code.highcharts.com/modules/stock-tools.js'></script>
    <script src='https://code.highcharts.com/modules/exporting.js'></script>
    <script src='https://code.highcharts.com/modules/export-data.js'></script>
    
    <!-- Font Awesome -->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'>
    
    <!-- Styles -->
    <link rel='stylesheet' href='assets/css/common.css'>
    <link rel='stylesheet' href='assets/css/sidebar.css'>
    <link rel='stylesheet' href='assets/css/market-data.css'>
    <link rel='stylesheet' href='assets/css/cache-widget.css'>
</head>
<body>
    <div class='layout-wrapper'>
        
        <!-- ============================================
             SIDEBAR NAVIGATION
             ============================================ -->
        <aside class='sidebar' id='sidebar'>
            <div class='sidebar-header'>
                <h2><i class='fas fa-chart-line'></i> Finance Hub</h2>
                <button class='sidebar-toggle' id='sidebarToggle'>
                    <i class='fas fa-bars'></i>
                </button>
            </div>
            
            <nav class='sidebar-nav'>
                <!-- Budget Section -->
                <div class='nav-section'>
                    <button class='nav-folder'>
                        <i class='fas fa-wallet'></i>
                        <span>Budget</span>
                        <i class='fas fa-chevron-down arrow'></i>
                    </button>
                    <div class='nav-submenu'>
                        <a href='index.html' class='nav-link'>
                            <i class='fas fa-home'></i>
                            <span>Dashboard Budget</span>
                        </a>
                    </div>
                </div>
                
                <!-- Simulation Section -->
                <div class='nav-section'>
                    <button class='nav-folder'>
                        <i class='fas fa-calculator'></i>
                        <span>Simulation</span>
                        <i class='fas fa-chevron-down arrow'></i>
                    </button>
                    <div class='nav-submenu'>
                        <a href='monte-carlo.html' class='nav-link'>
                            <i class='fas fa-dice'></i>
                            <span>Monte Carlo</span>
                        </a>
                        <a href='portfolio-optimizer.html' class='nav-link'>
                            <i class='fas fa-chart-pie'></i>
                            <span>Markowitz</span>
                        </a>
                        <a href='risk-parity.html' class='nav-link'>
                            <i class='fas fa-balance-scale'></i>
                            <span>Risk Parity</span>
                        </a>
                        <a href='scenario-analysis.html' class='nav-link'>
                            <i class='fas fa-flask'></i>
                            <span>Sc√©narios</span>
                        </a>
                    </div>
                </div>
                
                <!-- Stocks Section -->
                <div class='nav-section active'>
                    <button class='nav-folder active'>
                        <i class='fas fa-chart-line'></i>
                        <span>Stocks</span>
                        <i class='fas fa-chevron-down arrow'></i>
                    </button>
                    <div class='nav-submenu' style='display: block;'>
                        <a href='market-data.html' class='nav-link active'>
                            <i class='fas fa-globe'></i>
                            <span>Market Data</span>
                        </a>
                        <a href='advanced-analysis.html' class='nav-link'>
                            <i class='fas fa-chart-area'></i>
                            <span>Advanced Analysis</span>
                        </a>
                        <a href='trend-prediction.html' class='nav-link'>
                            <i class='fas fa-globe'></i>
                            <span>ML Predictions</span>
                        </a>
                    </div>
                </div>
            </nav>
            
            <div class='sidebar-footer'>
                <div class='user-info'>
                    <i class='fas fa-user-circle'></i>
                    <span>Raphael NARDONE</span>
                </div>
            </div>
        </aside>
        
        <!-- ============================================
             MAIN CONTENT AREA
             ============================================ -->
        <div class='main-content'>
            <!-- Top Header -->
            <header class='top-header'>
                <div class="header-content-wrapper">
                    <div class='header-left'>
                        <button class='mobile-toggle' id='mobileToggle'>
                            <i class='fas fa-bars'></i>
                        </button>
                        <h1>Market Data</h1>
                    </div>
                    <div class='header-right'>
                        <span class='last-update'>
                            <i class='fas fa-clock'></i>
                            <span id='lastUpdate'></span>
                        </span>
                    </div>
                </div>
            </header>
            
            <!-- Container -->
            <div class='container'>
                <!-- Main Content -->
                <div class='content'>
                    
                    <!-- Search Panel -->
                    <div class='search-panel card'>
                        <div class='card-header'>
                            <h2 class='card-title'>
                                <i class='fas fa-search'></i> Search Stock for Market Data
                            </h2>
                            <span class='help-icon' onclick='openModal("modalSearchHelp")'>?</span>
                        </div>
                        
                        <div class='card-body'>
                            <div class='search-container'>
                                <!-- Search Input + Button -->
                                <div class='search-input-wrapper'>
                                    <input type='text' 
                                        id='symbolInput' 
                                        class='form-input'
                                        placeholder='Search by symbol or company name (e.g., AAPL, Apple, Tesla)...'
                                        autocomplete='off'
                                        value='AAPL'>
                                    <button class='btn btn-primary btn-search' onclick='MarketData.searchStock()'>
                                        <i class='fas fa-chart-area'></i> Analyze Stock
                                    </button>
                                    
                                    <!-- Suggestions dropdown (hidden by default) -->
                                    <div class='search-suggestions' id='searchSuggestions'></div>
                                </div>
                                
                                <!-- Popular Stocks -->
                                <div class='popular-stocks'>
                                    <span class='quick-label'>Popular Stocks:</span>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("AAPL")'>
                                        <i class='fab fa-apple'></i> AAPL
                                    </button>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("MSFT")'>
                                        <i class='fab fa-microsoft'></i> MSFT
                                    </button>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("GOOGL")'>
                                        <i class='fab fa-google'></i> GOOGL
                                    </button>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("TSLA")'>
                                        <i class='fas fa-car'></i> TSLA
                                    </button>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("BTC-USD")'>
                                        <i class='fab fa-bitcoin'></i> BTC-USD
                                    </button>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("^GSPC")'>
                                        <i class='fas fa-chart-line'></i> S&P 500
                                    </button>
                                </div>
                                
                                <!-- Period Selection -->
                                <div class='time-period-selector'>
                                    <label>Time Period:</label>
                                    <button class='period-btn active' data-period='1M' onclick='MarketData.changePeriod("1M")'>1M</button>
                                    <button class='period-btn' data-period='3M' onclick='MarketData.changePeriod("3M")'>3M</button>
                                    <button class='period-btn' data-period='6M' onclick='MarketData.changePeriod("6M")'>6M</button>
                                    <button class='period-btn' data-period='1Y' onclick='MarketData.changePeriod("1Y")'>1Y</button>
                                    <button class='period-btn' data-period='5Y' onclick='MarketData.changePeriod("5Y")'>5Y</button>
                                    <button class='period-btn' data-period='MAX' onclick='MarketData.changePeriod("MAX")'>MAX</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ============================================
                         STOCK COMPARISON SECTION
                         ============================================ -->
                    <div class='comparison-section card'>
                        <div class='card-header comparison-header'>
                            <h2 class='card-title'>
                                <i class='fas fa-chart-bar'></i> Stock Comparison
                            </h2>
                            <div class='comparison-actions'>
                                <button class='btn btn-primary btn-compare' onclick='MarketData.openComparisonModal()'>
                                    <i class='fas fa-plus'></i> Add Stocks to Compare
                                </button>
                                <button class='btn btn-danger btn-clear-comparison' onclick='MarketData.clearComparison()'>
                                    <i class='fas fa-trash'></i> Clear All
                                </button>
                            </div>
                        </div>
                        
                        <div class='card-body'>
                            <div id='comparisonContainer' class='comparison-container hidden'>
                                <!-- Selected stocks chips -->
                                <div class='comparison-stocks' id='comparisonStocks'></div>
                                
                                <!-- Comparison Chart -->
                                <div class='comparison-chart-wrapper'>
                                    <h3 class='subsection-title'>Performance Comparison (Normalized to 100)</h3>
                                    <div id='comparisonChart' class='chart'></div>
                                </div>
                                
                                <!-- Comparison Table -->
                                <div class='comparison-table-wrapper'>
                                    <h3 class='subsection-title'>Key Metrics Comparison</h3>
                                    <div id='comparisonTable' class='comparison-table'></div>
                                </div>
                            </div>
                            
                            <div id='comparisonEmpty' class='comparison-empty'>
                                <i class='fas fa-chart-line'></i>
                                <p>No stocks to compare</p>
                                <p class='hint'>Click "Add Stocks to Compare" to get started</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ============================================
                         WATCHLIST SECTION
                         ============================================ -->
                    <div class='watchlist-section card'>
                        <div class='card-header watchlist-header'>
                            <h2 class='card-title'>
                                <i class='fas fa-star'></i> My Watchlist
                            </h2>
                            <div class='watchlist-actions'>
                                <button class='btn btn-success btn-add-current' onclick='MarketData.addCurrentToWatchlist()' id='btnAddCurrent' disabled>
                                    <i class='fas fa-plus'></i> Add Current Stock
                                </button>
                                <button class='btn btn-primary btn-refresh-watchlist' onclick='MarketData.refreshWatchlist()'>
                                    <i class='fas fa-sync-alt'></i> Refresh All
                                </button>
                                <button class='btn btn-danger btn-clear-watchlist' onclick='MarketData.clearWatchlist()'>
                                    <i class='fas fa-trash'></i> Clear All
                                </button>
                            </div>
                        </div>
                        
                        <div class='card-body'>
                            <div id='watchlistContainer' class='watchlist-container'>
                                <div class='watchlist-empty'>
                                    <i class='fas fa-star-half-alt'></i>
                                    <p>Your watchlist is empty</p>
                                    <p class='hint'>Search for a stock and click "Add to Watchlist" to start tracking</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ============================================
                         PRICE ALERTS SECTION
                         ============================================ -->
                    <div class='alerts-section card'>
                        <div class='card-header alerts-header'>
                            <h2 class='card-title'>
                                <i class='fas fa-bell'></i> Price Alerts
                            </h2>
                            <button class='btn btn-accent btn-create-alert' onclick='MarketData.openAlertModal()'>
                                <i class='fas fa-plus'></i> Create Alert
                            </button>
                        </div>
                        
                        <div class='card-body'>
                            <div id='alertsContainer' class='alerts-container'>
                                <div class='alerts-empty'>
                                    <i class='fas fa-bell-slash'></i>
                                    <p>No active alerts</p>
                                    <p class='hint'>Create price alerts to get notified when a stock reaches your target</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Loading Indicator -->
                    <div id='loadingIndicator' class='loading-indicator hidden'>
                        <i class='fas fa-spinner fa-spin'></i> Loading market data...
                    </div>
                    
                    <!-- Stock Overview -->
                    <div id='stockOverview' class='stock-overview hidden'>
                        <div class='overview-header'>
                            <div class='stock-title'>
                                <h2 id='stockName'>-</h2>
                                <span id='stockSymbol' class='stock-symbol'>-</span>
                            </div>
                            <div class='stock-price-section'>
                                <div id='currentPrice' class='current-price'>-</div>
                                <div id='priceChange' class='price-change'>-</div>
                            </div>
                        </div>
                        
                        <div class='overview-stats'>
                            <div class='stat-item'>
                                <span class='stat-label'>Open</span>
                                <span id='statOpen' class='stat-value'>-</span>
                            </div>
                            <div class='stat-item'>
                                <span class='stat-label'>High</span>
                                <span id='statHigh' class='stat-value'>-</span>
                            </div>
                            <div class='stat-item'>
                                <span class='stat-label'>Low</span>
                                <span id='statLow' class='stat-value'>-</span>
                            </div>
                            <div class='stat-item'>
                                <span class='stat-label'>Volume</span>
                                <span id='statVolume' class='stat-value'>-</span>
                            </div>
                            <div class='stat-item'>
                                <span class='stat-label'>Mkt Cap</span>
                                <span id='statMarketCap' class='stat-value'>-</span>
                            </div>
                            <div class='stat-item'>
                                <span class='stat-label'>P/E Ratio</span>
                                <span id='statPE' class='stat-value'>-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Results Panel -->
                    <div id='resultsPanel' class='results-panel card hidden'>
                        <div class='card-body'>
                            
                            <!-- Price Chart -->
                            <div class='chart-section'>
                                <h3 class='subsection-title'>
                                    <i class='fas fa-chart-line'></i> Price Chart with Technical Indicators
                                    <span class='help-icon' onclick='openModal("modalChartHelp")'>?</span>
                                </h3>
                                <div class='indicator-toggles'>
                                    <label><input type='checkbox' id='toggleSMA' checked> SMA (20, 50)</label>
                                    <label><input type='checkbox' id='toggleEMA'> EMA (12, 26)</label>
                                    <label><input type='checkbox' id='toggleBB' checked> Bollinger Bands</label>
                                    <label><input type='checkbox' id='toggleVolume' checked> Volume</label>
                                </div>
                                <div id='priceChart' class='chart'></div>
                            </div>
                            
                            <!-- Technical Indicators -->
                            <div class='charts-grid-2'>
                                <div class='chart-section'>
                                    <h3 class='subsection-title'>
                                        <i class='fas fa-wave-square'></i> RSI (Relative Strength Index)
                                        <span class='help-icon' onclick='openModal("modalRSI")'>?</span>
                                    </h3>
                                    <div id='rsiChart' class='chart chart-medium'></div>
                                </div>
                                
                                <div class='chart-section'>
                                    <h3 class='subsection-title'>
                                        <i class='fas fa-chart-bar'></i> MACD (Moving Average Convergence Divergence)
                                        <span class='help-icon' onclick='openModal("modalMACD")'>?</span>
                                    </h3>
                                    <div id='macdChart' class='chart chart-medium'></div>
                                </div>
                            </div>
                            
                            <!-- Trading Signals -->
                            <div class='signals-section'>
                                <h3 class='subsection-title'>
                                    <i class='fas fa-signal'></i> Trading Signals
                                    <span class='help-icon' onclick='openModal("modalSignals")'>?</span>
                                </h3>
                                <div id='tradingSignals' class='signals-grid'></div>
                            </div>
                            
                            <!-- Key Statistics -->
                            <div class='stats-section'>
                                <h3 class='subsection-title'><i class='fas fa-table'></i> Key Statistics</h3>
                                <div id='keyStats' class='stats-grid'></div>
                            </div>
                            
                        </div>
                    </div>
                </div>
                
                <!-- Footer -->
                <footer>
                    <p>Market Data | Real-time financial data and technical analysis</p>
                    <p class='data-source'>Data provided by Twelve Data</p>
                </footer>
            </div>
        </div>
        
    </div>
    
    <!-- ============================================
         MODALS
         ============================================ -->
    <div id='modalSearchHelp' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üîç How to Search Stocks</h2>
                <span class='close-modal' onclick='closeModal("modalSearchHelp")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üìä Symbol Format</h3>
                <p>Enter the <strong>stock ticker symbol</strong> to retrieve market data:</p>
                <ul>
                    <li><strong>US Stocks:</strong> AAPL, MSFT, GOOGL, TSLA</li>
                    <li><strong>Indices:</strong> ^GSPC (S&P 500), ^DJI (Dow Jones), ^IXIC (NASDAQ)</li>
                    <li><strong>Crypto:</strong> BTC-USD, ETH-USD</li>
                    <li><strong>European Stocks:</strong> AIR.PA (Airbus), MC.PA (LVMH)</li>
                </ul>
                
                <h3>üìà Available Data</h3>
                <ul>
                    <li>Real-time price and change</li>
                    <li>Historical price charts</li>
                    <li>Technical indicators (RSI, MACD, Bollinger Bands)</li>
                    <li>Trading volume</li>
                    <li>Key statistics (P/E ratio, market cap, etc.)</li>
                </ul>
                
                <div class='info-box'>
                    üí° <strong>Pro Tip:</strong> Use the time period buttons to analyze different timeframes and spot trends!
                </div>
            </div>
        </div>
    </div>
    
    <div id='modalComparison' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìä Stock Comparison Tool</h2>
                <span class='close-modal' onclick='closeModal("modalComparison")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üéØ What is Stock Comparison?</h3>
                <p>Stock Comparison allows you to visualize and analyze multiple stocks side-by-side to identify the best performers.</p>
                
                <h3>‚ú® Features</h3>
                <ul>
                    <li><strong>Normalized Performance:</strong> All stocks start at 100 for easy comparison</li>
                    <li><strong>Visual Charts:</strong> See relative performance over time</li>
                    <li><strong>Metrics Table:</strong> Compare key statistics (returns, volatility, etc.)</li>
                    <li><strong>Up to 5 Stocks:</strong> Compare multiple stocks simultaneously</li>
                </ul>
                
                <h3>üìà How to Use</h3>
                <ol>
                    <li>Click "Add Stocks to Compare"</li>
                    <li>Enter stock symbols (e.g., AAPL, MSFT, GOOGL)</li>
                    <li>View the normalized performance chart</li>
                    <li>Analyze the comparison table</li>
                    <li>Identify winners and losers!</li>
                </ol>
                
                <div class='info-box success'>
                    üí° <strong>Pro Tip:</strong> Compare stocks in the same sector for better insights (e.g., AAPL vs MSFT vs GOOGL).
                </div>
            </div>
        </div>
    </div>
    
    <div id='modalAddComparison' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìä Add Stocks to Compare</h2>
                <span class='close-modal' onclick='MarketData.closeComparisonModal()'>&times;</span>
            </div>
            <div class='modal-body'>
                <div class='comparison-form'>
                    <div class='form-group'>
                        <label class='form-label' for='comparisonSymbols'>Stock Symbols (separated by commas)</label>
                        <input type='text' 
                               id='comparisonSymbols' 
                               class='form-input'
                               placeholder='e.g., AAPL, MSFT, GOOGL, TSLA'
                               style='text-transform: uppercase;'>
                        <p class='text-muted' style='font-size: 0.875rem; margin-top: 0.5rem;'>Enter 2-5 stock symbols to compare</p>
                    </div>
                    
                    <div class='comparison-quick-presets'>
                        <label class='form-label'>Quick Presets:</label>
                        <button class='preset-btn' onclick='document.getElementById("comparisonSymbols").value = "AAPL, MSFT, GOOGL, AMZN"'>
                            <i class='fas fa-laptop'></i> Big Tech
                        </button>
                        <button class='preset-btn' onclick='document.getElementById("comparisonSymbols").value = "TSLA, F, GM, TM"'>
                            <i class='fas fa-car'></i> Auto Industry
                        </button>
                        <button class='preset-btn' onclick='document.getElementById("comparisonSymbols").value = "JPM, BAC, WFC, C"'>
                            <i class='fas fa-university'></i> Banks
                        </button>
                        <button class='preset-btn' onclick='document.getElementById("comparisonSymbols").value = "^GSPC, ^DJI, ^IXIC"'>
                            <i class='fas fa-chart-line'></i> Market Indices
                        </button>
                    </div>
                </div>
            </div>
            <div class='modal-footer'>
                <button class='btn btn-success' onclick='MarketData.loadComparison()'>
                    <i class='fas fa-chart-line'></i> Compare Stocks
                </button>
                <button class='btn btn-secondary' onclick='MarketData.closeComparisonModal()'>
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <div id='modalWatchlist' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>‚≠ê Watchlist Feature</h2>
                <span class='close-modal' onclick='closeModal("modalWatchlist")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üìä What is a Watchlist?</h3>
                <p>A watchlist lets you track multiple stocks simultaneously without having to search for them repeatedly.</p>
                
                <h3>‚ú® Features</h3>
                <ul>
                    <li><strong>Real-time Updates:</strong> Prices refresh automatically every 60 seconds</li>
                    <li><strong>Persistent Storage:</strong> Your watchlist is saved in your browser</li>
                    <li><strong>Quick Access:</strong> Click any stock to view detailed charts</li>
                    <li><strong>Performance Tracking:</strong> See daily changes at a glance</li>
                </ul>
                
                <h3>üéØ How to Use</h3>
                <ol>
                    <li>Search for a stock using the search bar</li>
                    <li>Click "Add to Watchlist" button</li>
                    <li>Your stock appears in the watchlist with live data</li>
                    <li>Click "Refresh All" to update all prices manually</li>
                </ol>
                
                <div class='info-box success'>
                    üí° <strong>Pro Tip:</strong> Combine watchlist with price alerts to never miss important price movements!
                </div>
            </div>
        </div>
    </div>
    
    <div id='modalAlerts' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üîî Price Alerts</h2>
                <span class='close-modal' onclick='closeModal("modalAlerts")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üì¢ What are Price Alerts?</h3>
                <p>Price alerts notify you when a stock reaches your specified target price.</p>
                
                <h3>üìä Alert Types</h3>
                <ul>
                    <li><strong>Above:</strong> Triggers when price goes above your target</li>
                    <li><strong>Below:</strong> Triggers when price goes below your target</li>
                </ul>
                
                <h3>üéØ How to Create an Alert</h3>
                <ol>
                    <li>Click "Create Alert" button</li>
                    <li>Enter the stock symbol</li>
                    <li>Set your target price</li>
                    <li>Choose alert type (above/below)</li>
                    <li>Click "Create" - you'll be notified when triggered!</li>
                </ol>
                
                <div class='info-box warning'>
                    üí° <strong>Note:</strong> Alerts are checked during watchlist refresh. Enable browser notifications for best results!
                </div>
            </div>
        </div>
    </div>
    
    <div id='modalCreateAlert' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üîî Create Price Alert</h2>
                <span class='close-modal' onclick='MarketData.closeAlertModal()'>&times;</span>
            </div>
            <div class='modal-body'>
                <div class='alert-form'>
                    <div class='form-group'>
                        <label class='form-label' for='alertSymbol'>Stock Symbol</label>
                        <input type='text' id='alertSymbol' class='form-input' placeholder='e.g., AAPL' style='text-transform: uppercase;'>
                    </div>
                    
                    <div class='form-group'>
                        <label class='form-label' for='alertPrice'>Target Price</label>
                        <input type='number' id='alertPrice' class='form-input' placeholder='e.g., 150.00' step='0.01'>
                    </div>
                    
                    <div class='form-group'>
                        <label class='form-label' for='alertType'>Alert Condition</label>
                        <select id='alertType' class='form-select'>
                            <option value='above'>Price goes ABOVE target</option>
                            <option value='below'>Price goes BELOW target</option>
                        </select>
                    </div>
                    
                    <div class='form-group'>
                        <label class='form-label' for='alertNote'>Note (Optional)</label>
                        <input type='text' id='alertNote' class='form-input' placeholder='e.g., Buy signal, Take profit...'>
                    </div>
                </div>
            </div>
            <div class='modal-footer'>
                <button class='btn btn-success' onclick='MarketData.createAlert()'>
                    <i class='fas fa-check'></i> Create Alert
                </button>
                <button class='btn btn-secondary' onclick='MarketData.closeAlertModal()'>
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <div id='modalChartHelp' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìà Understanding Price Charts</h2>
                <span class='close-modal' onclick='closeModal("modalChartHelp")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üìä Technical Indicators</h3>
                
                <h4>1Ô∏è‚É£ SMA (Simple Moving Average)</h4>
                <p>Average price over a period (e.g., 20 or 50 days). Helps identify trends.</p>
                <ul>
                    <li><strong>Price above SMA:</strong> Bullish signal üìà</li>
                    <li><strong>Price below SMA:</strong> Bearish signal üìâ</li>
                </ul>
                
                <h4>2Ô∏è‚É£ EMA (Exponential Moving Average)</h4>
                <p>Like SMA but gives more weight to recent prices. More responsive to changes.</p>
                
                <h4>3Ô∏è‚É£ Bollinger Bands</h4>
                <p>Shows price volatility. Price touching upper band = <strong>overbought</strong>, lower band = <strong>oversold</strong>.</p>
                
                <div class='info-box'>
                    üí° Combine multiple indicators for better signals!
                </div>
            </div>
        </div>
    </div>
    
    <div id='modalRSI' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìä RSI - Relative Strength Index</h2>
                <span class='close-modal' onclick='closeModal("modalRSI")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üìê What is RSI?</h3>
                <p>The RSI measures the speed and magnitude of price changes. It oscillates between <strong>0 and 100</strong>.</p>
                
                <h3>üìà Interpretation</h3>
                <ul>
                    <li><strong>RSI > 70:</strong> Overbought ‚Üí Possible reversal down ‚ö†Ô∏è</li>
                    <li><strong>RSI < 30:</strong> Oversold ‚Üí Possible reversal up üöÄ</li>
                    <li><strong>RSI = 50:</strong> Neutral</li>
                </ul>
                
                <div class='info-box'>
                    <h4>Formula:</h4>
                    <p>RSI = 100 - [100 / (1 + RS)]</p>
                    <p>RS = Average Gain / Average Loss (over 14 periods)</p>
                </div>
                
                <div class='info-box success'>
                    üí° <strong>Trading Strategy:</strong> Buy when RSI crosses above 30, sell when it crosses below 70.
                </div>
            </div>
        </div>
    </div>
    
    <div id='modalMACD' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üìä MACD - Moving Average Convergence Divergence</h2>
                <span class='close-modal' onclick='closeModal("modalMACD")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üìê What is MACD?</h3>
                <p>The MACD shows the relationship between two moving averages. It consists of:</p>
                <ul>
                    <li><strong>MACD Line:</strong> EMA(12) - EMA(26)</li>
                    <li><strong>Signal Line:</strong> EMA(9) of MACD</li>
                    <li><strong>Histogram:</strong> MACD - Signal</li>
                </ul>
                
                <h3>üìà Trading Signals</h3>
                <ul>
                    <li><strong>MACD crosses above Signal:</strong> Buy signal üü¢</li>
                    <li><strong>MACD crosses below Signal:</strong> Sell signal üî¥</li>
                    <li><strong>Histogram increasing:</strong> Momentum strengthening</li>
                </ul>
                
                <div class='info-box success'>
                    üí° <strong>Pro Tip:</strong> MACD works best in trending markets, not in sideways/ranging markets.
                </div>
            </div>
        </div>
    </div>
    
    <div id='modalSignals' class='modal'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2>üéØ Trading Signals Explained</h2>
                <span class='close-modal' onclick='closeModal("modalSignals")'>&times;</span>
            </div>
            <div class='modal-body'>
                <h3>üö¶ Signal Types</h3>
                
                <h4>üü¢ Bullish Signals (Buy)</h4>
                <ul>
                    <li>RSI oversold (<30) and reversing up</li>
                    <li>MACD crossing above signal line</li>
                    <li>Price bouncing off lower Bollinger Band</li>
                    <li>Golden Cross: Short MA crosses above Long MA</li>
                </ul>
                
                <h4>üî¥ Bearish Signals (Sell)</h4>
                <ul>
                    <li>RSI overbought (>70) and reversing down</li>
                    <li>MACD crossing below signal line</li>
                    <li>Price rejected at upper Bollinger Band</li>
                    <li>Death Cross: Short MA crosses below Long MA</li>
                </ul>
                
                <div class='info-box warning'>
                    ‚ö†Ô∏è <strong>Warning:</strong> No signal is 100% accurate. Always combine multiple indicators and use risk management!
                </div>
            </div>
        </div>
    </div>
    
    <!-- ============================================
         CACHE MONITORING WIDGET
         ============================================ -->
    <div id='cacheWidget' class='cache-widget'>
        <button class='cache-toggle-btn' onclick='toggleCachePanel()' title='Cache Statistics'>
            <i class='fas fa-database'></i>
            <span class='cache-badge' id='cacheBadge'>0</span>
        </button>
    </div>
    
    <div id='cachePanel' class='cache-panel hidden'>
        <div class='cache-panel-header'>
            <h3><i class='fas fa-database'></i> Cache & API Monitoring</h3>
            <button class='close-cache-panel' onclick='toggleCachePanel()'>
                <i class='fas fa-times'></i>
            </button>
        </div>
        
        <div class='cache-panel-body'>
            <!-- API Quota -->
            <div class='cache-section'>
                <h4><i class='fas fa-cloud'></i> API Quota Today</h4>
                <div class='quota-display'>
                    <div class='quota-bar-container'>
                        <div class='quota-bar' id='quotaBar' style='width: 0%'></div>
                    </div>
                    <div class='quota-stats'>
                        <span id='quotaUsed'>0</span> / <span id='quotaTotal'>800</span> requests
                        <span class='quota-remaining' id='quotaRemaining'>(800 left)</span>
                    </div>
                </div>
            </div>
            
            <!-- Cache Stats -->
            <div class='cache-section'>
                <h4><i class='fas fa-save'></i> Local Cache</h4>
                <div class='cache-stats-grid'>
                    <div class='cache-stat-item'>
                        <div class='cache-stat-label'>Entries</div>
                        <div class='cache-stat-value' id='cacheEntries'>0</div>
                    </div>
                    <div class='cache-stat-item'>
                        <div class='cache-stat-label'>Hit Rate</div>
                        <div class='cache-stat-value' id='cacheHitRate'>0%</div>
                    </div>
                    <div class='cache-stat-item'>
                        <div class='cache-stat-label'>Saved Requests</div>
                        <div class='cache-stat-value' id='cacheSavedRequests'>0</div>
                    </div>
                </div>
            </div>
            
            <!-- Actions -->
            <div class='cache-section'>
                <h4><i class='fas fa-cog'></i> Actions</h4>
                <div class='cache-actions'>
                    <button class='cache-action-btn refresh' onclick='refreshCacheStats()'>
                        <i class='fas fa-sync-alt'></i> Refresh Stats
                    </button>
                    <button class='cache-action-btn clear' onclick='clearAllCache()'>
                        <i class='fas fa-trash'></i> Clear Cache
                    </button>
                    <button class='cache-action-btn reset' onclick='resetQuotaCounter()'>
                        <i class='fas fa-redo'></i> Reset Counter
                    </button>
                </div>
            </div>
            
            <!-- Cache Details -->
            <div class='cache-section'>
                <h4><i class='fas fa-list'></i> Cache Details</h4>
                <div class='cache-details' id='cacheDetails'>
                    <div class='cache-empty'>No cache entries</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Cache Stats Auto-Update -->
    <script>
    // ============================================
    // CACHE MONITORING FUNCTIONS
    // ============================================
    
    let cacheStatsInterval = null;
    
    function toggleCachePanel() {
        const panel = document.getElementById('cachePanel');
        const isHidden = panel.classList.contains('hidden');
        
        if (isHidden) {
            panel.classList.remove('hidden');
            refreshCacheStats();
            cacheStatsInterval = setInterval(refreshCacheStats, 5000);
        } else {
            panel.classList.add('hidden');
            clearInterval(cacheStatsInterval);
        }
    }
    
    function refreshCacheStats() {
        if (!window.apiClient) return;
        
        const stats = window.apiClient.getCacheStats();
        
        const quotaUsed = stats.requestsToday;
        const quotaTotal = 800;
        const quotaPercent = (quotaUsed / quotaTotal) * 100;
        const quotaRemaining = quotaTotal - quotaUsed;
        
        document.getElementById('quotaUsed').textContent = quotaUsed;
        document.getElementById('quotaTotal').textContent = quotaTotal;
        document.getElementById('quotaRemaining').textContent = `(${quotaRemaining} left)`;
        document.getElementById('quotaBar').style.width = quotaPercent + '%';
        
        const quotaBar = document.getElementById('quotaBar');
        if (quotaPercent < 50) {
            quotaBar.style.background = '#10b981';
        } else if (quotaPercent < 80) {
            quotaBar.style.background = '#f59e0b';
        } else {
            quotaBar.style.background = '#ef4444';
        }
        
        document.getElementById('cacheEntries').textContent = stats.entries;
        document.getElementById('cacheBadge').textContent = stats.entries;
        
        const hitRate = stats.entries > 0 ? Math.min(100, Math.round((stats.entries / quotaUsed) * 100)) : 0;
        document.getElementById('cacheHitRate').textContent = hitRate + '%';
        
        const savedRequests = Math.max(0, stats.entries - quotaUsed);
        document.getElementById('cacheSavedRequests').textContent = savedRequests;
        
        updateCacheDetails();
    }
    
    function updateCacheDetails() {
        const keys = Object.keys(localStorage);
        const cacheKeys = keys.filter(k => k.startsWith('api_cache:'));
        
        const detailsContainer = document.getElementById('cacheDetails');
        
        if (cacheKeys.length === 0) {
            detailsContainer.innerHTML = '<div class="cache-empty">No cache entries</div>';
            return;
        }
        
        const entries = cacheKeys.map(key => {
            try {
                const { timestamp } = JSON.parse(localStorage.getItem(key));
                const age = Math.round((Date.now() - timestamp) / 1000);
                const endpoint = key.replace('api_cache:', '').split(':')[0];
                return { key, endpoint, age };
            } catch {
                return null;
            }
        }).filter(e => e !== null)
          .sort((a, b) => a.age - b.age);
        
        let html = '<div class="cache-entries-list">';
        entries.slice(0, 10).forEach(entry => {
            const ageStr = entry.age < 60 ? `${entry.age}s` : `${Math.round(entry.age/60)}m`;
            html += `
                <div class="cache-entry-item">
                    <span class="cache-entry-endpoint">${entry.endpoint}</span>
                    <span class="cache-entry-age">${ageStr} ago</span>
                </div>
            `;
        });
        html += '</div>';
        
        if (entries.length > 10) {
            html += `<div class="cache-entry-more">+${entries.length - 10} more entries</div>`;
        }
        
        detailsContainer.innerHTML = html;
    }
    
    function clearAllCache() {
        if (confirm('‚ö†Ô∏è Clear all cached data?\nThis will force fresh API requests.')) {
            if (window.apiClient) {
                window.apiClient.clearCache();
                refreshCacheStats();
                alert('‚úÖ Cache cleared successfully!');
            }
        }
    }
    
    function resetQuotaCounter() {
        if (confirm('‚ö†Ô∏è Reset API quota counter?\nThis should only be done at the start of a new day.')) {
            localStorage.setItem('api_request_count', '0');
            localStorage.setItem('api_counter_reset_date', new Date().toDateString());
            if (window.apiClient) {
                window.apiClient.requestCount = 0;
            }
            refreshCacheStats();
            alert('‚úÖ Quota counter reset!');
        }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            if (window.apiClient) {
                const stats = window.apiClient.getCacheStats();
                document.getElementById('cacheBadge').textContent = stats.entries;
            }
        }, 1000);
    });
    </script>

    <!-- Scripts - ORDRE IMPORTANT -->
    <script src='assets/js/config.js'></script>
    <script src='assets/js/api-client.js'></script>
    <script src='assets/js/common.js'></script>
    <script src='assets/js/sidebar.js'></script>
    <script src='assets/js/market-data.js'></script>
</body>
</html>