<!DOCTYPE html>
<html lang='fr'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Advanced Analysis - Legal Compliant</title>
    
    <!-- Highcharts -->
    <script src='https://code.highcharts.com/stock/highstock.js'></script>
    <script src='https://code.highcharts.com/highcharts-more.js'></script>
    <script src='https://code.highcharts.com/modules/exporting.js'></script>
    
    <!-- Font Awesome -->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'>
    
    <!-- Styles -->
    <link rel='stylesheet' href='assets/css/common.css'>
    <link rel='stylesheet' href='assets/css/sidebar.css'>
    <link rel="stylesheet" href="assets/css/user-menu.css">
    <link rel="stylesheet" href="assets/css/chatbot-styles.css">
    <link rel='stylesheet' href='assets/css/advanced-analysis.css'>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Configuration Firebase -->
    <script src="assets/js/firebase-config.js"></script>
    
    <!-- Protection de la page (AUTH GUARD) -->
    <script src="assets/js/auth-guard.js"></script>

    <!-- ACCESS CONTROL -->
    <script src="assets/js/access-control.js"></script>
    
    <!-- STYLES SIMPLIFIÉS POUR MODALS (ULTRA LÉGERS) -->
    <style>
        /* ============================================
        MODAL STYLES - MINIMALISTES
        ============================================ */
        
        /* Modal Overlay */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Modal Content */
        .modal-content {
            background: #ffffff;
            border-radius: 8px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            position: relative;
        }

        body.dark-mode .modal-content {
            background: #1e293b;
            color: #e2e8f0;
        }

        /* Modal Header */
        .modal-header {
            background: #f8fafc;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e2e8f0;
            border-radius: 8px 8px 0 0;
            position: relative;
        }

        body.dark-mode .modal-header {
            background: #0f172a;
            border-bottom-color: #334155;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        body.dark-mode .modal-header h2 {
            color: #f1f5f9;
        }

        /* Close Button */
        .close-modal {
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            color: #64748b;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            background: transparent;
            transition: background 0.2s;
            line-height: 1;
        }

        .close-modal:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        body.dark-mode .close-modal:hover {
            background: #334155;
            color: #f1f5f9;
        }

        /* Modal Body */
        .modal-body {
            padding: 2rem;
        }

        .modal-body h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
            margin: 1.5rem 0 1rem 0;
        }

        body.dark-mode .modal-body h3 {
            color: #f1f5f9;
        }

        .modal-body h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #334155;
            margin: 1.25rem 0 0.75rem 0;
        }

        body.dark-mode .modal-body h4 {
            color: #cbd5e1;
        }

        .modal-body ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .modal-body li {
            margin-bottom: 0.5rem;
            line-height: 1.6;
            color: #475569;
        }

        body.dark-mode .modal-body li {
            color: #94a3b8;
        }

        .modal-body p {
            line-height: 1.6;
            color: #475569;
            margin-bottom: 1rem;
        }

        body.dark-mode .modal-body p {
            color: #94a3b8;
        }

        /* Small Modal Variant */
        .modal-small .modal-content {
            max-width: 500px;
        }

        /* Scrollbar Styling */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* ============================================
        HELP ICON BUTTON
        ============================================ */
        
        .help-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3b82f6;
            color: white !important;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 0.5rem;
            border: none;
        }

        .help-icon::before {
            content: '?';
        }

        .help-icon:hover {
            background: #2563eb;
            transform: scale(1.1);
        }

        /* ============================================
        FORMULA & INFO BOXES
        ============================================ */
        
        .formula-box {
            background: #f8fafc;
            border-left: 3px solid #3b82f6;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        body.dark-mode .formula-box {
            background: #1e293b;
            color: #e2e8f0;
        }

        .formula-box strong {
            color: #1e293b;
            display: block;
            margin-bottom: 0.5rem;
        }

        body.dark-mode .formula-box strong {
            color: #f1f5f9;
        }

        .key-term {
            color: #3b82f6;
            font-weight: 600;
        }

        .tip-box {
            background: #ecfdf5;
            border-left: 3px solid #10b981;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        body.dark-mode .tip-box {
            background: #064e3b;
            color: #d1fae5;
        }

        .warning-box {
            background: #fef3c7;
            border-left: 3px solid #f59e0b;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        body.dark-mode .warning-box {
            background: #78350f;
            color: #fef3c7;
        }

        /* Responsive Modal */
        @media (max-width: 768px) {
            .modal {
                padding: 1rem;
            }

            .modal-content {
                max-height: 95vh;
            }

            .modal-header {
                padding: 1.25rem 1.5rem;
            }

            .modal-header h2 {
                font-size: 1.25rem;
            }

            .modal-body {
                padding: 1.5rem;
            }

            .close-modal {
                right: 1rem;
                width: 28px;
                height: 28px;
                font-size: 1.25rem;
            }

            .help-icon {
                width: 20px;
                height: 20px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>

    <!-- Particles Background -->
    <canvas id="particles-canvas" class="particles-background"></canvas>

    <div class='layout-wrapper'>
        
        <!-- ============================================
            SIDEBAR NAVIGATION
            ============================================ -->
        <aside class='sidebar' id='sidebar'>
            <!-- Header avec Logo 3D -->
            <div class="sidebar-header">
                <div class="logo-container">
                    <div class="logo-3d">
                        <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" class="logo-gradient-1" />
                                    <stop offset="100%" class="logo-gradient-2" />
                                </linearGradient>
                            </defs>
                            <path d="M 20 80 L 30 70 L 40 75 L 50 60 L 60 65 L 70 45 L 80 50 L 90 30" 
                                stroke="url(#logoGradient)" 
                                stroke-width="4" 
                                fill="none" 
                                stroke-linecap="round" 
                                stroke-linejoin="round"/>
                            <circle cx="30" cy="70" r="4" fill="url(#logoGradient)"/>
                            <circle cx="50" cy="60" r="4" fill="url(#logoGradient)"/>
                            <circle cx="70" cy="45" r="4" fill="url(#logoGradient)"/>
                            <circle cx="90" cy="30" r="5" fill="url(#logoGradient)"/>
                            <path d="M 85 35 L 90 30 L 85 25" 
                                stroke="url(#logoGradient)" 
                                stroke-width="3" 
                                fill="none" 
                                stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="brand-text">
                        <h2 class="brand-name">AlphaVault AI</h2>
                        <span class="brand-tagline">Investments</span>
                    </div>
                </div>
                <button class="sidebar-toggle" aria-label="Toggle Sidebar">
                    <i class="fas fa-angle-left"></i>
                </button>
            </div>
            
            <!-- Navigation -->
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <button class="nav-folder" data-tooltip="Home">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>
                    <div class="nav-submenu">
                        <a href="index.html" class="nav-link">
                            <i class="fas fa-home"></i>
                            <span>Overview</span>
                        </a>
                    </div>
                </div>
                
                <div class='nav-section'>
                    <button class='nav-folder'>
                        <i class='fas fa-wallet'></i>
                        <span>Budget</span>
                        <i class='fas fa-chevron-down arrow'></i>
                    </button>
                    <div class='nav-submenu'>
                        <a href='dashboard-financier.html' class='nav-link'>
                            <i class='fas fa-home'></i>
                            <span>Dashboard Budget</span>
                        </a>
                        <a href='investment-analytics.html' class='nav-link'>
                            <i class='fas fa-chart-bar'></i>
                            <span>Investment Analytics</span>
                        </a>
                    </div>
                </div>
                
                <div class='nav-section'>
                    <button class='nav-folder'>
                        <i class='fas fa-calculator'></i>
                        <span>Simulation</span>
                        <i class='fas fa-chevron-down arrow'></i>
                    </button>
                    <div class='nav-submenu'>
                        <a href='monte-carlo.html' class='nav-link'>
                            <i class='fas fa-dice'></i>
                            <span>Monte Carlo</span>
                        </a>
                        <a href='portfolio-optimizer.html' class='nav-link'>
                            <i class='fas fa-chart-pie'></i>
                            <span>Markowitz</span>
                        </a>
                        <a href='risk-parity.html' class='nav-link'>
                            <i class='fas fa-balance-scale'></i>
                            <span>Risk Parity</span>
                        </a>
                        <a href='scenario-analysis.html' class='nav-link'>
                            <i class='fas fa-flask'></i>
                            <span>Scenarios</span>
                        </a>
                    </div>
                </div>
                
                <div class='nav-section'>
                    <button class="nav-folder" data-tooltip="Stocks">
                        <i class="fas fa-chart-line"></i>
                        <span>Stocks</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>
                    <div class='nav-submenu' style='display: block;'>
                        <a href='advanced-analysis.html' class='nav-link active'>
                            <i class='fas fa-brain'></i>
                            <span>Advanced Analysis</span>
                        </a>
                        <a href='forex-converter.html' class='nav-link'>
                            <i class='fas fa-exchange-alt'></i>
                            <span>Forex Converter</span>
                        </a>
                        <a href='ipo-intelligence.html' class='nav-link'>
                            <i class='fas fa-exchange-alt'></i>
                            <span>IPO Intelligence</span>
                        </a>
                        <!-- <a href='trend-prediction.html' class='nav-link'>
                            <i class='fas fa-chart-line'></i>
                            <span>Trend Prediction</span>
                        </a>
                        <a href='market-intelligence.html' class='nav-link'>
                            <i class='fas fa-globe'></i>
                            <span>Market Intelligence</span>
                        </a>
                        <a href='company-insights.html' class='nav-link'>
                            <i class='fas fa-building'></i>
                            <span>Company Insights</span>
                        </a>
                        <a href='analyst-coverage.html' class='nav-link'>
                            <i class='fas fa-users'></i>
                            <span>Analyst Coverage</span>
                        </a>
                        <a href='earnings-estimates.html' class='nav-link'>
                            <i class='fas fa-coins'></i>
                            <span>Earnings & Estimates</span>
                        </a> -->
                    </div>
                </div>

                <div class='nav-section'>
                    <button class="nav-folder" data-tooltip="AI Assistant">
                        <i class="fas fa-robot"></i>
                        <span>AI Assistant</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>
                    <div class='nav-submenu' style='display: block;'>
                        <a href='chatbot-fullpage.html' class='nav-link'>
                            <i class='fas fa-comments'></i>
                            <span>Alphy AI Chat</span>
                        </a>
                    </div>
                </div>

                <div class='nav-section'>
                    <button class='nav-folder'>
                        <i class='fas fa-globe-americas'></i>
                        <span>Economic Data</span>
                        <i class='fas fa-chevron-down arrow'></i>
                    </button>
                    <div class='nav-submenu' style='display: block;'>
                        <a href='economic-dashboard.html' class='nav-link'>
                            <i class='fas fa-tachometer-alt'></i>
                            <span>Macro Economic Dashboard</span>
                        </a>
                        <a href='inflation-calculator.html' class='nav-link'>
                            <i class='fas fa-calculator'></i>
                            <span>Inflation Calculator</span>
                        </a>
                        <a href='interest-rate-tracker.html' class='nav-link'>
                            <i class='fas fa-percent'></i>
                            <span>Interest Rates</span>
                        </a>
                        <a href='recession-indicator.html' class='nav-link'>
                            <i class='fas fa-exclamation-triangle'></i>
                            <span>Recession Indicators</span>
                        </a>
                    </div>
                </div>
                <!-- ✨ NOUVELLE SECTION NEWS -->
                <div class='nav-section'>
                    <button class="nav-folder" data-tooltip="News & Analysis">
                        <i class="fas fa-newspaper"></i>
                        <span>News & Analysis</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>
                    <div class='nav-submenu'>
                        <a href='news-terminal.html' class='nav-link'>
                            <i class='fas fa-desktop'></i>
                            <span>News Terminal</span>
                        </a>
                        <a href='market-sentiment.html' class='nav-link'>
                            <i class='fas fa-chart-pie'></i>
                            <span>Market Sentiment</span>
                        </a>
                        <a href='trending-topics.html' class='nav-link'>
                            <i class='fas fa-fire'></i>
                            <span>Trending Topics</span>
                        </a>
                    </div>
                </div>
            </nav>
            
            <!-- SIDEBAR FOOTER -->
            <div class="sidebar-footer">
                <div class="sidebar-user-menu">
                    <div class="sidebar-user-trigger" id="sidebarUserTrigger">
                        <img data-user-photo 
                            src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" 
                            alt="Avatar" 
                            class="sidebar-user-avatar">
                        <div class="sidebar-user-info">
                            <span data-user-name class="sidebar-user-name">User</span>
                            <span data-user-plan class="sidebar-user-plan">Free Plan</span>
                        </div>
                        <i class="fas fa-chevron-up sidebar-user-arrow"></i>
                    </div>
                    
                    <div class="sidebar-user-dropdown" id="sidebarUserDropdown">
                        <div class="user-dropdown-header">
                            <img data-user-photo 
                                src="https://ui-avatars.com/api/?name=User&background=2563eb&color=fff" 
                                alt="Avatar" 
                                class="user-dropdown-avatar">
                            <div class="user-dropdown-details">
                                <h4 data-user-name class="user-dropdown-name">User</h4>
                                <p data-user-email class="user-dropdown-email">email@example.com</p>
                            </div>
                        </div>
                        
                        <div class="user-dropdown-divider"></div>
                        
                        <nav class="user-dropdown-links">
                            <a href="user-profile.html" class="user-dropdown-link">
                                <i class="fas fa-user"></i>
                                <span>My profile</span>
                            </a>
                            <a href="settings.html" class="user-dropdown-link">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </a>
                            <a href="#" class="user-dropdown-link">
                                <i class="fas fa-question-circle"></i>
                                <span>Help</span>
                            </a>
                        </nav>
                        
                        <div class="user-dropdown-divider"></div>
                        
                        <button onclick="logout()" class="user-dropdown-logout">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Disconnect</span>
                        </button>
                    </div>
                </div>
            </div>
        </aside>
        
        <div class='sidebar-overlay' id='sidebarOverlay' aria-hidden='true'></div>

        <!-- ============================================
            MAIN CONTENT AREA
            ============================================ -->
        <div class='main-content'>
            <!-- Top Header -->
            <header class='top-header'>
                <div class="header-content-wrapper">
                    <div class='header-left'>
                        <button class='mobile-toggle' id='mobileToggle'>
                            <i class='fas fa-bars'></i>
                        </button>
                        <h1>Advanced Technical Analysis (Legal Compliant)</h1>
                    </div>
                </div>
            </header>
            
            <!-- Container -->
            <div class='container'>
                <div class='content'>
                    
                    <!-- ============================================
                        PORTFOLIO MANAGEMENT SECTION
                        ============================================ -->
                    <div class='portfolio-management-section'>
                        <h2 class='section-title'>
                            <i class='fas fa-briefcase'></i> Portfolio Management
                            <span class='help-icon' onclick='openPortfolioHelp()'></span>
                        </h2>
                        
                        <div class='portfolio-toolbar'>
                            <div class='portfolio-selector'>
                                <label>
                                    <i class='fas fa-folder-open'></i> Active Portfolio:
                                </label>
                                <select id='portfolioSelect' class='portfolio-dropdown'>
                                    <option value=''>Loading portfolios...</option>
                                </select>
                            </div>
                            
                            <div class='portfolio-actions'>
                                <button class='btn-portfolio-action' onclick='PortfolioManager.openCreateModal()'>
                                    <i class='fas fa-plus'></i> New Portfolio
                                </button>
                                <button class='btn-portfolio-action' onclick='PortfolioManager.openManageModal()'>
                                    <i class='fas fa-cog'></i> Manage
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ============================================
                        WATCHLIST SECTION
                        ============================================ -->
                    <div class='watchlist-section'>
                        <h2 class='section-title'>
                            <i class='fas fa-star'></i> Watchlist
                            <span class='help-icon' onclick='openWatchlistHelp()'></span>
                        </h2>
                        
                        <div class='watchlist-toolbar'>
                            <div class='watchlist-search'>
                                <input type='text' 
                                    id='watchlistSearchInput' 
                                    placeholder='Add stock to watchlist (e.g., AAPL)...'
                                    autocomplete='off'>
                                <button class='btn-add-watchlist' onclick='WatchlistManager.addFromInput()'>
                                    <i class='fas fa-plus'></i> Add
                                </button>
                            </div>
                            
                            <div class='watchlist-filters'>
                                <button class='filter-btn active' data-filter='all' onclick='WatchlistManager.filterWatchlist("all")'>
                                    All
                                </button>
                                <button class='filter-btn' data-filter='gainers' onclick='WatchlistManager.filterWatchlist("gainers")'>
                                    <i class='fas fa-arrow-up'></i> Gainers
                                </button>
                                <button class='filter-btn' data-filter='losers' onclick='WatchlistManager.filterWatchlist("losers")'>
                                    <i class='fas fa-arrow-down'></i> Losers
                                </button>
                            </div>
                        </div>
                        
                        <div id='watchlistContainer' class='watchlist-container'>
                            <div class='watchlist-empty'>
                                <i class='fas fa-star'></i>
                                <p>No stocks in watchlist</p>
                                <small>Add stocks to track them in real-time</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ============================================
                        SEARCH PANEL
                        ============================================ -->
                    <div class='search-panel'>
                        <h2 class='panel-title'>
                            <i class='fas fa-search'></i> Select Stock for Advanced Analysis (Technical Indicators Only)
                            <span class='help-icon' onclick='openModal("modalIntro")'></span>
                        </h2>
                        
                        <div class='search-container'>
                            <div class='search-input-wrapper'>
                                <input type='text' 
                                    id='symbolInput' 
                                    placeholder='Search by symbol or company name (e.g., AAPL, Apple, Tesla)...'
                                    autocomplete='off'
                                    value='AAPL'>
                                <button class='btn-analyze' onclick='AdvancedAnalysis.analyzeStock()'>
                                    <i class='fas fa-chart-area'></i> Analyze Stock
                                </button>
                                <div class='search-suggestions' id='searchSuggestions'></div>
                            </div>
                            
                            <div class='popular-stocks'>
                                <span class='quick-label'>Popular Stocks:</span>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("AAPL")'>
                                    <i class='fab fa-apple'></i> AAPL
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("MSFT")'>
                                    <i class='fab fa-microsoft'></i> MSFT
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("GOOGL")'>
                                    <i class='fab fa-google'></i> GOOGL
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("AMZN")'>
                                    <i class='fab fa-amazon'></i> AMZN
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("TSLA")'>
                                    <i class='fas fa-car'></i> TSLA
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("NVDA")'>
                                    <i class='fas fa-microchip'></i> NVDA
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("META")'>
                                    <i class='fab fa-meta'></i> META
                                </button>
                                <button class='symbol-chip' onclick='AdvancedAnalysis.loadSymbol("NFLX")'>
                                    <i class='fas fa-film'></i> NFLX
                                </button>
                            </div>
                            
                            <div class='prediction-settings'>
                                <div class='setting-group'>
                                    <label>Analysis Period:</label>
                                    <button class='horizon-btn' data-period='1M' onclick='AdvancedAnalysis.changePeriod("1M")'>1M</button>
                                    <button class='horizon-btn' data-period='3M' onclick='AdvancedAnalysis.changePeriod("3M")'>3M</button>
                                    <button class='horizon-btn active' data-period='6M' onclick='AdvancedAnalysis.changePeriod("6M")'>6M</button>
                                    <button class='horizon-btn' data-period='1Y' onclick='AdvancedAnalysis.changePeriod("1Y")'>1Y</button>
                                    <button class='horizon-btn' data-period='5Y' onclick='AdvancedAnalysis.changePeriod("5Y")'>5Y</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Loading Indicator -->
                    <div id='loadingIndicator' class='loading-indicator hidden'>
                        <i class='fas fa-spinner fa-spin'></i> 
                        <span id='loadingText'>Loading data and calculating technical indicators...</span>
                    </div>
                    
                    <!-- Stock Header (SANS PRIX) -->
                    <div id='stockHeader' class='stock-header hidden'>
                        <div class='header-content'>
                            <div class='stock-info'>
                                <h2 id='stockSymbol'>-</h2>
                                <span id='stockName' class='stock-name'>-</span>
                            </div>
                            <div class='stock-price'>
                                <div id='currentPrice' class='price'>AlphaVault Score: --</div>
                                <div id='priceChange' class='change'>Market Strength: --</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Results Panel -->
                    <div id='resultsPanel' class='results-panel hidden'>
                        
                        <!-- ============================================
                            CONSOLIDATED SIGNALS
                            ============================================ -->
                        <div class='signals-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-signal'></i> Consolidated Trading Signals (Based on All Indicators)
                                <span class='help-icon' onclick='openModal("modalSignals")'></span>
                            </h3>
                            
                            <div class='signal-gauge'>
                                <div class='gauge-header'>
                                    <h4>Overall Market Signal</h4>
                                </div>
                                <div class='gauge-container'>
                                    <div class='gauge-bar'>
                                        <div class='gauge-fill' id='gaugeFill' style='width: 50%'></div>
                                    </div>
                                    <div class='gauge-value' id='gaugeValue'>NEUTRAL</div>
                                </div>
                            </div>
                            
                            <div class='signals-breakdown' id='signalsBreakdown'>
                                <!-- Rempli dynamiquement -->
                            </div>
                        </div>

                        <!-- ============================================
                            ALPHY AI INVESTMENT RECOMMENDATION
                            ============================================ -->
                        <div class='ai-recommendation-section' id='aiRecommendationSection'>
                            <div class='ai-header'>
                                <div class='ai-logo-container'>
                                    <div class='ai-logo-ring'>
                                        <div class='ai-logo-core'>
                                            <i class='fas fa-brain'></i>
                                        </div>
                                    </div>
                                </div>
                                <div class='ai-header-text'>
                                    <h2 class='ai-title'>
                                        <span class='ai-badge'>POWERED BY</span>
                                        ALPHY AI RECOMMENDATION ENGINE
                                    </h2>
                                    <p class='ai-subtitle'>
                                        Technical Analysis Based Multi-Horizon Investment Analysis
                                        <span class='ai-indicators-count'>Analyzing Technical Indicators Only</span>
                                    </p>
                                </div>
                            </div>

                            <!-- AI Score Global -->
                            <div class='ai-score-container'>
                                <div class='ai-score-card'>
                                    <div class='ai-score-label'>AI CONFIDENCE SCORE</div>
                                    <div class='ai-score-value' id='aiScoreValue'>--</div>
                                    <div class='ai-score-bar' id='aiScoreFill'>
                                        <div class='ai-score-fill' style='width: 0%'></div>
                                    </div>
                                    <div class='ai-score-rating' id='aiScoreRating'>Analyzing...</div>
                                </div>

                                <div class='ai-quick-stats'>
                                    <div class='ai-stat-item'>
                                        <div class='ai-stat-icon bullish'>
                                            <i class='fas fa-arrow-up'></i>
                                        </div>
                                        <div class='ai-stat-content'>
                                            <div class='ai-stat-value' id='bullishSignals'>--</div>
                                            <div class='ai-stat-label'>Bullish Signals</div>
                                        </div>
                                    </div>
                                    <div class='ai-stat-item'>
                                        <div class='ai-stat-icon neutral'>
                                            <i class='fas fa-minus'></i>
                                        </div>
                                        <div class='ai-stat-content'>
                                            <div class='ai-stat-value' id='neutralSignals'>--</div>
                                            <div class='ai-stat-label'>Neutral Signals</div>
                                        </div>
                                    </div>
                                    <div class='ai-stat-item'>
                                        <div class='ai-stat-icon bearish'>
                                            <i class='fas fa-arrow-down'></i>
                                        </div>
                                        <div class='ai-stat-content'>
                                            <div class='ai-stat-value' id='bearishSignals'>--</div>
                                            <div class='ai-stat-label'>Bearish Signals</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Multi-Horizon Recommendations -->
                            <div class='ai-horizons-grid'>
                                <!-- 1 Year Horizon -->
                                <div class='ai-horizon-card' data-horizon='1y'>
                                    <div class='ai-horizon-header'>
                                        <div class='ai-horizon-icon'>
                                            <i class='fas fa-calendar-alt'></i>
                                        </div>
                                        <div class='ai-horizon-title'>
                                            <h3>1 Year Outlook</h3>
                                            <p>Short-Term Investment</p>
                                        </div>
                                    </div>
                                    <div class='ai-horizon-recommendation' id='recommendation1y'>
                                        <div class='ai-rec-badge'>ANALYZING...</div>
                                    </div>
                                    <div class='ai-horizon-details'>
                                        <div class='ai-detail-row'>
                                            <span class='ai-detail-label'>Potential:</span>
                                            <span class='ai-detail-value' id='target1y'>--</span>
                                        </div>
                                        <div class='ai-detail-row'>
                                            <span class='ai-detail-label'>Confidence:</span>
                                            <div class='ai-confidence-bar' id='confidence1y'>
                                                <div class='ai-confidence-fill' style='width: 0%'></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class='ai-horizon-drivers'>
                                        <div class='ai-drivers-label'>Key Drivers:</div>
                                        <div class='ai-drivers-list' id='drivers1y'>
                                            <div class='ai-driver-item'><i class='fas fa-circle-notch fa-spin'></i> Analyzing momentum indicators...</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 2 Years Horizon -->
                                <div class='ai-horizon-card' data-horizon='2y'>
                                    <div class='ai-horizon-header'>
                                        <div class='ai-horizon-icon'>
                                            <i class='fas fa-chart-line'></i>
                                        </div>
                                        <div class='ai-horizon-title'>
                                            <h3>2 Years Outlook</h3>
                                            <p>Medium-Term Investment</p>
                                        </div>
                                    </div>
                                    <div class='ai-horizon-recommendation' id='recommendation2y'>
                                        <div class='ai-rec-badge'>ANALYZING...</div>
                                    </div>
                                    <div class='ai-horizon-details'>
                                        <div class='ai-detail-row'>
                                            <span class='ai-detail-label'>Potential:</span>
                                            <span class='ai-detail-value' id='target2y'>--</span>
                                        </div>
                                        <div class='ai-detail-row'>
                                            <span class='ai-detail-label'>Confidence:</span>
                                            <div class='ai-confidence-bar' id='confidence2y'>
                                                <div class='ai-confidence-fill' style='width: 0%'></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class='ai-horizon-drivers'>
                                        <div class='ai-drivers-label'>Key Drivers:</div>
                                        <div class='ai-drivers-list' id='drivers2y'>
                                            <div class='ai-driver-item'><i class='fas fa-circle-notch fa-spin'></i> Analyzing trend indicators...</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 5 Years Horizon -->
                                <div class='ai-horizon-card' data-horizon='5y'>
                                    <div class='ai-horizon-header'>
                                        <div class='ai-horizon-icon'>
                                            <i class='fas fa-rocket'></i>
                                        </div>
                                        <div class='ai-horizon-title'>
                                            <h3>5 Years Outlook</h3>
                                            <p>Long-Term Investment</p>
                                        </div>
                                    </div>
                                    <div class='ai-horizon-recommendation' id='recommendation5y'>
                                        <div class='ai-rec-badge'>ANALYZING...</div>
                                    </div>
                                    <div class='ai-horizon-details'>
                                        <div class='ai-detail-row'>
                                            <span class='ai-detail-label'>Potential:</span>
                                            <span class='ai-detail-value' id='target5y'>--</span>
                                        </div>
                                        <div class='ai-detail-row'>
                                            <span class='ai-detail-label'>Confidence:</span>
                                            <div class='ai-confidence-bar' id='confidence5y'>
                                                <div class='ai-confidence-fill' style='width: 0%'></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class='ai-horizon-drivers'>
                                        <div class='ai-drivers-label'>Key Drivers:</div>
                                        <div class='ai-drivers-list' id='drivers5y'>
                                            <div class='ai-driver-item'><i class='fas fa-circle-notch fa-spin'></i> Analyzing long-term trends...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Disclaimer -->
                            <div class='ai-disclaimer'>
                                <i class='fas fa-info-circle'></i>
                                <strong>Disclaimer:</strong> This AI-powered analysis is for informational purposes only and should not be considered as financial advice. Alphy AI aggregates technical indicators to provide data-driven insights. Always conduct your own research and consult with a licensed financial advisor before making investment decisions. Past performance does not guarantee future results.
                            </div>
                        </div>
                        
                        <!-- ============================================
                            SECTION 1: MOMENTUM OSCILLATORS
                            ============================================ -->
                        <div class='oscillators-grid'>
                            
                            <!-- RSI -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-chart-line'></i> RSI - Relative Strength Index
                                    <span class='help-icon' onclick='openModal("modalRSI")'></span>
                                </h3>
                                <div id='rsiChart' class='chart'></div>
                                <div class='signal-box' id='rsiSignal'>Calculating...</div>
                            </div>
                            
                            <!-- MACD -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-wave-square'></i> MACD
                                    <span class='help-icon' onclick='openModal("modalMACD")'></span>
                                </h3>
                                <div id='macdChart' class='chart'></div>
                                <div class='signal-box' id='macdSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- Stochastic & Williams Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- Stochastic -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-wave-square'></i> Stochastic Oscillator
                                    <span class='help-icon' onclick='openModal("modalStochastic")'></span>
                                </h3>
                                <div id='stochasticChart' class='chart'></div>
                                <div class='signal-box' id='stochasticSignal'>Calculating...</div>
                            </div>
                            
                            <!-- Williams %R -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-chart-line'></i> Williams %R
                                    <span class='help-icon' onclick='openModal("modalWilliams")'></span>
                                </h3>
                                <div id='williamsChart' class='chart'></div>
                                <div class='signal-box' id='williamsSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- MFI, CCI, Ultimate Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- MFI -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-coins'></i> MFI - Money Flow Index
                                    <span class='help-icon' onclick='openModal("modalMFI")'></span>
                                </h3>
                                <div id='mfiChart' class='chart'></div>
                                <div class='signal-box' id='mfiSignal'>Calculating...</div>
                            </div>
                            
                            <!-- CCI -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-chart-area'></i> CCI - Commodity Channel Index
                                    <span class='help-icon' onclick='openModal("modalCCI")'></span>
                                </h3>
                                <div id='cciChart' class='chart'></div>
                                <div class='signal-box' id='cciSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- Ultimate & ROC Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- Ultimate Oscillator -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-layer-group'></i> Ultimate Oscillator
                                    <span class='help-icon' onclick='openModal("modalUltimate")'></span>
                                </h3>
                                <div id='ultimateChart' class='chart'></div>
                                <div class='signal-box' id='ultimateSignal'>Calculating...</div>
                            </div>
                            
                            <!-- ROC -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-percentage'></i> ROC - Rate of Change
                                    <span class='help-icon' onclick='openModal("modalROC")'></span>
                                </h3>
                                <div id='rocChart' class='chart'></div>
                                <div class='signal-box' id='rocSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- ============================================
                            SECTION 2: TREND INDICATORS
                            ============================================ -->
                        
                        <!-- ADX & Aroon Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- ADX -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-chart-area'></i> ADX - Trend Strength
                                    <span class='help-icon' onclick='openModal("modalADX")'></span>
                                </h3>
                                <div id='adxChart' class='chart'></div>
                                <div class='signal-box' id='adxSignal'>Calculating...</div>
                            </div>
                            
                            <!-- Aroon Indicator -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-arrows-alt-h'></i> Aroon Indicator
                                    <span class='help-icon' onclick='openModal("modalAroon")'></span>
                                </h3>
                                <div id='aroonChart' class='chart'></div>
                                <div class='signal-box' id='aroonSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- ============================================
                            SECTION 3: VOLATILITY
                            ============================================ -->
                        
                        <!-- ATR -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-arrows-alt-v'></i> Average True Range (ATR)
                                <span class='help-icon' onclick='openModal("modalATR")'></span>
                            </h3>
                            <div id='atrChart' class='chart'></div>
                            <div class='signal-box' id='atrSignal'>Calculating...</div>
                        </div>
                        
                        <!-- ============================================
                            SECTION 4: VOLUME ANALYSIS
                            ============================================ -->
                        
                        <!-- OBV & CMF Grid -->
                        <div class='oscillators-grid'>
                            
                            <!-- OBV -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-chart-bar'></i> On-Balance Volume
                                    <span class='help-icon' onclick='openModal("modalOBV")'></span>
                                </h3>
                                <div id='obvChart' class='chart'></div>
                                <div class='signal-box' id='obvSignal'>Calculating...</div>
                            </div>
                            
                            <!-- CMF -->
                            <div class='oscillator-card'>
                                <h3 class='section-title'>
                                    <i class='fas fa-water'></i> CMF - Chaikin Money Flow
                                    <span class='help-icon' onclick='openModal("modalCMF")'></span>
                                </h3>
                                <div id='cmfChart' class='chart'></div>
                                <div class='signal-box' id='cmfSignal'>Calculating...</div>
                            </div>
                            
                        </div>
                        
                        <!-- Elder Ray -->
                        <div class='chart-section'>
                            <h3 class='section-title'>
                                <i class='fas fa-balance-scale'></i> Elder Ray Index - Bull & Bear Power
                                <span class='help-icon' onclick='openModal("modalElderRay")'></span>
                            </h3>
                            <div id='elderRayChart' class='chart'></div>
                            <div class='signal-box' id='elderRaySignal'>Calculating...</div>
                        </div>
                        
                    </div>
                </div>
                
                <!-- Footer -->
                <footer>
                    <p>Advanced Technical Analysis | Legal Compliant Version (Technical Indicators Only)</p>
                </footer>
            </div>
        </div>
        
    </div>

    <!-- ✅ SCRIPTS CHARGÉS UNE SEULE FOIS (EN BAS DE PAGE) -->
    <script src="assets/js/favicon-dynamic.js"></script>
    <script src="assets/js/theme.js"></script>
    <script src="assets/js/theme-charts.js"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/api-client.js"></script>
    <script src="assets/js/dark-mode.js"></script>
    <script src="assets/js/common.js"></script>
    <script src="assets/js/sidebar.js"></script>
    <script src="assets/js/chatbot-particles.js"></script>
    <script src='assets/js/advanced-analysis.js'></script>
    <script src='assets/js/portfolio-manager.js'></script>
    <!-- ❌ watchlist-manager.js SUPPRIMÉ (fichier manquant) -->
    
    <!-- Chatbot Scripts -->
    <script src='assets/js/chatbot-config.js'></script>
    <script src='assets/js/chatbot-gemini.js'></script>
    <script src='assets/js/chatbot-analytics.js'></script>
    <script src='assets/js/chatbot-charts.js'></script>
    <script src='assets/js/chatbot-ai-engine.js'></script>
    <script src='assets/js/chatbot-ui.js'></script>
    
    <!-- Chatbot Initialization -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Initializing chatbot FinanceGPT...');
        
        if (typeof ChatbotConfig === 'undefined') {
            console.error('ChatbotConfig not defined!');
            return;
        }
        
        console.log('ChatbotConfig loaded');
        
        if (typeof ChatbotUI === 'undefined') {
            console.error('ChatbotUI not defined!');
            return;
        }
        
        console.log('ChatbotUI loaded');
        
        try {
            window.financialChatbot = new ChatbotUI(ChatbotConfig);
            console.log('Chatbot FinanceGPT initialized successfully');
        } catch (error) {
            console.error('Error initializing chatbot:', error);
        }
    });
    </script>
    
    <!-- User Menu Initialization -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Force initializing user menu...');
        
        const trigger = document.getElementById('sidebarUserTrigger');
        const dropdown = document.getElementById('sidebarUserDropdown');
        
        if (trigger && dropdown) {
            console.log('User menu elements found');
            
            console.log('Adding click event to trigger...');
            trigger.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('User menu clicked!');
                dropdown.classList.toggle('active');
            });
            
            document.addEventListener('click', function(e) {
                if (!trigger.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.remove('active');
                }
            });
            
            console.log('User menu initialized successfully!');
        } else {
            console.error('User menu elements not found!');
        }
    });
    </script>

</body>
</html>

<!-- ============================================
     MODALS - PORTFOLIO, WATCHLIST & ALERTS
     ============================================ -->

<!-- Modal: Create Portfolio -->
<div id='modalCreatePortfolio' class='modal'>
    <div class='modal-content modal-small'>
        <div class='modal-header'>
            <h2><i class='fas fa-folder-plus'></i> Create New Portfolio</h2>
            <span class='close-modal' onclick='closeModal("modalCreatePortfolio")'>&times;</span>
        </div>
        <div class='modal-body'>
            <div class='form-group'>
                <label>Portfolio Name</label>
                <input type='text' id='newPortfolioName' placeholder='e.g., Tech Stocks, Dividend Portfolio...' class='form-input'>
            </div>
            <div class='modal-actions'>
                <button class='btn-cancel' onclick='closeModal("modalCreatePortfolio")'>Cancel</button>
                <button class='btn-confirm' onclick='PortfolioManager.createPortfolio()'>
                    <i class='fas fa-check'></i> Create
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Manage Portfolios -->
<div id='modalManagePortfolios' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2><i class='fas fa-cog'></i> Manage Portfolios</h2>
            <span class='close-modal' onclick='closeModal("modalManagePortfolios")'>&times;</span>
        </div>
        <div class='modal-body'>
            <div id='portfoliosListManage' class='portfolios-manage-list'>
                <!-- Rempli dynamiquement -->
            </div>
        </div>
    </div>
</div>

<!-- Modal: Create Price Alert -->
<div id='modalCreateAlert' class='modal'>
    <div class='modal-content modal-small'>
        <div class='modal-header'>
            <h2><i class='fas fa-bell'></i> Create Price Alert</h2>
            <span class='close-modal' onclick='closeModal("modalCreateAlert")'>&times;</span>
        </div>
        <div class='modal-body'>
            <div class='form-group'>
                <label>Stock Symbol</label>
                <input type='text' id='alertSymbol' placeholder='e.g., AAPL' class='form-input' style='text-transform: uppercase;'>
            </div>
            <div class='form-group'>
                <label>Alert Condition</label>
                <select id='alertCondition' class='form-input'>
                    <option value='above'>Price goes above</option>
                    <option value='below'>Price goes below</option>
                </select>
            </div>
            <div class='form-group'>
                <label>Target Price ($)</label>
                <input type='number' id='alertTargetPrice' placeholder='e.g., 150.00' class='form-input' step='0.01'>
            </div>
            <div class='modal-actions'>
                <button class='btn-cancel' onclick='closeModal("modalCreateAlert")'>Cancel</button>
                <button class='btn-confirm' onclick='AlertsManager.createAlert()'>
                    <i class='fas fa-check'></i> Create Alert
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ============================================
     MODALS - INDICATEURS TECHNIQUES (SANS EMOJIS)
     ============================================ -->

<!-- Modal Introduction -->
<div id='modalIntro' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Advanced Technical Analysis - Wall Street Edition</h2>
            <span class='close-modal' onclick='closeModal("modalIntro")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is This Platform?</h3>
            <p>This is a <span class='key-term'>professional-grade technical analysis platform</span> featuring <strong>40+ institutional-level indicators</strong> used by hedge funds, prop traders, and Wall Street analysts.</p>
            
            <h3>40+ Available Indicators</h3>
            
            <h4>Momentum Oscillators (8)</h4>
            <ul>
                <li>RSI - Relative Strength Index</li>
                <li>MACD - Moving Average Convergence Divergence</li>
                <li>Stochastic Oscillator</li>
                <li>Williams %R</li>
                <li>MFI - Money Flow Index</li>
                <li>CCI - Commodity Channel Index</li>
                <li>Ultimate Oscillator</li>
                <li>ROC - Rate of Change</li>
            </ul>
            
            <h4>Trend Indicators (7)</h4>
            <ul>
                <li>Ichimoku Cloud</li>
                <li>ADX - Average Directional Index</li>
                <li>Parabolic SAR</li>
                <li>Aroon Indicator</li>
                <li>Moving Averages (SMA 20/50/200, EMA 9/21)</li>
                <li>Linear Regression Channel</li>
            </ul>
            
            <h4>Volatility & Channels (4)</h4>
            <ul>
                <li>Bollinger Bands</li>
                <li>Keltner Channels</li>
                <li>Donchian Channels</li>
                <li>ATR - Average True Range</li>
            </ul>
            
            <h4>Volume Analysis (5)</h4>
            <ul>
                <li>OBV - On-Balance Volume</li>
                <li>CMF - Chaikin Money Flow</li>
                <li>VWAP - Volume Weighted Average Price</li>
                <li>Volume Profile</li>
                <li>Elder Ray Index (Bull/Bear Power)</li>
            </ul>
            
            <h4>Support/Resistance & Patterns (5)</h4>
            <ul>
                <li>Fibonacci Retracements</li>
                <li>Pivot Points (Standard, Fibonacci, Camarilla)</li>
                <li>Automatic Support/Resistance Detection</li>
                <li>Candlestick Pattern Recognition (20+ patterns)</li>
                <li>Divergence Detection</li>
            </ul>
            
            <h3>How to Use</h3>
            <ol>
                <li><strong>Search:</strong> Enter a stock symbol or company name</li>
                <li><strong>Period:</strong> Select analysis timeframe (1M to 5Y)</li>
                <li><strong>Analyze:</strong> Click "Analyze Stock"</li>
                <li><strong>Review:</strong> Consolidated signals + individual indicators</li>
                <li><strong>Decide:</strong> Make informed trading decisions</li>
            </ol>
            
            <div class='warning-box'>
                <strong>Important:</strong> Technical analysis should complement fundamental analysis and proper risk management. Past performance doesn't guarantee future results.
            </div>
        </div>
    </div>
</div>

<!-- Modal: Consolidated Signals -->
<div id='modalSignals' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Consolidated Trading Signals</h2>
            <span class='close-modal' onclick='closeModal("modalSignals")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>How Signals Are Calculated</h3>
            <p>The <span class='key-term'>Consolidated Signal</span> aggregates <strong>40+ technical indicators</strong> to provide an overall market sentiment with institutional-grade accuracy.</p>
            
            <h3>Signal Categories</h3>
            <ul>
                <li><strong>STRONG BUY (80-100%):</strong> Overwhelming bullish consensus across all indicator categories</li>
                <li><strong>BUY (60-80%):</strong> Clear bullish majority - favorable entry conditions</li>
                <li><strong>NEUTRAL (40-60%):</strong> Mixed signals - consolidation or uncertainty</li>
                <li><strong>SELL (20-40%):</strong> Clear bearish majority - exit warning</li>
                <li><strong>STRONG SELL (0-20%):</strong> Overwhelming bearish consensus - strong exit signal</li>
            </ul>
            
            <h3>Indicators Analyzed (40+)</h3>
            <p>Each indicator contributes <strong>+1 (bullish)</strong>, <strong>0 (neutral)</strong>, or <strong>-1 (bearish)</strong> to the final score:</p>
            
            <h4>Momentum (8 indicators)</h4>
            <ul>
                <li>RSI (overbought/oversold levels)</li>
                <li>MACD (histogram direction & crossovers)</li>
                <li>Stochastic (K/D crossovers & zones)</li>
                <li>Williams %R (momentum zones)</li>
                <li>MFI (money flow strength)</li>
                <li>CCI (channel extremes)</li>
                <li>Ultimate Oscillator (multi-timeframe momentum)</li>
                <li>ROC (momentum direction)</li>
            </ul>
            
            <h3>Calculation Formula</h3>
            <div class='formula-box'>
                Signal % = [(Total Signal Score + Max Indicators) / (2 × Max Indicators)] × 100<br><br>
                Example: 15 bullish, 5 neutral, 5 bearish out of 25 indicators<br>
                Signal Score = (+15) + (0) + (-5) = +10<br>
                Signal % = [(10 + 25) / (2 × 25)] × 100 = 70% → <strong>BUY</strong>
            </div>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> Wait for signals above 70% or below 30% for highest probability trades. Use multiple timeframes for confirmation.
            </div>
        </div>
    </div>
</div>

<!-- Modal: RSI -->
<div id='modalRSI' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>RSI - Relative Strength Index</h2>
            <span class='close-modal' onclick='closeModal("modalRSI")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is RSI?</h3>
            <p>The <span class='key-term'>Relative Strength Index</span> is a momentum oscillator developed by J. Welles Wilder that measures the speed and magnitude of price changes. It's one of the most popular technical indicators.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Step 1: Calculate Price Changes</strong><br>
                Gain = Price(today) - Price(yesterday) if positive, else 0<br>
                Loss = |Price(today) - Price(yesterday)| if negative, else 0<br><br>
                
                <strong>Step 2: Calculate Average Gains & Losses (14 periods)</strong><br>
                First Avg Gain = Sum of Gains / 14<br>
                First Avg Loss = Sum of Losses / 14<br><br>
                
                <strong>Step 3: Smooth Averages</strong><br>
                Avg Gain = [(Previous Avg Gain × 13) + Current Gain] / 14<br>
                Avg Loss = [(Previous Avg Loss × 13) + Current Loss] / 14<br><br>
                
                <strong>Step 4: Calculate RS and RSI</strong><br>
                RS = Avg Gain / Avg Loss<br>
                RSI = 100 - [100 / (1 + RS)]<br><br>
                
                <strong>Range:</strong> 0 to 100
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>RSI > 70:</strong> Overbought zone - potential reversal down (sell signal)</li>
                <li><strong>RSI < 30:</strong> Oversold zone - potential reversal up (buy signal)</li>
                <li><strong>RSI 50:</strong> Neutral zone - market equilibrium</li>
                <li><strong>RSI crossing above 30:</strong> Bullish reversal signal</li>
                <li><strong>RSI crossing below 70:</strong> Bearish reversal signal</li>
            </ul>
            
            <h3>Advanced Techniques</h3>
            <ul>
                <li><strong>Divergence:</strong> Price makes higher highs but RSI makes lower highs = bearish divergence (sell)</li>
                <li><strong>Hidden Divergence:</strong> Price makes lower lows but RSI makes higher lows = bullish (continuation)</li>
                <li><strong>Centerline Crossover:</strong> RSI crossing above 50 = bullish momentum</li>
                <li><strong>Failure Swings:</strong> RSI fails to reach overbought/oversold = reversal warning</li>
            </ul>
            
            <div class='warning-box'>
                <strong>Warning:</strong> In strong trends, RSI can remain overbought (>70) or oversold (<30) for extended periods. Always confirm with trend indicators.
            </div>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> Use RSI 80/20 levels for stocks, 70/30 for indices. In strong uptrends, wait for RSI to dip to 40-50 for entries.
            </div>
        </div>
    </div>
</div>

<!-- Modal: MACD -->
<div id='modalMACD' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>MACD - Moving Average Convergence Divergence</h2>
            <span class='close-modal' onclick='closeModal("modalMACD")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is MACD?</h3>
            <p>The <span class='key-term'>MACD</span> is a trend-following momentum indicator developed by Gerald Appel that shows the relationship between two exponential moving averages. It's one of the most powerful indicators for trend identification.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Step 1: Calculate EMAs</strong><br>
                EMA(12) = 12-period Exponential Moving Average<br>
                EMA(26) = 26-period Exponential Moving Average<br>
                Multiplier = 2 / (Period + 1)<br>
                EMA = [Close - EMA(previous)] × Multiplier + EMA(previous)<br><br>
                
                <strong>Step 2: Calculate MACD Line</strong><br>
                MACD Line = EMA(12) - EMA(26)<br><br>
                
                <strong>Step 3: Calculate Signal Line</strong><br>
                Signal Line = 9-period EMA of MACD Line<br><br>
                
                <strong>Step 4: Calculate Histogram</strong><br>
                MACD Histogram = MACD Line - Signal Line
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>MACD Line crosses above Signal Line:</strong> BULLISH CROSSOVER - Buy Signal</li>
                <li><strong>MACD Line crosses below Signal Line:</strong> BEARISH CROSSOVER - Sell Signal</li>
                <li><strong>Histogram > 0 and increasing:</strong> Bullish momentum strengthening</li>
                <li><strong>Histogram < 0 and decreasing:</strong> Bearish momentum strengthening</li>
                <li><strong>Histogram crossing zero:</strong> Momentum shift confirmation</li>
                <li><strong>MACD crossing zero line:</strong> Trend change confirmation</li>
            </ul>
            
            <h3>Advanced Signals</h3>
            <ul>
                <li><strong>Bullish Divergence:</strong> Price makes lower lows, MACD makes higher lows → Reversal up</li>
                <li><strong>Bearish Divergence:</strong> Price makes higher highs, MACD makes lower highs → Reversal down</li>
                <li><strong>Zero Line Rejection:</strong> MACD bounces at zero line → Strong trend continuation</li>
                <li><strong>Histogram Peak:</strong> Highest bar before reversal → Momentum exhaustion</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> MACD works best in trending markets. Combine with ADX (>25) for confirmation. In sideways markets, use RSI instead.
            </div>
        </div>
    </div>
</div>

<!-- Modal: Stochastic -->
<div id='modalStochastic' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Stochastic Oscillator</h2>
            <span class='close-modal' onclick='closeModal("modalStochastic")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is the Stochastic Oscillator?</h3>
            <p>The <span class='key-term'>Stochastic Oscillator</span> is a momentum indicator developed by George Lane that compares a particular closing price to a range of prices over a certain period.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Default Period: 14</strong><br><br>
                
                <strong>Step 1: Calculate %K (Fast Stochastic)</strong><br>
                %K = [(Current Close - Lowest Low) / (Highest High - Lowest Low)] × 100<br><br>
                
                <strong>Step 2: Calculate %D (Slow Stochastic)</strong><br>
                %D = 3-period Simple Moving Average of %K<br><br>
                
                <strong>Range:</strong> 0 to 100
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>%K above 80:</strong> Overbought zone - potential sell signal</li>
                <li><strong>%K below 20:</strong> Oversold zone - potential buy signal</li>
                <li><strong>%K crosses above %D:</strong> Bullish signal</li>
                <li><strong>%K crosses below %D:</strong> Bearish signal</li>
            </ul>
            
            <div class='warning-box'>
                <strong>Warning:</strong> In strong trends, Stochastic can remain overbought (>80) or oversold (<20) for extended periods.
            </div>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> Combine Stochastic with trend indicators like ADX. Only take overbought signals in downtrends and oversold signals in uptrends.
            </div>
        </div>
    </div>
</div>

<!-- Modal: Williams %R -->
<div id='modalWilliams' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Williams %R</h2>
            <span class='close-modal' onclick='closeModal("modalWilliams")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is Williams %R?</h3>
            <p>The <span class='key-term'>Williams %R</span> is a momentum indicator developed by Larry Williams that measures overbought/oversold levels.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Default Period: 14</strong><br><br>
                
                <strong>Formula:</strong><br>
                Williams %R = [(Highest High - Close) / (Highest High - Lowest Low)] × -100<br><br>
                
                <strong>Range:</strong> 0 to -100 (inverted scale)
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>-20 to 0:</strong> OVERBOUGHT zone - consider selling</li>
                <li><strong>-80 to -100:</strong> OVERSOLD zone - consider buying</li>
                <li><strong>Williams %R crossing above -80:</strong> Bullish signal</li>
                <li><strong>Williams %R crossing below -20:</strong> Bearish signal</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> Use Williams %R for short-term trading. For longer timeframes, Stochastic with %D smoothing is more reliable.
            </div>
        </div>
    </div>
</div>

<!-- Modal: MFI -->
<div id='modalMFI' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>MFI - Money Flow Index</h2>
            <span class='close-modal' onclick='closeModal("modalMFI")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is MFI?</h3>
            <p>The <span class='key-term'>Money Flow Index</span> is a volume-weighted version of RSI that measures buying and selling pressure.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Step 1: Calculate Typical Price</strong><br>
                Typical Price = (High + Low + Close) / 3<br><br>
                
                <strong>Step 2: Calculate Money Flow</strong><br>
                Money Flow = Typical Price × Volume<br><br>
                
                <strong>Step 3: Calculate MFI</strong><br>
                MFI = 100 - [100 / (1 + Money Flow Ratio)]<br><br>
                
                <strong>Range:</strong> 0 to 100
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>MFI > 80:</strong> OVERBOUGHT - Strong selling pressure expected</li>
                <li><strong>MFI < 20:</strong> OVERSOLD - Strong buying pressure expected</li>
                <li><strong>MFI > 50:</strong> Positive money flow - buyers in control</li>
                <li><strong>MFI < 50:</strong> Negative money flow - sellers in control</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> MFI is superior to RSI when volume is significant. Divergences are extremely powerful signals.
            </div>
        </div>
    </div>
</div>

<!-- Modal: CCI -->
<div id='modalCCI' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>CCI - Commodity Channel Index</h2>
            <span class='close-modal' onclick='closeModal("modalCCI")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is CCI?</h3>
            <p>The <span class='key-term'>Commodity Channel Index</span> measures the variation of price from its statistical mean.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Default Period: 20</strong><br><br>
                
                <strong>Formula:</strong><br>
                CCI = (TP - SMA(TP)) / (0.015 × Mean Deviation)<br><br>
                
                Where TP = Typical Price = (High + Low + Close) / 3
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>CCI > +100:</strong> OVERBOUGHT - potential reversal</li>
                <li><strong>CCI < -100:</strong> OVERSOLD - potential reversal</li>
                <li><strong>CCI crossing above 0:</strong> Bullish signal</li>
                <li><strong>CCI crossing below 0:</strong> Bearish signal</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> CCI is unbounded, so extreme readings (+300, -300) indicate very strong trends. Don't fight these moves!
            </div>
        </div>
    </div>
</div>

<!-- Modal: Ultimate Oscillator -->
<div id='modalUltimate' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Ultimate Oscillator</h2>
            <span class='close-modal' onclick='closeModal("modalUltimate")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is the Ultimate Oscillator?</h3>
            <p>The <span class='key-term'>Ultimate Oscillator</span> uses weighted averages of three different timeframes to reduce false signals.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Default Periods: 7, 14, 28</strong><br><br>
                
                <strong>Formula:</strong><br>
                UO = 100 × [(4 × Avg7) + (2 × Avg14) + Avg28] / (4 + 2 + 1)<br><br>
                
                <strong>Range:</strong> 0 to 100
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>UO > 70:</strong> Overbought - potential sell signal</li>
                <li><strong>UO < 30:</strong> Oversold - potential buy signal</li>
                <li><strong>Bullish Divergence:</strong> Price makes lower low, UO makes higher low</li>
                <li><strong>Bearish Divergence:</strong> Price makes higher high, UO makes lower high</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> The multi-timeframe approach makes this oscillator less prone to false signals than single-period oscillators.
            </div>
        </div>
    </div>
</div>

<!-- Modal: ROC -->
<div id='modalROC' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>ROC - Rate of Change</h2>
            <span class='close-modal' onclick='closeModal("modalROC")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is ROC?</h3>
            <p>The <span class='key-term'>Rate of Change</span> measures the percentage change in price from one period to another.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Default Period: 12</strong><br><br>
                
                <strong>Formula:</strong><br>
                ROC = [(Close(today) - Close(n periods ago)) / Close(n periods ago)] × 100<br><br>
                
                <strong>Range:</strong> Unbounded (typically -50% to +50%)
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>ROC > 0:</strong> Positive momentum - price trending up</li>
                <li><strong>ROC < 0:</strong> Negative momentum - price trending down</li>
                <li><strong>ROC crossing above 0:</strong> Bullish momentum shift</li>
                <li><strong>ROC crossing below 0:</strong> Bearish momentum shift</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> ROC is excellent for comparing momentum across different stocks. Use 9-period for short-term, 25-period for medium-term analysis.
            </div>
        </div>
    </div>
</div>

<!-- Modal: ADX -->
<div id='modalADX' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>ADX - Average Directional Index</h2>
            <span class='close-modal' onclick='closeModal("modalADX")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is ADX?</h3>
            <p>The <span class='key-term'>Average Directional Index (ADX)</span> measures the strength of a trend, regardless of direction.</p>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>ADX < 20:</strong> WEAK TREND or NO TREND - ranging market</li>
                <li><strong>ADX > 25:</strong> STRONG TREND - good for trend-following</li>
                <li><strong>ADX > 40:</strong> VERY STRONG TREND</li>
                <li><strong>ADX > 50:</strong> EXTREMELY STRONG TREND</li>
            </ul>
            
            <h3>Trading with +DI and -DI</h3>
            <ul>
                <li><strong>+DI above -DI + ADX > 25:</strong> STRONG UPTREND</li>
                <li><strong>-DI above +DI + ADX > 25:</strong> STRONG DOWNTREND</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> ADX is a LAGGING indicator. Use it to filter trades: only take trend-following setups when ADX > 25.
            </div>
            
            <div class='warning-box'>
                <strong>Warning:</strong> ADX does NOT tell you trend direction! Always look at +DI/-DI to determine if trend is up or down.
            </div>
        </div>
    </div>
</div>

<!-- Modal: Aroon -->
<div id='modalAroon' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Aroon Indicator</h2>
            <span class='close-modal' onclick='closeModal("modalAroon")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is the Aroon Indicator?</h3>
            <p>The <span class='key-term'>Aroon Indicator</span> identifies when trends are likely to begin and measures trend strength.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Default Period: 25</strong><br><br>
                
                <strong>Aroon Up:</strong><br>
                Aroon Up = [(25 - Periods Since 25-period High) / 25] × 100<br><br>
                
                <strong>Aroon Down:</strong><br>
                Aroon Down = [(25 - Periods Since 25-period Low) / 25] × 100<br><br>
                
                <strong>Range:</strong> 0 to 100
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>Aroon Up > 70 & Aroon Down < 30:</strong> STRONG UPTREND</li>
                <li><strong>Aroon Down > 70 & Aroon Up < 30:</strong> STRONG DOWNTREND</li>
                <li><strong>Aroon Up crosses above Aroon Down:</strong> Bullish signal</li>
                <li><strong>Both indicators below 50:</strong> Consolidation</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> Aroon is excellent for identifying the START of new trends.
            </div>
        </div>
    </div>
</div>

<!-- Modal: ATR -->
<div id='modalATR' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Average True Range (ATR)</h2>
            <span class='close-modal' onclick='closeModal("modalATR")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is ATR?</h3>
            <p>The <span class='key-term'>Average True Range</span> measures market volatility. ATR does NOT indicate trend direction, only volatility.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Default Period: 14</strong><br><br>
                
                <strong>Step 1: Calculate True Range (TR)</strong><br>
                TR = MAX of:<br>
                - (High - Low)<br>
                - |High - Previous Close|<br>
                - |Low - Previous Close|<br><br>
                
                <strong>Step 2: Calculate ATR</strong><br>
                ATR = 14-period Smoothed Average of TR
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>High ATR:</strong> HIGH VOLATILITY - larger price swings</li>
                <li><strong>Low ATR:</strong> LOW VOLATILITY - smaller movements</li>
                <li><strong>Rising ATR:</strong> Volatility INCREASING</li>
                <li><strong>Falling ATR:</strong> Volatility DECREASING</li>
            </ul>
            
            <h3>Practical Applications</h3>
            <ul>
                <li><strong>Stop Loss Placement:</strong> Stop = Entry ± (2 × ATR)</li>
                <li><strong>Profit Targets:</strong> Target = Entry + (2-3 × ATR)</li>
                <li><strong>Position Sizing:</strong> Adjust based on ATR</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> NEVER use fixed dollar stops! Always use ATR-based stops that adapt to market volatility.
            </div>
            
            <div class='warning-box'>
                <strong>Warning:</strong> ATR is NOT directional! High ATR doesn't mean "buy" or "sell", it just means volatility.
            </div>
        </div>
    </div>
</div>

<!-- Modal: OBV -->
<div id='modalOBV' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>On-Balance Volume (OBV)</h2>
            <span class='close-modal' onclick='closeModal("modalOBV")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is OBV?</h3>
            <p>The <span class='key-term'>On-Balance Volume</span> measures buying and selling pressure. Volume precedes price.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Formula:</strong><br><br>
                
                If Close(today) > Close(yesterday):<br>
                OBV(today) = OBV(yesterday) + Volume(today)<br><br>
                
                If Close(today) < Close(yesterday):<br>
                OBV(today) = OBV(yesterday) - Volume(today)<br><br>
                
                If Close(today) = Close(yesterday):<br>
                OBV(today) = OBV(yesterday)
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>OBV rising + Price rising:</strong> HEALTHY UPTREND</li>
                <li><strong>OBV falling + Price falling:</strong> HEALTHY DOWNTREND</li>
                <li><strong>OBV rising + Price falling:</strong> BULLISH DIVERGENCE</li>
                <li><strong>OBV falling + Price rising:</strong> BEARISH DIVERGENCE</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> OBV is one of the BEST leading indicators. When OBV diverges from price, trust the volume.
            </div>
            
            <div class='warning-box'>
                <strong>Warning:</strong> OBV doesn't work well on low-volume stocks.
            </div>
        </div>
    </div>
</div>

<!-- Modal: CMF -->
<div id='modalCMF' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>CMF - Chaikin Money Flow</h2>
            <span class='close-modal' onclick='closeModal("modalCMF")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is Chaikin Money Flow?</h3>
            <p>The <span class='key-term'>CMF</span> measures the amount of Money Flow Volume over a specific period.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Default Period: 20</strong><br><br>
                
                <strong>Step 1: Money Flow Multiplier</strong><br>
                MFM = [(Close - Low) - (High - Close)] / (High - Low)<br><br>
                
                <strong>Step 2: Money Flow Volume</strong><br>
                MFV = MFM × Volume<br><br>
                
                <strong>Step 3: CMF</strong><br>
                CMF = (20-period Sum of MFV) / (20-period Sum of Volume)<br><br>
                
                <strong>Range:</strong> -1 to +1
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>CMF > +0.05:</strong> STRONG BUYING PRESSURE</li>
                <li><strong>CMF < -0.05:</strong> STRONG SELLING PRESSURE</li>
                <li><strong>CMF crossing above 0:</strong> Bullish signal</li>
                <li><strong>CMF crossing below 0:</strong> Bearish signal</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> CMF is more reliable than OBV because it considers WHERE the price closes within the range.
            </div>
        </div>
    </div>
</div>

<!-- Modal: Elder Ray -->
<div id='modalElderRay' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Elder Ray Index - Bull & Bear Power</h2>
            <span class='close-modal' onclick='closeModal("modalElderRay")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is the Elder Ray Index?</h3>
            <p>Developed by Dr. Alexander Elder, this indicator measures the <span class='key-term'>power of bulls and bears</span> by comparing price extremes to an exponential moving average.</p>
            
            <h3>Mathematical Calculation</h3>
            <div class='formula-box'>
                <strong>Default: 13-period EMA</strong><br><br>
                
                <strong>Bull Power:</strong><br>
                Bull Power = High - EMA(13)<br><br>
                
                <strong>Bear Power:</strong><br>
                Bear Power = Low - EMA(13)<br><br>
                
                <strong>Interpretation:</strong><br>
                Bull Power > 0: Bulls pushing above average<br>
                Bear Power < 0: Bears pushing below average
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>Both Bull & Bear Power > 0:</strong> STRONG BULLS - Uptrend</li>
                <li><strong>Both Bull & Bear Power < 0:</strong> STRONG BEARS - Downtrend</li>
                <li><strong>Bull Power rising:</strong> Bulls gaining strength</li>
                <li><strong>Bear Power falling:</strong> Bears gaining strength</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> Elder Ray is best used WITH trend indicators. In uptrends, wait for Bear Power to become less negative for entries.
            </div>
        </div>
    </div>
</div>

<!-- Modal: Fibonacci -->
<div id='modalFibonacci' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Fibonacci Retracements</h2>
            <span class='close-modal' onclick='closeModal("modalFibonacci")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What are Fibonacci Retracements?</h3>
            <p><span class='key-term'>Fibonacci Retracements</span> are horizontal lines that indicate potential support and resistance levels based on the Fibonacci sequence.</p>
            
            <h3>Key Levels</h3>
            <ul>
                <li><strong>23.6% Retracement:</strong> SHALLOW pullback</li>
                <li><strong>38.2% Retracement:</strong> MODERATE pullback</li>
                <li><strong>50.0% Retracement:</strong> PSYCHOLOGICAL level</li>
                <li><strong>61.8% Retracement (Golden Ratio):</strong> MOST IMPORTANT</li>
                <li><strong>78.6% Retracement:</strong> VERY DEEP pullback</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> The 61.8% level is the MOST RELIABLE Fibonacci retracement. Combine with other indicators for best results.
            </div>
            
            <div class='warning-box'>
                <strong>Warning:</strong> Fibonacci is a SELF-FULFILLING PROPHECY. Levels are ZONES, not exact prices (allow ±1% tolerance).
            </div>
        </div>
    </div>
</div>

<!-- Modal: Pivot Points -->
<div id='modalPivots' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Pivot Points</h2>
            <span class='close-modal' onclick='closeModal("modalPivots")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What are Pivot Points?</h3>
            <p><span class='key-term'>Pivot Points</span> are technical indicators used to determine potential support and resistance levels.</p>
            
            <h3>Standard Pivot Points</h3>
            <div class='formula-box'>
                <strong>Pivot Point (P):</strong><br>
                P = (High + Low + Close) / 3<br><br>
                
                <strong>Resistance Levels:</strong><br>
                R1 = (2 × P) - Low<br>
                R2 = P + (High - Low)<br>
                R3 = High + 2 × (P - Low)<br><br>
                
                <strong>Support Levels:</strong><br>
                S1 = (2 × P) - High<br>
                S2 = P - (High - Low)<br>
                S3 = Low - 2 × (High - P)
            </div>
            
            <h3>How to Interpret</h3>
            <ul>
                <li><strong>Price above P:</strong> Bullish sentiment</li>
                <li><strong>Price below P:</strong> Bearish sentiment</li>
                <li><strong>R1, R2, R3:</strong> Resistance levels</li>
                <li><strong>S1, S2, S3:</strong> Support levels</li>
            </ul>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> Pivot Points are MOST effective in ranging markets. Combine with Volume Profile's POC for ultimate confluence.
            </div>
            
            <div class='warning-box'>
                <strong>Warning:</strong> On high-impact news days, pivots become less reliable. Always check economic calendar!
            </div>
        </div>
    </div>
</div>

<!-- Modal: Support/Resistance -->
<div id='modalSupportResistance' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Automatic Support & Resistance Detection</h2>
            <span class='close-modal' onclick='closeModal("modalSupportResistance")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What is Support & Resistance?</h3>
            <p><span class='key-term'>Support and Resistance</span> are price levels where buying/selling pressure is historically concentrated.</p>
            
            <h3>Support (Floor)</h3>
            <ul>
                <li><strong>Definition:</strong> Price level where demand prevents further decline</li>
                <li><strong>Behavior:</strong> Price bounces up from support</li>
                <li><strong>Break Below:</strong> Becomes resistance (role reversal)</li>
            </ul>
            
            <h3>Resistance (Ceiling)</h3>
            <ul>
                <li><strong>Definition:</strong> Price level where selling pressure prevents further rise</li>
                <li><strong>Behavior:</strong> Price bounces down from resistance</li>
                <li><strong>Break Above:</strong> Becomes support (role reversal)</li>
            </ul>
            
            <h3>How to Trade S/R</h3>
            <ul>
                <li><strong>Buy at Support:</strong> In uptrend</li>
                <li><strong>Sell at Resistance:</strong> In downtrend</li>
                <li><strong>Breakout Trading:</strong> Buy when price breaks above resistance</li>
                <li><strong>Role Reversal:</strong> Old resistance becomes new support</li>
            </ul>
            
            <div class='warning-box'>
                <strong>Warning:</strong> S/R levels are ZONES, not exact prices. Allow 0.5-1% flexibility.
            </div>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> The best trades happen at the CONFLUENCE of multiple S/R levels.
            </div>
        </div>
    </div>
</div>

<!-- Modal: Candlestick Patterns -->
<div id='modalCandlestickPatterns' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Candlestick Pattern Recognition</h2>
            <span class='close-modal' onclick='closeModal("modalCandlestickPatterns")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What are Candlestick Patterns?</h3>
            <p><span class='key-term'>Candlestick Patterns</span> are formations that indicate potential reversals or continuations.</p>
            
            <h3>Bullish Reversal Patterns</h3>
            <ul>
                <li><strong>Hammer:</strong> Small body at top, long lower shadow</li>
                <li><strong>Bullish Engulfing:</strong> Large green candle engulfs small red candle</li>
                <li><strong>Morning Star:</strong> 3-candle pattern - very strong reversal</li>
                <li><strong>Piercing Line:</strong> Green candle closes above 50% of red body</li>
            </ul>
            
            <h3>Bearish Reversal Patterns</h3>
            <ul>
                <li><strong>Hanging Man:</strong> Hammer at top of uptrend</li>
                <li><strong>Shooting Star:</strong> Small body at bottom, long upper shadow</li>
                <li><strong>Bearish Engulfing:</strong> Large red candle engulfs small green candle</li>
                <li><strong>Evening Star:</strong> Opposite of Morning Star</li>
            </ul>
            
            <div class='warning-box'>
                <strong>Warning:</strong> NEVER trade candlestick patterns in isolation. Always combine with trend analysis, support/resistance, and volume.
            </div>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> The most reliable patterns are Morning Star, Evening Star, and Engulfing patterns.
            </div>
        </div>
    </div>
</div>

<!-- Modal: Divergences -->
<div id='modalDivergences' class='modal'>
    <div class='modal-content'>
        <div class='modal-header'>
            <h2>Divergence Detection</h2>
            <span class='close-modal' onclick='closeModal("modalDivergences")'>&times;</span>
        </div>
        <div class='modal-body'>
            <h3>What are Divergences?</h3>
            <p><span class='key-term'>Divergences</span> occur when price and an indicator move in opposite directions. They are among the MOST POWERFUL reversal signals.</p>
            
            <h3>Regular Bullish Divergence</h3>
            <div class='formula-box'>
                <strong>Pattern:</strong><br>
                - Price: Lower Low (LL)<br>
                - Indicator: Higher Low (HL)<br><br>
                
                <strong>Meaning:</strong> Downtrend losing steam → POTENTIAL REVERSAL UP<br><br>
                
                <strong>Action:</strong> Look for BUY opportunities
            </div>
            
            <h3>Regular Bearish Divergence</h3>
            <div class='formula-box'>
                <strong>Pattern:</strong><br>
                - Price: Higher High (HH)<br>
                - Indicator: Lower High (LH)<br><br>
                
                <strong>Meaning:</strong> Uptrend losing steam → POTENTIAL REVERSAL DOWN<br><br>
                
                <strong>Action:</strong> Look for SELL opportunities
            </div>
            
            <h3>Best Indicators for Divergences</h3>
            <ul>
                <li><strong>RSI:</strong> Most reliable, clear swings</li>
                <li><strong>MACD Histogram:</strong> Very visual</li>
                <li><strong>Stochastic:</strong> Good for short-term</li>
                <li><strong>OBV:</strong> Volume-based divergences</li>
            </ul>
            
            <div class='warning-box'>
                <strong>Critical Rule:</strong> Divergences predict potential reversals but don't guarantee them. ALWAYS wait for confirmation!
            </div>
            
            <div class='tip-box'>
                <strong>Pro Tip:</strong> The STRONGEST divergences occur at key S/R levels, on multiple indicators, and on higher timeframes.
            </div>
        </div>
    </div>
</div>

<!-- ============================================
     SCRIPTS - ORDRE CRITIQUE
     ============================================ -->

<!-- Theme & Core Scripts -->
<script src="assets/js/favicon-dynamic.js"></script>
<script src="assets/js/theme.js"></script>
<script src="assets/js/theme-charts.js"></script>

<!-- Configuration & API -->
<script src="assets/js/config.js"></script>
<script src="assets/js/api-client.js"></script>

<!-- UI Components -->
<script src="assets/js/dark-mode.js"></script>
<script src="assets/js/common.js"></script>
<script src="assets/js/sidebar.js"></script>
<script src="assets/js/chatbot-particles.js"></script>

<!-- ✅ PORTFOLIO & WATCHLIST (ORDRE CRITIQUE) -->
<!-- 1. Portfolio Manager DOIT être chargé EN PREMIER -->
<script src='assets/js/portfolio-manager.js'></script>

<!-- 2. Watchlist Manager APRÈS (dépend de Portfolio Manager) -->
<script src='assets/js/watchlist-manager.js'></script>

<!-- ❌ NE PAS CHARGER portfolio-watchlist-alerts.js (conflit) -->
<!-- <script src='assets/js/portfolio-watchlist-alerts.js'></script> -->

<!-- Advanced Analysis (dépend de Portfolio Manager) -->
<script src='assets/js/advanced-analysis.js'></script>

<!-- Chatbot Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src='assets/js/chatbot-config.js'></script>
<script src='assets/js/chatbot-gemini.js'></script>
<script src='assets/js/chatbot-analytics.js'></script>
<script src='assets/js/chatbot-charts.js'></script>
<script src='assets/js/chatbot-ipo-analyzer.js'></script>
<script src='assets/js/chatbot-suggestions.js'></script>
<script src='assets/js/chatbot-ai-engine.js'></script>
<script src='assets/js/chatbot-ui.js'></script>


<!-- ============================================
     MODAL MANAGEMENT
     ============================================ -->
<script>
// Modal Functions
function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        console.log('✅ Modal opened:', modalId);
    } else {
        console.error('❌ Modal not found:', modalId);
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = 'auto';
        console.log('✅ Modal closed:', modalId);
    }
}

// Close on outside click
window.addEventListener('click', (event) => {
    if (event.target.classList.contains('modal')) {
        event.target.classList.remove('active');
        document.body.style.overflow = 'auto';
    }
});

// Close with Escape key
document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
        document.querySelectorAll('.modal.active').forEach(modal => {
            modal.classList.remove('active');
        });
        document.body.style.overflow = 'auto';
    }
});

// Helper Functions
function openPortfolioHelp() {
    const helpText = `
PORTFOLIO MANAGEMENT HELP

Features:
• Create multiple portfolios to organize your stocks
• Each portfolio can track different strategies
• Switch between portfolios using the dropdown
• All data is automatically saved to Firebase in real-time

How to Use:
1. Click "New Portfolio" to create a portfolio
2. Give it a meaningful name
3. Select it from the dropdown to make it active
4. Add stocks to your watchlist - they'll be saved to this portfolio

Data Sync:
• All portfolios sync across devices
• Automatic backup to Firebase
• Never lose your tracking data

Management:
• Click "Manage" to rename or delete portfolios
• You can have unlimited portfolios
• Default portfolio is created automatically
    `;
    alert(helpText);
}

function openWatchlistHelp() {
    const helpText = `
WATCHLIST HELP

Features:
• Track multiple stocks in real-time
• See live price changes and percentage moves
• Filter by gainers/losers
• One-click analysis of any stock

How to Use:
1. Type a stock symbol (e.g., AAPL) in the search box
2. Click "Add" or press Enter
3. Stock appears in your watchlist with live data
4. Click on a stock card to analyze it with all 40+ indicators
5. Remove stocks by clicking the trash icon

Features:
• Real-time price updates
• Color-coded gains (green) and losses (red)
• Quick filters: All / Gainers / Losers
• Automatic sync to Firebase
• Portfolio-specific (each portfolio has its own watchlist)

Pro Tips:
• Add stocks BEFORE market opens to track opening moves
• Use "Gainers" filter to spot momentum stocks
• Watchlist persists across sessions
• Maximum 50 stocks per watchlist (performance)
    `;
    alert(helpText);
}

function openAlertsHelp() {
    const helpText = `
PRICE ALERTS HELP

Note: Price alerts are coming soon!

Features:
• Get notified when stocks reach your target prices
• Set "above" or "below" conditions
• Toggle alerts on/off without deleting
• Alerts check automatically every 60 seconds

This feature will be available in a future update.
    `;
    alert(helpText);
}
</script>

<!-- ============================================
     USER MENU INITIALIZATION
     ============================================ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('🔧 Initializing user menu...');
    
    const trigger = document.getElementById('sidebarUserTrigger');
    const dropdown = document.getElementById('sidebarUserDropdown');
    
    if (trigger && dropdown) {
        console.log('✅ User menu elements found');
        
        // Supprimer les anciens event listeners en clonant
        const newTrigger = trigger.cloneNode(true);
        trigger.parentNode.replaceChild(newTrigger, trigger);
        
        const freshTrigger = document.getElementById('sidebarUserTrigger');
        const freshDropdown = document.getElementById('sidebarUserDropdown');
        
        freshTrigger.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('👆 User menu clicked');
            freshDropdown.classList.toggle('active');
            
            const arrow = freshTrigger.querySelector('.sidebar-user-arrow');
            if (arrow) {
                const isActive = freshDropdown.classList.contains('active');
                arrow.style.transform = isActive ? 'rotate(180deg)' : 'rotate(0deg)';
                arrow.style.transition = 'transform 0.3s ease';
            }
        });
        
        document.addEventListener('click', function(e) {
            if (!freshTrigger.contains(e.target) && !freshDropdown.contains(e.target)) {
                freshDropdown.classList.remove('active');
                const arrow = freshTrigger.querySelector('.sidebar-user-arrow');
                if (arrow) {
                    arrow.style.transform = 'rotate(0deg)';
                }
            }
        });
        
        freshDropdown.addEventListener('click', function(e) {
            e.stopPropagation();
        });
        
        console.log('✅ User menu initialized');
    } else {
        console.error('❌ User menu elements not found');
    }
});
</script>

<!-- ============================================
     LOGOUT FUNCTION
     ============================================ -->
<script>
function logout() {
    if (confirm('Are you sure you want to disconnect?')) {
        console.log('🔓 Logout requested...');
        if (typeof firebase !== 'undefined' && firebase.auth) {
            firebase.auth().signOut().then(() => {
                console.log('✅ Logout successful');
                window.location.href = 'login.html';
            }).catch((error) => {
                console.error('❌ Logout error:', error);
                alert('Error during logout. Please try again.');
            });
        } else {
            console.log('⚠ Firebase not available, redirecting...');
            window.location.href = 'login.html';
        }
    }
}
</script>

<!-- ============================================
     PORTFOLIO & WATCHLIST VERIFICATION
     ============================================ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('🔍 Verifying Portfolio & Watchlist Manager...');
    
    // Vérifier que PortfolioManager est chargé
    if (typeof PortfolioManager !== 'undefined') {
        console.log('✅ PortfolioManager is loaded');
        console.log('📋 Available methods:', Object.keys(PortfolioManager).join(', '));
    } else {
        console.error('❌ PortfolioManager NOT loaded!');
        console.error('📁 Verify that assets/js/portfolio-manager.js exists');
    }
    
    // Vérifier que WatchlistManager est chargé
    if (typeof WatchlistManager !== 'undefined') {
        console.log('✅ WatchlistManager is loaded');
        console.log('📋 Available methods:', Object.keys(WatchlistManager).join(', '));
    } else {
        console.error('❌ WatchlistManager NOT loaded!');
        console.error('📁 Verify that assets/js/watchlist-manager.js exists');
    }
    
    // Vérifier Firebase Auth
    if (typeof firebase !== 'undefined' && firebase.auth) {
        const checkAuth = setInterval(() => {
            const user = firebase.auth().currentUser;
            if (user) {
                console.log('✅ Firebase user authenticated:', user.email);
                clearInterval(checkAuth);
                
                // Les managers s'initialisent automatiquement
                // Portfolio Manager s'initialise dans son IIFE
                // Watchlist Manager attend que Portfolio Manager soit prêt
            }
        }, 500);
        
        // Timeout après 10 secondes
        setTimeout(() => {
            clearInterval(checkAuth);
            if (!firebase.auth().currentUser) {
                console.warn('⚠ Firebase authentication timeout');
            }
        }, 10000);
    } else {
        console.warn('⚠ Firebase not available');
    }
});
</script>

<!-- ============================================
     CHATBOT INITIALIZATION
     ============================================ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        const accessDenied = sessionStorage.getItem('accessDenied') === 'true';
        if (accessDenied) {
            console.log('⚠ Access denied - chatbot skipped');
            return;
        }
        
        if (typeof ChatbotConfig === 'undefined' || typeof ChatbotUI === 'undefined') {
            console.log('⏳ Chatbot dependencies not ready...');
            return;
        }
        
        try {
            window.financialChatbot = new ChatbotUI(ChatbotConfig);
            console.log('🎉 Chatbot initialized successfully');
        } catch (error) {
            console.error('❌ Chatbot initialization error:', error);
        }
    }, 500);
});
</script>

<!-- ============================================
     PORTFOLIO DROPDOWN AUTO-POPULATION
     ============================================ -->
<script>
/**
 * Peupler automatiquement le dropdown des portfolios
 * après l'initialisation de PortfolioManager
 */
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(async () => {
        if (typeof PortfolioManager === 'undefined') {
            console.warn('⚠ PortfolioManager not loaded for dropdown population');
            return;
        }
        
        try {
            // Attendre que Firebase soit prêt
            let attempts = 0;
            const waitForFirebase = setInterval(async () => {
                if (PortfolioManager.isFirebaseReady && PortfolioManager.isFirebaseReady()) {
                    clearInterval(waitForFirebase);
                    
                    console.log('🔄 Populating portfolios dropdown...');
                    
                    // Récupérer la liste des portfolios
                    const portfolios = await PortfolioManager.listPortfolios();
                    const dropdown = document.getElementById('portfolioSelect');
                    
                    if (dropdown && portfolios && portfolios.length > 0) {
                        dropdown.innerHTML = '';
                        
                        portfolios.forEach(portfolio => {
                            const option = document.createElement('option');
                            option.value = portfolio.name;
                            option.textContent = portfolio.name;
                            dropdown.appendChild(option);
                        });
                        
                        // Sélectionner le portfolio actif
                        const currentPortfolio = PortfolioManager.getCurrentPortfolio();
                        if (currentPortfolio) {
                            dropdown.value = currentPortfolio;
                        }
                        
                        console.log('✅ Portfolios dropdown populated with', portfolios.length, 'portfolios');
                        
                        // Event listener pour changer de portfolio
                        dropdown.addEventListener('change', async (e) => {
                            const newPortfolio = e.target.value;
                            if (newPortfolio) {
                                console.log('🔄 Switching to portfolio:', newPortfolio);
                                await PortfolioManager.switchPortfolio(newPortfolio);
                            }
                        });
                    }
                }
                
                attempts++;
                if (attempts > 30) { // 3 secondes max
                    clearInterval(waitForFirebase);
                    console.warn('⚠ Timeout waiting for Firebase, using local portfolios');
                }
            }, 100);
            
        } catch (error) {
            console.error('❌ Error populating portfolios dropdown:', error);
        }
    }, 1500); // Attendre 1.5s après le chargement de la page
});
</script>

<!-- ============================================
     STYLES ADDITIONNELS
     ============================================ -->
<style>
/* Watchlist Cards */
.watchlist-card {
    background: var(--card-background);
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 0.75rem;
    border: 2px solid var(--border-color);
    transition: all 0.3s ease;
    cursor: pointer;
}

.watchlist-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    border-color: #667eea;
}

.watchlist-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.watchlist-symbol {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-primary);
}

.watchlist-remove {
    background: transparent;
    border: none;
    color: #dc3545;
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    transition: all 0.3s;
}

.watchlist-remove:hover {
    background: rgba(220, 53, 69, 0.1);
    transform: scale(1.1);
}

.watchlist-price {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
}

.watchlist-change {
    font-size: 0.95rem;
    font-weight: 600;
}

.watchlist-change.positive {
    color: #10b981;
}

.watchlist-change.negative {
    color: #dc3545;
}

.watchlist-loading {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-style: italic;
}

.watchlist-empty {
    text-align: center;
    padding: 3rem 1.5rem;
    color: var(--text-secondary);
}

.watchlist-empty i {
    font-size: 3rem;
    opacity: 0.3;
    margin-bottom: 1rem;
    display: block;
}

.watchlist-empty p {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.watchlist-empty small {
    opacity: 0.7;
}

/* Portfolio Dropdown */
.portfolio-dropdown {
    padding: 0.75rem 1rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    background: var(--card-background);
    color: var(--text-primary);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    min-width: 200px;
}

.portfolio-dropdown:hover {
    border-color: #667eea;
}

.portfolio-dropdown:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

body.dark-mode .portfolio-dropdown {
    background: #1e293b;
    border-color: #334155;
    color: #e2e8f0;
}

body.dark-mode .portfolio-dropdown:hover,
body.dark-mode .portfolio-dropdown:focus {
    border-color: #818cf8;
}

/* Portfolio Actions Buttons */
.btn-portfolio-action {
    padding: 0.75rem 1.25rem;
    border-radius: 8px;
    border: none;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-portfolio-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.btn-portfolio-action:active {
    transform: translateY(0);
}

/* Watchlist Filters */
.filter-btn {
    padding: 0.5rem 1rem;
    border-radius: 6px;
    border: 2px solid var(--border-color);
    background: transparent;
    color: var(--text-primary);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    margin-right: 0.5rem;
}

.filter-btn:hover {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.1);
}

.filter-btn.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: transparent;
}

/* Watchlist Search */
.btn-add-watchlist {
    padding: 0.75rem 1.25rem;
    border-radius: 8px;
    border: none;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-add-watchlist:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

/* Responsive */
@media (max-width: 768px) {
    .watchlist-card {
        padding: 0.75rem;
    }
    
    .watchlist-symbol {
        font-size: 1rem;
    }
    
    .watchlist-price {
        font-size: 1.1rem;
    }
}
</style>

</body>
</html>