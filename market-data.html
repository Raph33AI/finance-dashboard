<!DOCTYPE html>
<html lang='fr'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <meta name='description' content='Market Data Dashboard - Real-time stock analysis, technical indicators, watchlist and price alerts'>
    <meta name='author' content='Raphael NARDONE'>
    <meta name='theme-color' content='#2563eb'>
    
    <title>Market Data - Raphael NARDONE | Finance Dashboard</title>
    
    <!-- Preconnect pour optimisation -->
    <link rel='preconnect' href='https://code.highcharts.com'>
    <link rel='preconnect' href='https://cdnjs.cloudflare.com'>
    
    <!-- Highcharts - ORDRE IMPORTANT -->
    <script src='https://code.highcharts.com/stock/highstock.js' defer></script>
    <script src='https://code.highcharts.com/stock/indicators/indicators-all.js' defer></script>
    <script src='https://code.highcharts.com/stock/modules/drag-panes.js' defer></script>
    <script src='https://code.highcharts.com/modules/annotations-advanced.js' defer></script>
    <script src='https://code.highcharts.com/modules/price-indicator.js' defer></script>
    <script src='https://code.highcharts.com/modules/full-screen.js' defer></script>
    <script src='https://code.highcharts.com/modules/stock-tools.js' defer></script>
    <script src='https://code.highcharts.com/modules/exporting.js' defer></script>
    <script src='https://code.highcharts.com/modules/export-data.js' defer></script>
    <script src='https://code.highcharts.com/modules/accessibility.js' defer></script>
    
    <!-- Font Awesome -->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css' integrity='sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==' crossorigin='anonymous' referrerpolicy='no-referrer'>
    
    <!-- Styles -->
    <link rel='stylesheet' href='assets/css/common.css'>
    <link rel='stylesheet' href='assets/css/sidebar.css'>
    <link rel='stylesheet' href='assets/css/market-data.css'>
    <link rel='stylesheet' href='assets/css/cache-widget.css'>
</head>
<body>
    <div class='layout-wrapper'>
        
        <!-- ============================================
             SIDEBAR NAVIGATION
             ============================================ -->
        <aside class='sidebar' id='sidebar' role='navigation' aria-label='Main navigation'>
            <div class='sidebar-header'>
                <h2>
                    <i class='fas fa-chart-line' aria-hidden='true'></i>
                    <span>Finance Hub</span>
                </h2>
                <button class='sidebar-toggle' id='sidebarToggle' aria-label='Toggle sidebar' aria-expanded='false'>
                    <i class='fas fa-bars' aria-hidden='true'></i>
                </button>
            </div>
            
            <nav class='sidebar-nav'>
                <!-- Budget Section -->
                <div class='nav-section'>
                    <button class='nav-folder' aria-expanded='false' aria-controls='budget-submenu'>
                        <i class='fas fa-wallet' aria-hidden='true'></i>
                        <span>Budget</span>
                        <i class='fas fa-chevron-down arrow' aria-hidden='true'></i>
                    </button>
                    <div class='nav-submenu' id='budget-submenu'>
                        <a href='index.html' class='nav-link'>
                            <i class='fas fa-home' aria-hidden='true'></i>
                            <span>Dashboard Budget</span>
                        </a>
                    </div>
                </div>
                
                <!-- Simulation Section -->
                <div class='nav-section'>
                    <button class='nav-folder' aria-expanded='false' aria-controls='simulation-submenu'>
                        <i class='fas fa-calculator' aria-hidden='true'></i>
                        <span>Simulation</span>
                        <i class='fas fa-chevron-down arrow' aria-hidden='true'></i>
                    </button>
                    <div class='nav-submenu' id='simulation-submenu'>
                        <a href='monte-carlo.html' class='nav-link'>
                            <i class='fas fa-dice' aria-hidden='true'></i>
                            <span>Monte Carlo</span>
                        </a>
                        <a href='portfolio-optimizer.html' class='nav-link'>
                            <i class='fas fa-chart-pie' aria-hidden='true'></i>
                            <span>Markowitz</span>
                        </a>
                        <a href='risk-parity.html' class='nav-link'>
                            <i class='fas fa-balance-scale' aria-hidden='true'></i>
                            <span>Risk Parity</span>
                        </a>
                        <a href='scenario-analysis.html' class='nav-link'>
                            <i class='fas fa-flask' aria-hidden='true'></i>
                            <span>Sc√©narios</span>
                        </a>
                    </div>
                </div>
                
                <!-- Stocks Section -->
                <div class='nav-section active'>
                    <button class='nav-folder active' aria-expanded='true' aria-controls='stocks-submenu'>
                        <i class='fas fa-chart-line' aria-hidden='true'></i>
                        <span>Stocks</span>
                        <i class='fas fa-chevron-down arrow' aria-hidden='true'></i>
                    </button>
                    <div class='nav-submenu' id='stocks-submenu'>
                        <a href='market-data.html' class='nav-link active' aria-current='page'>
                            <i class='fas fa-globe' aria-hidden='true'></i>
                            <span>Market Data</span>
                        </a>
                        <a href='advanced-analysis.html' class='nav-link'>
                            <i class='fas fa-chart-area' aria-hidden='true'></i>
                            <span>Advanced Analysis</span>
                        </a>
                        <a href='trend-prediction.html' class='nav-link'>
                            <i class='fas fa-brain' aria-hidden='true'></i>
                            <span>ML Predictions</span>
                        </a>
                    </div>
                </div>
            </nav>
            
            <div class='sidebar-footer'>
                <div class='user-info'>
                    <i class='fas fa-user-circle' aria-hidden='true'></i>
                    <span>Raphael NARDONE</span>
                </div>
            </div>
        </aside>
        
        <!-- Sidebar Overlay (mobile) -->
        <div class='sidebar-overlay' id='sidebarOverlay' aria-hidden='true'></div>
        
        <!-- ============================================
             MAIN CONTENT AREA
             ============================================ -->
        <main class='main-content' role='main'>
            <!-- Top Header -->
            <header class='top-header'>
                <div class="header-content-wrapper">
                    <div class='header-left'>
                        <button class='mobile-toggle' id='mobileToggle' aria-label='Toggle navigation menu' aria-expanded='false'>
                            <i class='fas fa-bars' aria-hidden='true'></i>
                        </button>
                        <h1>Market Data</h1>
                    </div>
                    <div class='header-right'>
                        <!-- ‚úÖ NOUVEAU : Bouton Dark Mode -->
                        <button class='dark-mode-toggle' id='darkModeToggle' aria-label='Toggle dark mode' title='Toggle dark mode'>
                            <i class='fas fa-moon' aria-hidden='true'></i>
                        </button>
                        
                        <span class='last-update' aria-live='polite'>
                            <i class='fas fa-clock' aria-hidden='true'></i>
                            <span id='lastUpdate'>Loading...</span>
                        </span>
                    </div>
                </div>
            </header>
            
            <!-- Container -->
            <div class='container'>
                <!-- Main Content -->
                <div class='content'>
                    
                    <!-- Search Panel -->
                    <section class='search-panel card' aria-labelledby='search-title'>
                        <div class='card-header'>
                            <h2 class='card-title' id='search-title'>
                                <i class='fas fa-search' aria-hidden='true'></i> Search Stock for Market Data
                            </h2>
                            <button class='help-icon' onclick='openModal("modalSearchHelp")' aria-label='Help about searching stocks'>?</button>
                        </div>
                        
                        <div class='card-body'>
                            <div class='search-container'>
                                <!-- Search Input + Button -->
                                <div class='search-input-wrapper'>
                                    <label for='symbolInput' class='sr-only'>Stock symbol or company name</label>
                                    <input type='text' 
                                        id='symbolInput' 
                                        class='form-input'
                                        placeholder='Search by symbol or company name (e.g., AAPL, Apple, Tesla)...'
                                        autocomplete='off'
                                        value='AAPL'
                                        aria-describedby='search-instructions'>
                                    <button class='btn btn-primary btn-search' onclick='MarketData.searchStock()' aria-label='Analyze selected stock'>
                                        <i class='fas fa-chart-area' aria-hidden='true'></i> Analyze Stock
                                    </button>
                                    
                                    <!-- Suggestions dropdown -->
                                    <div class='search-suggestions' id='searchSuggestions' role='listbox' aria-label='Search suggestions'></div>
                                </div>
                                
                                <span id='search-instructions' class='sr-only'>Type to search for stocks. Use arrow keys to navigate suggestions, Enter to select.</span>
                                
                                <!-- Popular Stocks -->
                                <div class='popular-stocks'>
                                    <span class='quick-label'>Popular Stocks:</span>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("AAPL")' aria-label='Load Apple stock'>
                                        <i class='fab fa-apple' aria-hidden='true'></i> AAPL
                                    </button>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("MSFT")' aria-label='Load Microsoft stock'>
                                        <i class='fab fa-microsoft' aria-hidden='true'></i> MSFT
                                    </button>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("GOOGL")' aria-label='Load Google stock'>
                                        <i class='fab fa-google' aria-hidden='true'></i> GOOGL
                                    </button>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("TSLA")' aria-label='Load Tesla stock'>
                                        <i class='fas fa-car' aria-hidden='true'></i> TSLA
                                    </button>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("BTC-USD")' aria-label='Load Bitcoin price'>
                                        <i class='fab fa-bitcoin' aria-hidden='true'></i> BTC-USD
                                    </button>
                                    <button class='symbol-chip' onclick='MarketData.loadSymbol("^GSPC")' aria-label='Load S&P 500 index'>
                                        <i class='fas fa-chart-line' aria-hidden='true'></i> S&P 500
                                    </button>
                                </div>
                                
                                <!-- Period Selection -->
                                <div class='time-period-selector' role='group' aria-labelledby='period-label'>
                                    <label id='period-label'>Time Period:</label>
                                    <button class='period-btn active' data-period='1M' onclick='MarketData.changePeriod("1M")' aria-pressed='true'>1M</button>
                                    <button class='period-btn' data-period='3M' onclick='MarketData.changePeriod("3M")' aria-pressed='false'>3M</button>
                                    <button class='period-btn' data-period='6M' onclick='MarketData.changePeriod("6M")' aria-pressed='false'>6M</button>
                                    <button class='period-btn' data-period='1Y' onclick='MarketData.changePeriod("1Y")' aria-pressed='false'>1Y</button>
                                    <button class='period-btn' data-period='5Y' onclick='MarketData.changePeriod("5Y")' aria-pressed='false'>5Y</button>
                                    <button class='period-btn' data-period='MAX' onclick='MarketData.changePeriod("MAX")' aria-pressed='false'>MAX</button>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- ============================================
                         STOCK COMPARISON SECTION
                         ============================================ -->
                    <section class='comparison-section card' aria-labelledby='comparison-title'>
                        <div class='card-header comparison-header'>
                            <h2 class='card-title' id='comparison-title'>
                                <i class='fas fa-chart-bar' aria-hidden='true'></i> Stock Comparison
                            </h2>
                            <div class='comparison-actions'>
                                <button class='btn btn-primary btn-compare' onclick='MarketData.openComparisonModal()'>
                                    <i class='fas fa-plus' aria-hidden='true'></i> Add Stocks to Compare
                                </button>
                                <button class='btn btn-danger btn-clear-comparison' onclick='MarketData.clearComparison()'>
                                    <i class='fas fa-trash' aria-hidden='true'></i> Clear All
                                </button>
                            </div>
                        </div>
                        
                        <div class='card-body'>
                            <div id='comparisonContainer' class='comparison-container hidden'>
                                <!-- Selected stocks chips -->
                                <div class='comparison-stocks' id='comparisonStocks' role='list' aria-label='Stocks being compared'></div>
                                
                                <!-- Comparison Chart -->
                                <div class='comparison-chart-wrapper'>
                                    <h3 class='subsection-title'>Performance Comparison (Normalized to 100)</h3>
                                    <div id='comparisonChart' class='chart' role='img' aria-label='Stock performance comparison chart'></div>
                                </div>
                                
                                <!-- Comparison Table -->
                                <div class='comparison-table-wrapper'>
                                    <h3 class='subsection-title'>Key Metrics Comparison</h3>
                                    <div id='comparisonTable' class='comparison-table' role='region' aria-label='Comparison metrics table'></div>
                                </div>
                            </div>
                            
                            <div id='comparisonEmpty' class='comparison-empty'>
                                <i class='fas fa-chart-line' aria-hidden='true'></i>
                                <p>No stocks to compare</p>
                                <p class='hint'>Click "Add Stocks to Compare" to get started</p>
                            </div>
                        </div>
                    </section>
                    
                    <!-- ============================================
                         WATCHLIST SECTION
                         ============================================ -->
                    <section class='watchlist-section card' aria-labelledby='watchlist-title'>
                        <div class='card-header watchlist-header'>
                            <h2 class='card-title' id='watchlist-title'>
                                <i class='fas fa-star' aria-hidden='true'></i> My Watchlist
                            </h2>
                            <div class='watchlist-actions'>
                                <button class='btn btn-success btn-add-current' onclick='MarketData.addCurrentToWatchlist()' id='btnAddCurrent' disabled>
                                    <i class='fas fa-plus' aria-hidden='true'></i> Add Current Stock
                                </button>
                                <button class='btn btn-primary btn-refresh-watchlist' onclick='MarketData.refreshWatchlist()'>
                                    <i class='fas fa-sync-alt' aria-hidden='true'></i> Refresh All
                                </button>
                                <button class='btn btn-danger btn-clear-watchlist' onclick='MarketData.clearWatchlist()'>
                                    <i class='fas fa-trash' aria-hidden='true'></i> Clear All
                                </button>
                            </div>
                        </div>
                        
                        <div class='card-body'>
                            <div id='watchlistContainer' class='watchlist-container' role='list' aria-label='Watchlist stocks'>
                                <div class='watchlist-empty'>
                                    <i class='fas fa-star-half-alt' aria-hidden='true'></i>
                                    <p>Your watchlist is empty</p>
                                    <p class='hint'>Search for a stock and click "Add to Watchlist" to start tracking</p>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- ============================================
                         PRICE ALERTS SECTION
                         ============================================ -->
                    <section class='alerts-section card' aria-labelledby='alerts-title'>
                        <div class='card-header alerts-header'>
                            <h2 class='card-title' id='alerts-title'>
                                <i class='fas fa-bell' aria-hidden='true'></i> Price Alerts
                            </h2>
                            <button class='btn btn-accent btn-create-alert' onclick='MarketData.openAlertModal()'>
                                <i class='fas fa-plus' aria-hidden='true'></i> Create Alert
                            </button>
                        </div>
                        
                        <div class='card-body'>
                            <div id='alertsContainer' class='alerts-container' role='list' aria-label='Active price alerts'>
                                <div class='alerts-empty'>
                                    <i class='fas fa-bell-slash' aria-hidden='true'></i>
                                    <p>No active alerts</p>
                                    <p class='hint'>Create price alerts to get notified when a stock reaches your target</p>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Loading Indicator -->
                    <div id='loadingIndicator' class='loading-indicator hidden' role='status' aria-live='polite'>
                        <i class='fas fa-spinner fa-spin' aria-hidden='true'></i> Loading market data...
                    </div>
                    
                    <!-- Stock Overview -->
                    <section id='stockOverview' class='stock-overview hidden' aria-labelledby='stock-overview-title'>
                        <div class='overview-header'>
                            <div class='stock-title'>
                                <h2 id='stockName'>-</h2>
                                <span id='stockSymbol' class='stock-symbol'>-</span>
                            </div>
                            <div class='stock-price-section'>
                                <div id='currentPrice' class='current-price' aria-label='Current stock price'>-</div>
                                <div id='priceChange' class='price-change' aria-label='Price change'>-</div>
                            </div>
                        </div>
                        
                        <div class='overview-stats' role='list' aria-label='Stock statistics'>
                            <div class='stat-item' role='listitem'>
                                <span class='stat-label'>Open</span>
                                <span id='statOpen' class='stat-value'>-</span>
                            </div>
                            <div class='stat-item' role='listitem'>
                                <span class='stat-label'>High</span>
                                <span id='statHigh' class='stat-value'>-</span>
                            </div>
                            <div class='stat-item' role='listitem'>
                                <span class='stat-label'>Low</span>
                                <span id='statLow' class='stat-value'>-</span>
                            </div>
                            <div class='stat-item' role='listitem'>
                                <span class='stat-label'>Volume</span>
                                <span id='statVolume' class='stat-value'>-</span>
                            </div>
                            <div class='stat-item' role='listitem'>
                                <span class='stat-label'>Mkt Cap</span>
                                <span id='statMarketCap' class='stat-value'>-</span>
                            </div>
                            <div class='stat-item' role='listitem'>
                                <span class='stat-label'>P/E Ratio</span>
                                <span id='statPE' class='stat-value'>-</span>
                            </div>
                        </div>
                    </section>

                    <!-- Company Profile & Statistics -->
                    <section id='companyProfileSection' class='company-profile-section card hidden' aria-labelledby='company-profile-title'>
                        <!-- Le contenu sera g√©n√©r√© dynamiquement par JavaScript -->
                    </section>
                    
                    <!-- Results Panel -->
                    <section id='resultsPanel' class='results-panel card hidden' aria-labelledby='results-title'>
                        <div class='card-body'>
                            
                            <!-- Price Chart -->
                            <div class='chart-section'>
                                <h3 class='subsection-title' id='price-chart-title'>
                                    <i class='fas fa-chart-line' aria-hidden='true'></i> Price Chart with Technical Indicators
                                    <button class='help-icon' onclick='openModal("modalChartHelp")' aria-label='Help about price chart'>?</button>
                                </h3>
                                <div class='indicator-toggles' role='group' aria-label='Technical indicator toggles'>
                                    <label><input type='checkbox' id='toggleSMA' checked> SMA (20, 50)</label>
                                    <label><input type='checkbox' id='toggleEMA'> EMA (12, 26)</label>
                                    <label><input type='checkbox' id='toggleBB' checked> Bollinger Bands</label>
                                    <label><input type='checkbox' id='toggleVolume' checked> Volume</label>
                                </div>
                                <div id='priceChart' class='chart' role='img' aria-labelledby='price-chart-title'></div>
                            </div>
                            
                            <!-- Technical Indicators -->
                            <div class='charts-grid-2'>
                                <div class='chart-section'>
                                    <h3 class='subsection-title' id='rsi-title'>
                                        <i class='fas fa-wave-square' aria-hidden='true'></i> RSI (Relative Strength Index)
                                        <button class='help-icon' onclick='openModal("modalRSI")' aria-label='Help about RSI'>?</button>
                                    </h3>
                                    <div id='rsiChart' class='chart chart-medium' role='img' aria-labelledby='rsi-title'></div>
                                </div>
                                
                                <div class='chart-section'>
                                    <h3 class='subsection-title' id='macd-title'>
                                        <i class='fas fa-chart-bar' aria-hidden='true'></i> MACD (Moving Average Convergence Divergence)
                                        <button class='help-icon' onclick='openModal("modalMACD")' aria-label='Help about MACD'>?</button>
                                    </h3>
                                    <div id='macdChart' class='chart chart-medium' role='img' aria-labelledby='macd-title'></div>
                                </div>
                            </div>
                            
                            <!-- Trading Signals -->
                            <div class='signals-section'>
                                <h3 class='subsection-title' id='signals-title'>
                                    <i class='fas fa-signal' aria-hidden='true'></i> Trading Signals
                                    <button class='help-icon' onclick='openModal("modalSignals")' aria-label='Help about trading signals'>?</button>
                                </h3>
                                <div id='tradingSignals' class='signals-grid' role='list' aria-labelledby='signals-title'></div>
                            </div>
                            
                            <!-- Key Statistics -->
                            <div class='stats-section'>
                                <h3 class='subsection-title'><i class='fas fa-table' aria-hidden='true'></i> Key Statistics</h3>
                                <div id='keyStats' class='stats-grid' role='list' aria-label='Key stock statistics'></div>
                            </div>
                            
                        </div>
                    </section>
                </div>
                
                <!-- Footer -->
                <footer role='contentinfo'>
                    <p>&copy; 2024 Market Data Dashboard | Real-time financial data and technical analysis</p>
                    <p class='data-source'>Data provided by Twelve Data</p>
                </footer>
            </div>
        </main>
        
    </div>
    
    <!-- ============================================
         MODALS
         ============================================ -->
         
    <!-- Search Help Modal -->
    <div id='modalSearchHelp' class='modal' role='dialog' aria-labelledby='search-help-title' aria-modal='true'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2 id='search-help-title'>üîç How to Search Stocks</h2>
                <button class='close-modal' onclick='closeModal("modalSearchHelp")' aria-label='Close dialog'>
                    <i class='fas fa-times' aria-hidden='true'></i>
                </button>
            </div>
            <div class='modal-body'>
                <h3>üìä Symbol Format</h3>
                <p>Enter the <strong>stock ticker symbol</strong> to retrieve market data:</p>
                <ul>
                    <li><strong>US Stocks:</strong> AAPL, MSFT, GOOGL, TSLA</li>
                    <li><strong>Indices:</strong> ^GSPC (S&P 500), ^DJI (Dow Jones), ^IXIC (NASDAQ)</li>
                    <li><strong>Crypto:</strong> BTC-USD, ETH-USD</li>
                    <li><strong>European Stocks:</strong> AIR.PA (Airbus), MC.PA (LVMH)</li>
                </ul>
                
                <h3>üìà Available Data</h3>
                <ul>
                    <li>Real-time price and change</li>
                    <li>Historical price charts</li>
                    <li>Technical indicators (RSI, MACD, Bollinger Bands)</li>
                    <li>Trading volume</li>
                    <li>Key statistics (P/E ratio, market cap, etc.)</li>
                </ul>
                
                <div class='info-box'>
                    üí° <strong>Pro Tip:</strong> Use the time period buttons to analyze different timeframes and spot trends!
                </div>
            </div>
        </div>
    </div>
    
    <!-- Comparison Modal -->
    <div id='modalAddComparison' class='modal' role='dialog' aria-labelledby='add-comparison-title' aria-modal='true'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2 id='add-comparison-title'>üìä Add Stocks to Compare</h2>
                <button class='close-modal' onclick='MarketData.closeComparisonModal()' aria-label='Close dialog'>
                    <i class='fas fa-times' aria-hidden='true'></i>
                </button>
            </div>
            <div class='modal-body'>
                <form class='comparison-form' onsubmit='event.preventDefault(); MarketData.loadComparison();'>
                    <div class='form-group'>
                        <label class='form-label' for='comparisonSymbols'>Stock Symbols (separated by commas)</label>
                        <input type='text' 
                               id='comparisonSymbols' 
                               class='form-input'
                               placeholder='e.g., AAPL, MSFT, GOOGL, TSLA'
                               style='text-transform: uppercase;'
                               required
                               aria-describedby='comparison-hint'>
                        <p id='comparison-hint' class='text-muted' style='font-size: 0.875rem; margin-top: 0.5rem;'>Enter 2-5 stock symbols to compare</p>
                    </div>
                    
                    <div class='comparison-quick-presets'>
                        <label class='form-label'>Quick Presets:</label>
                        <button type='button' class='preset-btn' onclick='document.getElementById("comparisonSymbols").value = "AAPL, MSFT, GOOGL, AMZN"'>
                            <i class='fas fa-laptop' aria-hidden='true'></i> Big Tech
                        </button>
                        <button type='button' class='preset-btn' onclick='document.getElementById("comparisonSymbols").value = "TSLA, F, GM, TM"'>
                            <i class='fas fa-car' aria-hidden='true'></i> Auto Industry
                        </button>
                        <button type='button' class='preset-btn' onclick='document.getElementById("comparisonSymbols").value = "JPM, BAC, WFC, C"'>
                            <i class='fas fa-university' aria-hidden='true'></i> Banks
                        </button>
                        <button type='button' class='preset-btn' onclick='document.getElementById("comparisonSymbols").value = "^GSPC, ^DJI, ^IXIC"'>
                            <i class='fas fa-chart-line' aria-hidden='true'></i> Market Indices
                        </button>
                    </div>
                </form>
            </div>
            <div class='modal-footer'>
                <button type='button' class='btn btn-success' onclick='MarketData.loadComparison()'>
                    <i class='fas fa-chart-line' aria-hidden='true'></i> Compare Stocks
                </button>
                <button type='button' class='btn btn-secondary' onclick='MarketData.closeComparisonModal()'>
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Create Alert Modal -->
    <div id='modalCreateAlert' class='modal' role='dialog' aria-labelledby='create-alert-title' aria-modal='true'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2 id='create-alert-title'>üîî Create Price Alert</h2>
                <button class='close-modal' onclick='MarketData.closeAlertModal()' aria-label='Close dialog'>
                    <i class='fas fa-times' aria-hidden='true'></i>
                </button>
            </div>
            <div class='modal-body'>
                <form class='alert-form' onsubmit='event.preventDefault(); MarketData.createAlert();'>
                    <div class='form-group'>
                        <label class='form-label' for='alertSymbol'>Stock Symbol</label>
                        <input type='text' 
                               id='alertSymbol' 
                               class='form-input' 
                               placeholder='e.g., AAPL' 
                               style='text-transform: uppercase;'
                               required>
                    </div>
                    
                    <div class='form-group'>
                        <label class='form-label' for='alertPrice'>Target Price</label>
                        <input type='number' 
                               id='alertPrice' 
                               class='form-input' 
                               placeholder='e.g., 150.00' 
                               step='0.01'
                               min='0'
                               required>
                    </div>
                    
                    <div class='form-group'>
                        <label class='form-label' for='alertType'>Alert Condition</label>
                        <select id='alertType' class='form-select' required>
                            <option value='above'>Price goes ABOVE target</option>
                            <option value='below'>Price goes BELOW target</option>
                        </select>
                    </div>
                    
                    <div class='form-group'>
                        <label class='form-label' for='alertNote'>Note (Optional)</label>
                        <input type='text' 
                               id='alertNote' 
                               class='form-input' 
                               placeholder='e.g., Buy signal, Take profit...'>
                    </div>
                </form>
            </div>
            <div class='modal-footer'>
                <button type='button' class='btn btn-success' onclick='MarketData.createAlert()'>
                    <i class='fas fa-check' aria-hidden='true'></i> Create Alert
                </button>
                <button type='button' class='btn btn-secondary' onclick='MarketData.closeAlertModal()'>
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Chart Help Modal -->
    <div id='modalChartHelp' class='modal' role='dialog' aria-labelledby='chart-help-title' aria-modal='true'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2 id='chart-help-title'>üìà Understanding Price Charts</h2>
                <button class='close-modal' onclick='closeModal("modalChartHelp")' aria-label='Close dialog'>
                    <i class='fas fa-times' aria-hidden='true'></i>
                </button>
            </div>
            <div class='modal-body'>
                <h3>üìä Technical Indicators</h3>
                
                <h4>1Ô∏è‚É£ SMA (Simple Moving Average)</h4>
                <p>Average price over a period (e.g., 20 or 50 days). Helps identify trends.</p>
                <ul>
                    <li><strong>Price above SMA:</strong> Bullish signal üìà</li>
                    <li><strong>Price below SMA:</strong> Bearish signal üìâ</li>
                </ul>
                
                <h4>2Ô∏è‚É£ EMA (Exponential Moving Average)</h4>
                <p>Like SMA but gives more weight to recent prices. More responsive to changes.</p>
                
                <h4>3Ô∏è‚É£ Bollinger Bands</h4>
                <p>Shows price volatility. Price touching upper band = <strong>overbought</strong>, lower band = <strong>oversold</strong>.</p>
                
                <div class='info-box'>
                    üí° Combine multiple indicators for better signals!
                </div>
            </div>
        </div>
    </div>
    
    <!-- RSI Help Modal -->
    <div id='modalRSI' class='modal' role='dialog' aria-labelledby='rsi-help-title' aria-modal='true'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2 id='rsi-help-title'>üìä RSI - Relative Strength Index</h2>
                <button class='close-modal' onclick='closeModal("modalRSI")' aria-label='Close dialog'>
                    <i class='fas fa-times' aria-hidden='true'></i>
                </button>
            </div>
            <div class='modal-body'>
                <h3>üìê What is RSI?</h3>
                <p>The RSI measures the speed and magnitude of price changes. It oscillates between <strong>0 and 100</strong>.</p>
                
                <h3>üìà Interpretation</h3>
                <ul>
                    <li><strong>RSI &gt; 70:</strong> Overbought ‚Üí Possible reversal down ‚ö†Ô∏è</li>
                    <li><strong>RSI &lt; 30:</strong> Oversold ‚Üí Possible reversal up üöÄ</li>
                    <li><strong>RSI = 50:</strong> Neutral</li>
                </ul>
                
                <div class='info-box'>
                    <h4>Formula:</h4>
                    <p>RSI = 100 - [100 / (1 + RS)]</p>
                    <p>RS = Average Gain / Average Loss (over 14 periods)</p>
                </div>
                
                <div class='info-box success'>
                    üí° <strong>Trading Strategy:</strong> Buy when RSI crosses above 30, sell when it crosses below 70.
                </div>
            </div>
        </div>
    </div>
    
    <!-- MACD Help Modal -->
    <div id='modalMACD' class='modal' role='dialog' aria-labelledby='macd-help-title' aria-modal='true'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2 id='macd-help-title'>üìä MACD - Moving Average Convergence Divergence</h2>
                <button class='close-modal' onclick='closeModal("modalMACD")' aria-label='Close dialog'>
                    <i class='fas fa-times' aria-hidden='true'></i>
                </button>
            </div>
            <div class='modal-body'>
                <h3>üìê What is MACD?</h3>
                <p>The MACD shows the relationship between two moving averages. It consists of:</p>
                <ul>
                    <li><strong>MACD Line:</strong> EMA(12) - EMA(26)</li>
                    <li><strong>Signal Line:</strong> EMA(9) of MACD</li>
                    <li><strong>Histogram:</strong> MACD - Signal</li>
                </ul>
                
                <h3>üìà Trading Signals</h3>
                <ul>
                    <li><strong>MACD crosses above Signal:</strong> Buy signal üü¢</li>
                    <li><strong>MACD crosses below Signal:</strong> Sell signal üî¥</li>
                    <li><strong>Histogram increasing:</strong> Momentum strengthening</li>
                </ul>
                
                <div class='info-box success'>
                    üí° <strong>Pro Tip:</strong> MACD works best in trending markets, not in sideways/ranging markets.
                </div>
            </div>
        </div>
    </div>
    
    <!-- Signals Help Modal -->
    <div id='modalSignals' class='modal' role='dialog' aria-labelledby='signals-help-title' aria-modal='true'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h2 id='signals-help-title'>üéØ Trading Signals Explained</h2>
                <button class='close-modal' onclick='closeModal("modalSignals")' aria-label='Close dialog'>
                    <i class='fas fa-times' aria-hidden='true'></i>
                </button>
            </div>
            <div class='modal-body'>
                <h3>üö¶ Signal Types</h3>
                
                <h4>üü¢ Bullish Signals (Buy)</h4>
                <ul>
                    <li>RSI oversold (&lt;30) and reversing up</li>
                    <li>MACD crossing above signal line</li>
                    <li>Price bouncing off lower Bollinger Band</li>
                    <li>Golden Cross: Short MA crosses above Long MA</li>
                </ul>
                
                <h4>üî¥ Bearish Signals (Sell)</h4>
                <ul>
                    <li>RSI overbought (&gt;70) and reversing down</li>
                    <li>MACD crossing below signal line</li>
                    <li>Price rejected at upper Bollinger Band</li>
                    <li>Death Cross: Short MA crosses below Long MA</li>
                </ul>
                
                <div class='info-box warning'>
                    ‚ö†Ô∏è <strong>Warning:</strong> No signal is 100% accurate. Always combine multiple indicators and use risk management!
                </div>
            </div>
        </div>
    </div>
    
    <!-- ============================================
        CACHE MONITORING WIDGET
        ============================================ -->
    <div id='cacheWidget' class='cache-widget'>
        <button class='cache-toggle-btn' onclick='toggleCachePanel()' aria-label='Toggle cache statistics panel'>
            <i class='fas fa-database' aria-hidden='true'></i>
            <span class='cache-badge' id='cacheBadge' aria-label='Number of cached entries'>0</span>
        </button>
    </div>
    
    <aside id='cachePanel' class='cache-panel hidden' role='complementary' aria-labelledby='cache-panel-title'>
        <div class='cache-panel-header'>
            <h3 id='cache-panel-title'><i class='fas fa-database' aria-hidden='true'></i> Cache & API Monitoring</h3>
            <button class='close-cache-panel' onclick='toggleCachePanel()' aria-label='Close cache panel'>
                <i class='fas fa-times' aria-hidden='true'></i>
            </button>
        </div>
        
        <div class='cache-panel-body'>
            <!-- API Quota -->
            <div class='cache-section'>
                <h4><i class='fas fa-cloud' aria-hidden='true'></i> API Quota Today</h4>
                <div class='quota-display'>
                    <div class='quota-bar-container' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='800' aria-label='API quota usage'>
                        <div class='quota-bar' id='quotaBar' style='width: 0%'></div>
                    </div>
                    <div class='quota-stats'>
                        <span id='quotaUsed'>0</span> / <span id='quotaTotal'>800</span> requests
                        <span class='quota-remaining' id='quotaRemaining'>(800 left)</span>
                    </div>
                </div>
            </div>
            
            <!-- Cache Stats -->
            <div class='cache-section'>
                <h4><i class='fas fa-save' aria-hidden='true'></i> Local Cache</h4>
                <div class='cache-stats-grid'>
                    <div class='cache-stat-item'>
                        <div class='cache-stat-label'>Entries</div>
                        <div class='cache-stat-value' id='cacheEntries'>0</div>
                    </div>
                    <div class='cache-stat-item'>
                        <div class='cache-stat-label'>Hit Rate</div>
                        <div class='cache-stat-value' id='cacheHitRate'>0%</div>
                    </div>
                    <div class='cache-stat-item'>
                        <div class='cache-stat-label'>Saved Requests</div>
                        <div class='cache-stat-value' id='cacheSavedRequests'>0</div>
                    </div>
                </div>
            </div>
            
            <!-- Actions -->
            <div class='cache-section'>
                <h4><i class='fas fa-cog' aria-hidden='true'></i> Actions</h4>
                <div class='cache-actions'>
                    <button class='cache-action-btn refresh' onclick='refreshCacheStats()'>
                        <i class='fas fa-sync-alt' aria-hidden='true'></i> Refresh Stats
                    </button>
                    <button class='cache-action-btn clear' onclick='clearAllCache()'>
                        <i class='fas fa-trash' aria-hidden='true'></i> Clear Cache
                    </button>
                    <button class='cache-action-btn reset' onclick='resetQuotaCounter()'>
                        <i class='fas fa-redo' aria-hidden='true'></i> Reset Counter
                    </button>
                </div>
            </div>
            
            <!-- Cache Details -->
            <div class='cache-section'>
                <h4><i class='fas fa-list' aria-hidden='true'></i> Cache Details</h4>
                <div class='cache-details' id='cacheDetails'>
                    <div class='cache-empty'>No cache entries</div>
                </div>
            </div>
        </div>
    </aside>
    
    <!-- Cache Stats Auto-Update -->
    <script>
    // ============================================
    // CACHE MONITORING FUNCTIONS
    // ============================================
    
    let cacheStatsInterval = null;
    
    function toggleCachePanel() {
        const panel = document.getElementById('cachePanel');
        const isHidden = panel.classList.contains('hidden');
        
        if (isHidden) {
            panel.classList.remove('hidden');
            panel.setAttribute('aria-hidden', 'false');
            refreshCacheStats();
            cacheStatsInterval = setInterval(refreshCacheStats, 5000);
        } else {
            panel.classList.add('hidden');
            panel.setAttribute('aria-hidden', 'true');
            clearInterval(cacheStatsInterval);
        }
    }
    
    function refreshCacheStats() {
        if (!window.apiClient) return;
        
        const stats = window.apiClient.getCacheStats();
        
        const quotaUsed = stats.requestsToday;
        const quotaTotal = 800;
        const quotaPercent = (quotaUsed / quotaTotal) * 100;
        const quotaRemaining = quotaTotal - quotaUsed;
        
        document.getElementById('quotaUsed').textContent = quotaUsed;
        document.getElementById('quotaTotal').textContent = quotaTotal;
        document.getElementById('quotaRemaining').textContent = `(${quotaRemaining} left)`;
        
        const quotaBar = document.getElementById('quotaBar');
        quotaBar.style.width = quotaPercent + '%';
        quotaBar.setAttribute('aria-valuenow', quotaPercent);
        
        if (quotaPercent < 50) {
            quotaBar.style.background = '#4CAF50';
        } else if (quotaPercent < 80) {
            quotaBar.style.background = '#FF9800';
        } else {
            quotaBar.style.background = '#F44336';
        }
        
        document.getElementById('cacheEntries').textContent = stats.entries;
        document.getElementById('cacheBadge').textContent = stats.entries;
        
        const hitRate = stats.entries > 0 ? Math.min(100, Math.round((stats.entries / quotaUsed) * 100)) : 0;
        document.getElementById('cacheHitRate').textContent = hitRate + '%';
        
        const savedRequests = Math.max(0, stats.entries - quotaUsed);
        document.getElementById('cacheSavedRequests').textContent = savedRequests;
        
        updateCacheDetails();
    }
    
    function updateCacheDetails() {
        const keys = Object.keys(localStorage);
        const cacheKeys = keys.filter(k => k.startsWith('api_cache:'));
        
        const detailsContainer = document.getElementById('cacheDetails');
        
        if (cacheKeys.length === 0) {
            detailsContainer.innerHTML = '<div class="cache-empty">No cache entries</div>';
            return;
        }
        
        const entries = cacheKeys.map(key => {
            try {
                const { timestamp } = JSON.parse(localStorage.getItem(key));
                const age = Math.round((Date.now() - timestamp) / 1000);
                const endpoint = key.replace('api_cache:', '').split(':')[0];
                return { key, endpoint, age };
            } catch {
                return null;
            }
        }).filter(e => e !== null)
          .sort((a, b) => a.age - b.age);
        
        let html = '<div class="cache-entries-list">';
        entries.slice(0, 10).forEach(entry => {
            const ageStr = entry.age < 60 ? `${entry.age}s` : `${Math.round(entry.age/60)}m`;
            html += `
                <div class="cache-entry-item">
                    <span class="cache-entry-endpoint">${entry.endpoint}</span>
                    <span class="cache-entry-age">${ageStr} ago</span>
                </div>
            `;
        });
        html += '</div>';
        
        if (entries.length > 10) {
            html += `<div class="cache-entry-more">+${entries.length - 10} more entries</div>`;
        }
        
        detailsContainer.innerHTML = html;
    }
    
    function clearAllCache() {
        if (confirm('‚ö†Ô∏è Clear all cached data?\nThis will force fresh API requests.')) {
            if (window.apiClient) {
                window.apiClient.clearCache();
                refreshCacheStats();
                if (window.FinanceDashboard && window.FinanceDashboard.showNotification) {
                    window.FinanceDashboard.showNotification('‚úÖ Cache cleared successfully!', 'success');
                }
            }
        }
    }
    
    function resetQuotaCounter() {
        if (confirm('‚ö†Ô∏è Reset API quota counter?\nThis should only be done at the start of a new day.')) {
            localStorage.setItem('api_request_count', '0');
            localStorage.setItem('api_counter_reset_date', new Date().toDateString());
            if (window.apiClient) {
                window.apiClient.requestCount = 0;
            }
            refreshCacheStats();
            if (window.FinanceDashboard && window.FinanceDashboard.showNotification) {
                window.FinanceDashboard.showNotification('‚úÖ Quota counter reset!', 'success');
            }
        }
    }
    
    // Initial badge update
    document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
            if (window.apiClient) {
                const stats = window.apiClient.getCacheStats();
                document.getElementById('cacheBadge').textContent = stats.entries;
            }
        }, 1000);
    });
    </script>
    
    <!-- Screen reader only class -->
    <style>
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>

    <!-- Scripts - ORDRE IMPORTANT -->
    <script src='assets/js/config.js'></script>
    <script src='assets/js/api-client.js'></script>
    <script src='assets/js/dark-mode.js'></script>  <!-- ‚úÖ NOUVEAU -->
    <script src='assets/js/common.js'></script>
    <script src='assets/js/sidebar.js'></script>
    <script src='assets/js/market-data.js'></script>
</body>
</html>